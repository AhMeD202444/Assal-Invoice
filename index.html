<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ASSAL OFFICE â€¢ Invoices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <!-- Ø®Ø·ÙˆØ· (Cairo Ù„Ù„Ø¹Ø±Ø¨ÙŠ + Poppins Ù„Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ) -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <!-- XLSX + jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  


  <style>
  
  
  
  #mergeDupMsg{
  text-align: center;        /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Øµ */
  white-space: normal;       /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙØ§Ù Ø§Ù„Ø³Ø·Ø± */
  word-break: break-word;    /* ÙŠÙƒØ³Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… */
  overflow-wrap: anywhere;   /* ÙŠÙ„ÙÙ Ø­ØªÙ‰ Ù…Ø¹ Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø·ÙˆÙŠÙ„Ø© */
  line-height: 1.7;          /* Ø±Ø§Ø­Ø© Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
}


/* Ù‚ÙÙ„ ÙƒØ§Ù…Ù„ Ù„Ù„ØµÙØ­Ø© (html + body) Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
.no-scroll {
  overflow: hidden !important;
  position: relative;       /* ÙŠÙ…Ù†Ø¹ Ù†Ø·Ù‘Ø© iOS */
  touch-action: none;       /* ÙŠÙˆÙ‚Ù Ø§Ù„Ø¥ÙŠÙ…Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© */
}




/* Ø§Ù…Ù†Ø¹ Ø§Ù„Ø¥ÙŠÙ…Ø§Ø¡Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø§Ù„Ø®Ù„ÙÙŠØ© ÙÙ‚Ø·) */
.auth-overlay, .sys-overlay{
  touch-action: none;
}

/* Ø§Ø³Ù…Ø­ Ø¨Ø§Ù„Ù„Ù…Ø³/Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª Ù†ÙØ³Ù‡ */
.auth-overlay .auth-card,
.sys-overlay  .sys-card{
  touch-action: auto;
  max-height: 80vh;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}


  
  
  /* ===== Command Palette (Ctrl+K) ===== */
.palette-overlay{
  position: fixed; inset: 0; z-index: 10060;
  display: none; align-items: center; justify-content: center;
  background: rgba(10,11,14,.55);
  backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
  overscroll-behavior: contain;
   touch-action: none;            /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© */
}


/* Ù…Ø³Ø§ÙØ© Ø£Ù†ÙŠÙ‚Ø© Ø£Ø¹Ù„Ù‰ ÙƒØ±Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± */
.palette{
  padding-block-start: 10px;   /* ÙŠÙ†Ø²Ù„ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø´ÙˆÙŠÙ‘Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª */
   touch-action: auto;            /* ÙŠØ¸Ù„ Ø§Ù„Ø³ÙƒÙˆÙ„ Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø·Ø¨ÙŠØ¹ÙŠ */
}


/* Ù†Ø³ØªØ¹Ù…Ù„ ÙƒÙ„Ø§Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ù€ body Ø­ØªÙ‰ Ù†ÙˆÙ‚Ù Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„ØµÙØ­Ø© */
.body-no-scroll{
  overflow: hidden !important;
  position: relative; /* ÙŠÙ…Ù†Ø¹ Ø§Ù‡ØªØ²Ø§Ø² iOS */
}

@media (max-width: 768px){
  .palette{ padding-block-start: 6px; }
}





.palette{
  width: min(980px, 96vw);         /* Ø£ØµØºØ± Ø´ÙˆÙŠ Ø­ØªÙ‰ Ù…Ø§ ØªØ¶ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª */
  max-height: 86vh;
  background: linear-gradient(180deg, rgba(20,24,33,.97), rgba(12,15,21,.97));
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 18px; box-shadow: 0 20px 60px rgba(0,0,0,.45);
  display: flex; flex-direction: column;
  overflow: hidden;                 /* Ù…Ù‡Ù…: ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¥Ø·Ø§Ø± */
}

.palette-top{
  display: grid;
  grid-template-columns: minmax(0,1fr) auto;  /* ÙŠØ³Ù…Ø­ Ù„Ù„Ø¨Ø­Ø« ÙŠØªÙ‚Ù„Ù‘Øµ */
  gap: 10px;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid var(--stroke);
}

.palette-top .k{ color:#94a3b8; font-size:12px; }
.palette-search{
  display:flex; align-items:center; gap:8px;
  background: rgba(255,255,255,.08);
  border: 1px solid var(--stroke);
  border-radius: 12px;
  padding: 8px 10px;
  min-width: 0;                   /* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù…Ø¹ Grid */
}
.palette-search input{
  flex: 1 1 auto;
  min-width: 0;                   /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙ…Ø¯Ø¯ Ø§Ù„Ø²Ø§Ø¦Ø¯ */
  background: transparent; border:none; outline:none; color:#eaf0ff; font-size:14px;
}

.palette-actions{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  flex-wrap: nowrap;        /* Ù…Ù‡Ù…: Ù„Ø§ ÙŠÙ„Ù */
  max-width: 100%;
}
.palette-actions .btn{
  width: auto;              /* ÙŠÙ„ØºÙŠ width:100% Ø§Ù„Ø¹Ø§Ù…Ø© */
  min-width: 0;
  flex: 0 0 auto;           /* Ø­Ø¬Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙ‚Ø· */
  padding:10px 12px; border-radius:10px; font-weight:800;
}

/* Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©: Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ­Øª Ø§Ù„Ø¨Ø­Ø« */
@media (max-width: 520px){
  .palette-top{
    grid-template-columns: minmax(0,1fr) auto; /* ÙŠØ¨Ù‚ÙˆÙ† Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ */
    gap: 8px;
  }
  .palette-actions{
    justify-content: flex-end;  /* Ø£Ùˆ center Ø­Ø³Ø¨ Ø°ÙˆÙ‚Ùƒ */
    flex-wrap: nowrap;          /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù†Ø²ÙˆÙ„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ */
  }
  .palette-actions .btn{
    flex: 0 0 auto;             /* ØªØ±Ø¬Ø¹ Ù„Ø­Ø¬Ù…Ù‡Ø§ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
  }
}


.palette-body{
  overflow:auto; padding: 10px 12px;
  background: rgba(255,255,255,.03);
}
.group-title{
  position: sticky; top:0; z-index:1;
  background: linear-gradient(180deg, rgba(15,17,24,.95), rgba(15,17,24,.85));
  color:#cbd5e1; font-weight:800; font-size:12px;
  padding: 6px 10px; margin: 6px -6px 6px; border-left: 3px solid var(--brand-2);
}





/* Ø²Ø± Ù…Ø³Ø­ Ø¯Ø§Ø®Ù„ Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
.palette-search{
  position: relative;            /* Ø­ØªÙ‰ ÙŠØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚Ù„ */
}

.palette-search .search-clear{
  display: none;                 /* Ù†ÙØ¸Ù‡Ø±Ù‡ ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù†Øµ */
  place-items: center;
  position: absolute;
  inset-inline-end: 8px;         /* ÙŠÙ…ÙŠÙ† ÙÙŠ RTL */
  top: 50%; transform: translateY(-50%);
  width: 28px; height: 28px;
  border: 1px solid var(--stroke);
  background: rgba(255,255,255,.10);
  color: #eaf0ff;
  border-radius: 8px;
  cursor: pointer;
  transition: transform var(--speed), background var(--speed), border-color var(--speed), opacity .2s;
}
.palette-search .search-clear:hover{
  transform: translateY(-50%) translateY(-1px);
  background: rgba(255,255,255,.16);
  border-color: rgba(255,255,255,.25);
}

/* Ù†ÙØ¸Ù‡Ø± Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ù†Øµ */
.palette-search.has-text .search-clear{
  display: grid;
}

/* Ù…ÙˆØ¨Ø§ÙŠÙ„: ØªÙƒØ¨ÙŠØ± Ù†Ù‚Ø·Ø© Ø§Ù„Ù„Ù…Ø³ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
@media (max-width: 520px){
  .palette-search .search-clear{ width: 32px; height: 32px; }
}








.item-row{
  display:grid;
  grid-template-columns: 28px minmax(0,1.2fr) 90px minmax(0,1fr) 60px; /* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ‚Ù„Ù‘Øµ */
  gap:8px;
  align-items:center; background:#fff; color:#0f172a; border:1px solid #e2e8f0;
  border-radius: 10px; padding:10px; margin-bottom:8px;
}
.item-row .name{ font-weight:700; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.item-row .note{ font-size:13px; color:#475569; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }




.item-row input.qty{
  width: 100%; text-align:center; padding:8px; border:1px solid #cbd5e1; border-radius:8px; outline:none;
}
.item-row input.qty:focus{ border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,.15); }
.item-row .del{
  width:36px; height:36px; display:flex; align-items:center; justify-content:center;
  border-radius:8px; color:#fff; border:none; cursor:pointer;
  background: linear-gradient(45deg,#ef4444,#dc2626);
}
.item-row .del:hover{ transform: translateY(-2px); background: linear-gradient(45deg,#dc2626,#b91c1c); }

.item-row .chk{ width:18px; height:18px; }



/* ===== Command Palette â€¢ Foot (Ù…ØªÙˆØ³Ø·) ===== */
.palette-foot{
  justify-content: center;
  padding: 9px 12px;      /* Ù…Ø³Ø§ÙØ© Ù…ØªÙˆØ³Ø·Ø© */
  font-size: 12px;        /* Ø­Ø¬Ù… Ù†Øµ Ø¹Ø§Ù… Ù…ØªÙˆØ³Ø· */
  border-top: 1px solid var(--stroke);
}

.palette-foot .foot-note{
  text-align: center;
  font-size: clamp(11px, 1.25vw, 13px);  /* Ù…ØªÙˆØ³Ø· ÙˆÙŠØªØ£Ù‚Ù„Ù… Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¶ */
  line-height: 1.6;                      /* Ø±Ø§Ø­Ø© Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© */
  letter-spacing: 0.1px;
}




/* ÙØªØ­/ØºÙ„Ù‚ Ø³Ø±ÙŠØ¹ */
.palette-overlay.show{ display:flex; }

/* ØªÙ„Ù…ÙŠØ­ ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
.kbd-hint{ color:#94a3b8; font-size:12px; border:1px dashed var(--stroke); padding:4px 8px; border-radius:8px; }

  
  
  
  
  
  /* Confirm Modal */
.auth-overlay{
  position: fixed; inset: 0; z-index: 9999;
  display: none;              /* Ù†Ø®Ù„ÙŠÙ‡Ø§ Ù…Ø®ÙÙŠØ©ØŒ Ù†Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø§Ù„Ù€ JS */
  align-items: center; justify-content: center;
  background: rgba(10,11,14,.55);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.auth-card{
  width: min(420px, 92%);
  background: rgba(20,24,33,.92);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 18px;
  box-shadow: 0 18px 50px rgba(0,0,0,.45);
  padding: 22px 18px;
  color: #eaf0ff;
}





/* ===== Unified System Modal (maintenance / reload) ===== */
/* ===== System Modal â€¢ Global-App Style ===== */
.sys-overlay{
  position: fixed; inset: 0; z-index: 10080;
  display: none; align-items: center; justify-content: center;
  background: radial-gradient(120% 120% at 50% -10%, rgba(33,212,253,.18), transparent 55%),
              radial-gradient(120% 120% at -10% 120%, rgba(109,94,252,.16), transparent 55%),
              rgba(10,11,14,.54);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  animation: sysFade .25s ease both;
}
.sys-overlay.show{ display:flex; }
@keyframes sysFade { from{opacity:0} to{opacity:1} }

.sys-window{
  width: min(560px, 92vw);
  background: linear-gradient(180deg, rgba(20,24,33,.92), rgba(13,16,22,.92));
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 22px;
  box-shadow: 0 28px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
  padding: 20px 18px 16px;
  color: var(--text);
  position: relative;
  transform: translateY(8px);
  animation: sysPop .25s ease forwards;
}
@keyframes sysPop { to{ transform: translateY(0) } }

.sys-close{
  position: absolute; inset-inline-end: 10px; inset-block-start: 10px;
  width: 40px; height: 40px; display:grid; place-items:center;
  border: 1px solid var(--stroke);
  background: rgba(255,255,255,.06);
  color: var(--text);
  border-radius: 12px;
  cursor: pointer;
  transition: transform var(--speed), background var(--speed), border-color var(--speed);
}
.sys-close:hover{ transform: translateY(-2px); background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.24); }

/* Ù‡ÙŠØ±Ùˆ Ø£Ø®ÙÙ‘ Ø§Ø±ØªÙØ§Ø¹Ù‹Ø§ ÙˆÙƒÙ„Ø´ÙŠ ØªØ­Øª Ø¨Ø¹Ø¶ */
.sys-hero{
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 4px 8px 0;          /* ÙŠÙ‚Ù„Ù‘Ù„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¹Ø§Ù… */
  text-align: center;
}
@media (max-width:520px){
  .sys-hero{ grid-template-columns: 1fr; justify-items: center; text-align: center; }
}

.ring{
  position: relative; width: 150px; height: 150px;
  display: grid; place-items: center;
}
.ring-svg{ width: 150px; height: 150px; transform: rotate(-90deg); }
.ring-svg .track{
  fill: none; stroke: rgba(255,255,255,.12); stroke-width: 10; 
}
.ring-svg .progress{
  fill: none; stroke: url(#sysGrad);
  stroke-width: 10; stroke-linecap: round; stroke-dasharray: 326.72; /* 2Ï€r = 2*Ï€*52 */
  stroke-dashoffset: 326.72; transition: stroke-dashoffset .4s ease;
  filter: drop-shadow(0 0 10px rgba(99,102,241,.45));
}
/* Ù†Ø¶ÙŠÙ ØªØ¯Ø±Ù‘Ø¬ Ø¹Ø¨Ø± CSS mask (Ø¨Ø¯ÙˆÙ† <defs>) */
.ring-svg .progress{ stroke: linear-gradient(135deg, var(--brand-2), var(--brand-1)); }

.ring-core{
  position: absolute; inset: 0; display:grid; place-items: center;
}

/* ÙŠØ®ÙÙŠ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ù„Ù‚Ø© Ø¨Ù†Ø¹ÙˆÙ…Ø© */
.ring-percent.is-hidden{
  opacity: 0;
  transform: scale(0.92);
  transition: opacity .25s ease, transform .25s ease;
}




/* Ù†Ø®ÙÙŠ Ø§Ù„Ù„ÙˆØºÙˆ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù„Ù‚Ø© (Ù„Ùˆ Ø¸Ù„Ù‘ Ø¨Ø§Ù„Ù€ HTML Ø¨Ø§Ù„ØºÙ„Ø·) */
.brand-dot{ display:none !important; }
.ring-percent{
  margin-top: 6px; font-weight: 900; font-size: 14px; color:#eaf0ff; letter-spacing:.2px;
  opacity: .9;
}
.ring-check{
  position: absolute; inset: 0; display:grid; place-items:center;
  width: 100%; height: 100%;
  color: #10b981; font-size: 46px;
  transform: scale(.7); opacity: 0; pointer-events: none;
  transition: transform .35s ease, opacity .35s ease;
}
.ring-check.show{ transform: scale(1); opacity: 1; }

.sys-headings .sys-title{
  font-size: 18px; font-weight: 800; letter-spacing: .2px; margin-bottom: 6px;
}
.sys-headings .sys-sub{
  color: var(--muted); font-size: 13px;
}


/* Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ØªØ­Øª Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© */
.sys-steps.row{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;                    /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  margin: 6px 0 0;
  padding: 6px 0 0;
  border-top: 1px dashed var(--stroke);
  max-height: none;
  overflow: visible;
}

/* Ø´ÙƒÙ„ ÙƒÙ„ Ø®Ø·ÙˆØ© ÙƒØ¨Ø§Ø¯Ø¬ ØµØºÙŠØ± */
.sys-steps.row .sys-step{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border: 1px solid var(--stroke);
  border-radius: 999px;
  background: rgba(255,255,255,.04);
  color:#dbe2f5; font-size: 12px;
  white-space: nowrap;
}

/* Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ø§Ù„Ø© + Ø£Ù„ÙˆØ§Ù†Ù‡Ø§ */
.sys-steps.row .sys-step .dot{
  width: 8px; height: 8px; border-radius: 50%;
  background: rgba(255,255,255,.22);
}
.sys-steps.row .sys-step.active .dot{
  background: linear-gradient(135deg, var(--brand-2), var(--brand-1));
  box-shadow: 0 0 0 3px rgba(109,94,252,.18);
}
.sys-steps.row .sys-step.done .dot{ background: #10b981; }

/* Ù†Øµ Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø§Ø¯Ø¬ (Ù†Ø®Ù„ÙŠÙ‡ Ø£ØµØºØ± ÙˆÙŠØ®ØªÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©) */
.sys-steps.row .sys-step small{
  color:#9aa3b9; display:inline-block;
}
@media (max-width:520px){
  .sys-steps.row .sys-step small{ display:none; }
}

/* ØªÙ‚Ù„ÙŠÙ„ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù†ÙØ³Ù‡Ø§ Ø´ÙˆÙŠ */
.sys-window{
  padding: 16px 14px 12px;     /* Ø£Ù‚Ù„ Ù…Ù† Ù‚Ø¨Ù„ */
}




.sys-step{
  display:flex; align-items:center; gap:10px;
  color:#dbe2f5; font-size: 13px;
}
.sys-step .dot{
  width: 10px; height: 10px; border-radius: 50%;
  background: rgba(255,255,255,.18);
}
.sys-step.active .dot{ background: linear-gradient(135deg, var(--brand-2), var(--brand-1)); box-shadow: 0 0 0 3px rgba(109,94,252,.18); }
.sys-step.done .dot{ background: #10b981; }
.sys-step small{ color:#9aa3b9; }

.sys-footer{
  margin-top: 12px; display:flex; align-items:center; gap:10px; justify-content: space-between; flex-wrap: wrap;
}
#sysPrimaryBtn{ min-width: 220px; }
.sys-mini{ color:#9aa3b9; font-size: 12px; }

  
 
  
  
    :root{
  --bg-1:#0e0f13;
  --bg-2:#0a0b0e;
  --glass: rgba(255,255,255,.06);
  --stroke: rgba(255,255,255,.14);
  --text:#f5f7ff;
  --muted:#aab0c0;
  --brand-1:#6d5efc;
  --brand-2:#21d4fd;
  --good:#22c55e;
  --warn:#f59e0b;
  --danger:#ef4444;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius: 18px;
  --blur: 14px;
  --speed: .32s;
   --side: 340px;   /* â† Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± (Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø±ÙŠÙ†) Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠØ³ÙƒØªÙˆØ¨ */
}

*{ box-sizing: border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: "Cairo","Poppins", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
  color: var(--text);
  background:
    radial-gradient(1200px 1200px at 120% -20%, rgba(33,212,253,.20), transparent 60%),
    radial-gradient(900px 900px at -10% 120%, rgba(109,94,252,.20), transparent 60%),
    linear-gradient(180deg, var(--bg-1), var(--bg-2));
  overflow-x:hidden;
}

/* ====== Header ====== */
.app-header{
  position:sticky; top:0; z-index:50;
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient( to bottom, rgba(10,11,14,.75), rgba(10,11,14,.35) );
  border-bottom: 1px solid var(--stroke);
}
.head-wrap{
  max-width:1200px; margin:auto; padding:14px 18px;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.brand{
  display:flex; align-items:center; gap:12px;
  font-weight:700; letter-spacing:.3px;
}
.brand .badge{
  width:40px; height:40px; display:grid; place-items:center;
  background: radial-gradient(120% 120% at 20% 20%, var(--brand-2), var(--brand-1));
  border-radius:12px; color:#0b0d13; font-weight:900;
  box-shadow: var(--shadow);
}
.brand small{ color: var(--muted); font-weight:600; display:block; margin-top:-2px; font-size:12px; }
.head-actions{ display:flex; align-items:center; gap:10px; }
.icon-btn{
  width:40px; height:40px; display:grid; place-items:center;
  border:1px solid var(--stroke);
  background: var(--glass);
  border-radius:12px; color:var(--text);
  cursor:pointer; transition: transform var(--speed), background var(--speed), border-color var(--speed);
}
.icon-btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.25); }

/* ====== Layout ====== */
.layout{
  max-width:1200px; margin:22px auto; padding:0 16px;
  display:grid; grid-template-columns: var(--side) 1fr; gap:16px;
}

/* ===== ØªØ®Ø·ÙŠØ· Ø§Ù„Ø´Ø¨ÙƒØ©: Ø¬Ø§Ù†Ø¨ÙŠÙ† ÙÙˆÙ‚ Ø¨Ø¹Ø¶ ÙˆÙ…Ø­ØªÙˆÙ‰ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† ===== */
.layout{
  display: grid;
  grid-template-columns: var(--side) 1fr;
  grid-auto-rows: min-content;
}

/* ØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
#sidebar{
  grid-column: 1;  /* Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± */
  grid-row: 1;     /* Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ */
}
#importedSidebar{
  grid-column: 1;  /* Ù†ÙØ³ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± */
  grid-row: 2;     /* ÙŠÙ†Ø²Ù„ ØªØ­Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */
}
.content{
  grid-column: 2;        /* Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† */
  grid-row: 1 / span 2;  /* ÙŠÙ…ØªØ¯ Ø¹Ù„Ù‰ ØµÙÙ‘ÙŠÙ† */
}

/* Ø¹Ù„Ù‰ 992px ÙˆØ£ØµØºØ±: Ù†Ø±Ø¬Ù‘Ø¹ ÙƒÙ„Ø´ÙŠ Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ (Ù…Ø«Ù„ Ù…Ø§ Ø¹Ù†Ø¯Ùƒ) */
@media (max-width: 992px){
  .layout{
    grid-template-columns: 1fr;
    grid-auto-rows: initial;
  }
  #sidebar, #importedSidebar, .content{
    grid-column: auto;
    grid-row: auto;
  }
}


/* ØªØ§Ø¨Ù„Øª */
@media (max-width: 992px){
  .layout{ grid-template-columns: 1fr; }
}

/* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width: 576px){
  .layout{
    display: flex;             /* Ø¨Ø¯Ù„ Grid Ø­ØªÙ‰ Ù†Ø³ØªØ®Ø¯Ù… order */
    flex-direction: column;
    padding: 0 10px;
    margin: 14px auto;
  }
  .content { order: 1; }
  .sidebar { order: 2; }
}


@media (max-width: 768px){
  .editor > div{
    flex-direction: column;    /* Ø£ÙŠ Ø³Ø·Ø± Ø¯Ø§Ø®Ù„Ù‡ display:flex (Ù…Ø«Ù„ Ø§Ù„Ø¹Ø¯Ø¯+Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª/Ø§Ù„Ø£Ø²Ø±Ø§Ø±) ÙŠØµÙŠØ± Ø¹Ù…ÙˆØ¯ÙŠ */
  }
  .editor .ginput{ flex: 1 1 100%; }
}



/* ====== Sidebar ====== */
.sidebar{
  background: var(--glass);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:14px;
  position:relative;
  overflow:hidden;
}
.panel-title{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:8px 6px 12px; border-bottom:1px dashed var(--stroke);
  margin-bottom:10px;
}
.panel-title h3{ margin:0; font-size:16px; font-weight:800; letter-spacing:.2px; }
.pill{
  background: rgba(255,255,255,.08);
  border:1px solid var(--stroke);
  padding:6px 10px; border-radius:999px; color: var(--muted); font-size:12px;
}

/* Category select */
.category{ margin-top:10px; display:flex; flex-direction:column; gap:10px; }
.cat-label{ font-size:12px; color:var(--muted); padding:0 6px; }
.cat-select{ position:relative; user-select:none; }
.cat-btn{
  width:100%;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  background: rgba(255,255,255,.06);
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:12px 14px; cursor:pointer;
  transition: background var(--speed), border-color var(--speed), transform var(--speed);
}
.cat-btn:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.25); transform: translateY(-1px); }
.cat-list{
  position:absolute; inset-inline:0; top: calc(100% + 8px); z-index:5;
  background: rgba(16,18,24,.98);
  border:1px solid var(--stroke);
  border-radius:16px;
  box-shadow: var(--shadow);
  padding:6px;
  display:none;
  max-height: 280px; overflow:auto;
}
.cat-item{
  padding:10px 12px; border-radius:10px; cursor:pointer;
  display:flex; align-items:center; justify-content:center; gap:8px;
  color:var(--text); font-weight:600;
  transition: background var(--speed), transform var(--speed);
  border-bottom: 1px dashed rgba(255,255,255,.08);
  text-align:center;
}
.cat-item:last-child{ border-bottom:none; }
.cat-item:hover{ background: rgba(255,255,255,.06); transform: translateY(-1px); }
.cat-item i{ color: var(--brand-2); }

/* Invoices list */
.invoices-list{ display:flex; flex-direction:column; gap:8px; margin-top:12px; }
.invoice-chip{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  background: rgba(255,255,255,.05);
  border:1px solid var(--stroke);
  padding:10px 12px; border-radius:12px; cursor:pointer;
  transition: background var(--speed), transform var(--speed);
}
.invoice-chip:hover{ background: rgba(255,255,255,.09); transform: translateY(-1px); }
.chip-meta{ display:flex; flex-direction:column; gap:4px; }
.chip-meta strong{ font-size:13px; }
.chip-meta small{ color:var(--muted); }

/* ====== Content ====== */
.content{ display:flex; flex-direction:column; gap:18px; }

/* Grid cards */
.grid{
  display:grid; grid-template-columns: repeat(3,1fr); gap:14px;
}
@media (max-width: 992px){
  .grid{ grid-template-columns: repeat(2,1fr); }
}
@media (max-width: 576px){
  .editor .ginput {
    flex: 1 1 100%;
  }
  .editor > div {
    flex-direction: column;
  }
  .gfield, .btn {
    font-size:14px;
    padding:10px 12px;
  }
}

.card{
  background: var(--glass);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:16px;
  overflow:hidden;
  position:relative;
}
.card .title{ display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-size:12px; margin-bottom:8px; }
.value{ font-weight:900; font-size:22px; letter-spacing:.3px; display:flex; align-items:center; gap:8px; }
.trend{ font-size:12px; color: var(--good); }

/* Editor */
.editor{ display: flex; flex-direction: column; gap: 12px; }
#searchInput { width: 100%; }
.card.table-wrap { margin-top: 20px; }

/* Footer */
.app-footer {
  position: sticky; bottom: 0; z-index: 50;
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient(to top, rgba(10,11,14,.85), rgba(10,11,14,.35));
  border-top: 1px solid var(--stroke);
}
.foot-wrap {
  max-width: 1200px;
  margin: auto;
  padding: 12px 18px;
  text-align: center;
  font-size: 13px;
  color: var(--muted);
}

/* Inputs and buttons */
.ginput{ display:flex; flex-direction:column; gap:8px; }
.glabel{ font-size:12px; color:var(--muted); padding:0 6px; }
.gfield{
  background: rgba(255,255,255,.06);
  border:1px solid var(--stroke);
  padding:12px 14px; border-radius:14px; color: var(--text);
  outline:none; transition: border-color var(--speed), background var(--speed), transform var(--speed);
  text-align:center;
  width:100%; max-width:100%;
}
.gfield::placeholder{ color: #93a0b8; }
.gfield:focus{ border-color: rgba(255,255,255,.35); background: rgba(255,255,255,.09); transform: translateY(-1px); }

.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:12px 14px; border:none; cursor:pointer; font-weight:800; letter-spacing:.3px;
  border-radius:14px; color:#0b0d13;
  background: linear-gradient(135deg, var(--brand-2), var(--brand-1));
  box-shadow: 0 8px 20px rgba(109,94,252,.35);
  transition: transform var(--speed), box-shadow var(--speed), filter var(--speed);
  width:100%; max-width:100%;
}
.btn:hover{ transform: translateY(-2px); filter: brightness(1.05); box-shadow: 0 10px 26px rgba(109,94,252,.45); }
.btn.green{ background:linear-gradient(135deg,#34d399,#10b981); color:#091018; }
.btn.amber{ background:linear-gradient(135deg,#f59e0b,#d97706); color:#0b0d13; }
.btn.blue{ background:linear-gradient(135deg,#60a5fa,#2563eb); color:#0b0d13; }

/* Table */
.table-wrap {
  padding: 0;
  overflow-x: auto;              /* ÙŠØ·Ù„Ø¹ Ø³ÙƒØ±ÙˆÙ„ Ø¥Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ø¹Ø±Ø¶ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
  -webkit-overflow-scrolling: touch; /* Ø³Ù„Ø§Ø³Ø© Ø¹Ù„Ù‰ iOS */
  border-radius: 14px;

  max-height: 300px;             /* ÙŠØ­Ø¯Ø¯ Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ (ØªÙ‚Ø¯ÙŠØ±Ø§Ù‹ 5 ØµÙÙˆÙ) */
  overflow-y: auto;              /* ÙŠØ®Ù„ÙŠ Ø³ÙƒØ±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÙŠ Ø¥Ø°Ø§ ØªØ¹Ø¯Ù‰ 5 ØµÙÙˆÙ */
}


table{
  width: 100%;
  min-width: 680px;            /* Ù†Ø®Ù„ÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£ÙƒØ¨Ø± Ø´ÙˆÙŠØ© Ø­ØªÙ‰ ÙŠØ·Ù„Ø¹ Scroll Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  border-collapse: collapse;
  table-layout: fixed;         /* Ø­ØªÙ‰ ÙŠÙ„ÙÙ‘ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
  background: rgba(255,255,255,.04);
  border: 1px solid var(--stroke);
  border-radius: 14px;
  overflow: hidden;
}

thead th, tbody td{
  word-break: break-word;      /* ÙŠÙƒØ³Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ© */
  text-align: center;
  padding: 14px;
}

tbody tr:last-child td{ border-bottom:none; }



.btn-danger-custom {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(45deg,#ef4444,#dc2626);
  border: none;
  cursor: pointer;
  transition: transform .2s, background .2s;
}
.btn-danger-custom:hover {
  background: linear-gradient(45deg,#dc2626,#b91c1c);
  transform: translateY(-2px);
}





/* Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ù…ÙŠØ© â€” Ø³Ù…Ø§ÙˆÙŠ/Ø£Ø²Ø±Ù‚ ÙˆØ£Ø®Ù Ø¨ØµØ±ÙŠÙ‹Ø§ */
.btn-rename-custom{
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(135deg,#22d3ee,#3b82f6); /* Ø³Ù…Ø§ÙˆÙŠ â†’ Ø£Ø²Ø±Ù‚ */
  border: none;
  cursor: pointer;
  transition: transform .2s, filter .2s, box-shadow .2s;
  box-shadow: 0 6px 16px rgba(59,130,246,.28);         /* Ø¸Ù„ Ù†Ø§Ø¹Ù… Ø¬Ø°Ø§Ø¨ */
}
.btn-rename-custom:hover{
  transform: translateY(-2px);
  filter: brightness(1.05);
  box-shadow: 0 10px 22px rgba(59,130,246,.35);
}
.btn-rename-custom:focus{
  outline: none;
  box-shadow: 0 0 0 3px rgba(59,130,246,.35), 0 8px 20px rgba(59,130,246,.35);
}
.btn-rename-custom i{
  opacity: .95; /* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£Ø®Ù Ø´ÙˆÙŠ */
}







#itemsTable td:last-child {
  text-align: center;
  vertical-align: middle;
}




/* ====== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ====== */
table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--stroke);   /* Ø­Ø¯ÙˆØ¯ Ø®Ø§Ø±Ø¬ÙŠØ© */
  border-radius: 14px;
  overflow: hidden;
}

/* Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
thead th {
  background: linear-gradient(135deg, #1e293b, #0f172a); /* ØªØ¯Ø±Ø¬ Ø¯Ø§ÙƒÙ† Ø£Ù†ÙŠÙ‚ (ÙƒØ­Ù„ÙŠ/Ø£Ø³ÙˆØ¯ Ù…Ø²Ø±Ù‚) */
  color: #f1f5f9;                          /* Ù†Øµ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ (Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø§Ø¦Ù„ Ù„Ù„Ø£Ø¨ÙŠØ¶) */
  font-weight: 700;                        /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
  padding: 14px;
  border: 1px solid rgba(255,255,255,.08); /* Ø­Ø¯ÙˆØ¯ Ù†Ø§Ø¹Ù…Ø© Ø¬Ø¯Ø§Ù‹ */
  text-align: center;
  letter-spacing: .5px;                    /* Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø±ÙˆÙ */
  font-size: 15px;
  text-transform: none;                    /* Ù†Ø®Ù„ÙŠ Ø§Ù„Ù†Øµ Ø·Ø¨ÙŠØ¹ÙŠ Ø¨Ø¯ÙˆÙ† Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø© */
  box-shadow: inset 0 -1px 6px rgba(0,0,0,.4); /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ ØºØ§Ù…Ù‚ ÙŠØ¶ÙŠÙ Ø¹Ù…Ù‚ */
}


/* Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
tbody td {
  padding: 12px;
  border: 1px solid #cbd5e1;  /* Ø®Ø·ÙˆØ· Ù†Ø§Ø¹Ù…Ø© Ø¨ÙŠÙ† Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
  text-align: center;
  font-size: 14px;
  color: #0f172a;             /* Ù†Øµ Ø¯Ø§ÙƒÙ† ÙˆØ§Ø¶Ø­ */
}




#itemsTable .btn-danger-custom {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
}






/* ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨ */
/* ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
tbody tr:nth-child(even) {
  background-color: #f8fafc;  /* Ù„ÙˆÙ† ÙØ§ØªØ­ Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© */
}
tbody tr:nth-child(odd) {
  background-color: #e2e8f0;  /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ø´ÙˆÙŠ Ù„Ù„ØµÙÙˆÙ Ø§Ù„ÙØ±Ø¯ÙŠØ© */
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ */
tbody tr:hover {
  background: rgba(33,212,253,.15);  /* Ù‡Ø§ÙŠÙ„Ø§ÙŠØª Ø£Ù†ÙŠÙ‚ */
  transition: background 0.3s ease;
}









/* Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù… â€” ÙŠÙ…ÙŠÙ† ØªØ­ØªØŒ Ø£ØµØºØ± ÙˆØ¨Ø´ÙƒÙ„ Ù…Ø±Ø¨Ù‘Ø¹ Ù†Ø§Ø¹Ù… */
/* Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù… â€” ÙŠÙ…ÙŠÙ†/ØªØ­ØªØŒ Ø¯Ø§Ø¦Ø±ÙŠØŒ Ù„ÙˆÙ† Ù…ØªÙ†Ø§Ø³Ù‚ */
.fab{
  position: fixed;
  right: 20px;             /* â† ÙŠÙ…ÙŠÙ† */
  bottom: 20px;            /* â† ØªØ­Øª */
  z-index: 60;

  width: 56px;             /* Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨ */
  height: 56px;
  border-radius: 50%;      /* â† Ø¯Ø§Ø¦Ø±ÙŠ */

  display: grid;
  place-items: center;

  /* ØªØ¯Ø±Ù‘Ø¬ Ø£Ù†Ø¹Ù… (Ø³Ù…Ø§ÙˆÙŠ â†’ Ø£Ø²Ø±Ù‚) ÙŠÙ„Ø§Ø¦Ù… Ø§Ù„Ø«ÙŠÙ… */
  background: linear-gradient(135deg, #22d3ee, #3b82f6);
  color: #ffffff;          /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨ÙŠØ¶Ø§Ø¡ */
  font-size: 20px;         /* Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
  box-shadow: 0 12px 28px rgba(59,130,246,.35);
  cursor: pointer;

  transition: transform .25s, filter .25s, box-shadow .25s;
}

.fab:hover{
  transform: translateY(-2px);
  filter: brightness(1.05);
  box-shadow: 0 14px 34px rgba(59,130,246,.45);
}

.fab:active{
  transform: translateY(0);
}

.fab i{ pointer-events: none; }  /* Ø­ØªÙ‰ Ù…Ø§ ØªØ¹ÙŠÙ‚ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒÙ„ÙŠÙƒ */



/* Ø®Ù„Ù‘ÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙÙˆÙ‚ ÙƒÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª */
.toast-container{
  z-index: 12000 !important;  /* Ø£Ø¹Ù„Ù‰ Ù…Ù† 10060 ØªØ¨Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± */
}


/* Toast */
.toast-container{ position: fixed; inset-block-start:18px; inset-inline:0; display:grid; place-items:center; z-index:70; }
.toast{
  background: rgba(20,24,33,.96);
  border: 1px solid var(--stroke);
  color: var(--text);
  padding:12px 16px; border-radius:12px; box-shadow: var(--shadow);
  display:none; align-items:center; gap:10px; font-weight:700;
}
.toast.show{ display:flex; animation: pop .3s ease; }
@keyframes pop{ from{ transform: translateY(-8px); opacity:.0; } to{ transform: translateY(0); opacity:1; } }




/* Search suggestions */
#autocompleteSuggestions{
  position: absolute; inset-inline:0; inset-block-start:100%; margin-block-start:6px;
  background: rgba(16,18,24,.98);
  border:1px solid var(--stroke);
  border-radius:14px;
  max-height:240px; overflow:auto; z-index:40; display:none;
}
#autocompleteSuggestions li{
  list-style:none; padding:10px 12px; cursor:pointer; text-align:center; color:#eaf0ff;
  border-bottom:1px dashed rgba(255,255,255,.08);
}
#autocompleteSuggestions li:last-child{ border-bottom:none; }
#autocompleteSuggestions li:hover{ background: rgba(255,255,255,.06); }

#autocompleteSuggestions li.active{
  background: rgba(33,212,253,.15);
}


/* Responsive header + footer for small screens */
@media (max-width:576px){
  .brand .badge{ width:32px; height:32px; font-size:14px; }
  .head-actions .icon-btn{ width:34px; height:34px; }
  .head-wrap, .foot-wrap{ padding:10px 12px; }
}



/* ØµÙÙŠÙ† Ù…ØªØ³Ø§ÙˆÙŠÙŠÙ† Ø¯Ø§Ø¦Ù…Ø§Ù‹: Ø§Ù„Ø¹Ø¯Ø¯+Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ Ø­ÙØ¸+PDF */
.line-qty-note,
.line-actions{
  display: grid;
  grid-template-columns: 1fr 1fr; /* ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ø¹Ø±Ø¶ */
  gap: 12px;
  align-items: stretch;
}

.line-qty-note .ginput,
.line-actions .btn{
  min-width: 0; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¨Ø±ÙˆØ²/Ø§Ù„ØªÙ…Ø¯Ø¯ Ø§Ù„Ø²Ø§Ø¦Ø¯ */
}

/* Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ù‚ÙˆØ§Ø¹Ø¯ Ù‚Ø¯ÙŠÙ…Ø© ØªÙ‚Ù„Ø¨ Ø£Ø³Ø·Ø± .editor Ù„Ø¹Ù…ÙˆØ¯ÙŠ Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ
   Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø§ ÙŠØªØ£Ø«Ø± Ù„Ø£Ù†Ù†Ø§ GridØŒ Ùˆ flex-direction Ù…Ø§ ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ grid */
   
   
   
   
   /* ===== Maintenance Overlay ===== */
.maint-overlay{
  position: fixed; inset: 0; z-index: 10000;
  display: none;                    /* Ù†Ø¸Ù‡Ø±Ù‡Ø§ Ø¨Ø§Ù„Ù€ JS */
  align-items: center; justify-content: center;
  background: rgba(10,11,14,.55);
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
}
.maint-card{
  width: min(520px, 92%);
  background: linear-gradient(180deg, rgba(20,24,33,.96), rgba(13,16,22,.96));
  border: 1px solid var(--stroke);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
  padding: 28px 22px;
  text-align: center;
  color: var(--text);
}
.maint-card h2{
  margin: 6px 0 6px; font-size: 22px; font-weight: 800; letter-spacing: .2px;
}
.maint-card p{
  margin: 0; color: var(--muted); font-size: 14px;
}
.maint-spin{
  width: 58px; height: 58px; margin: 0 auto 12px;
  border-radius: 50%;
  border: 4px solid rgba(255,255,255,.18);
  border-top: 4px solid var(--brand-2);
  animation: maint-rot 1s linear infinite;
  box-shadow: 0 0 0 4px rgba(33,212,253,.06), 0 10px 24px rgba(0,0,0,.25);
}
@keyframes maint-rot { to { transform: rotate(360deg); } }




/* Ø£Ø²Ø±Ø§Ø± Ø£ÙŠÙ‚ÙˆÙ†ÙŠØ© Ø¯Ø§Ø¦Ø±ÙŠØ© Ø£Ù†ÙŠÙ‚Ø© */
.palette-actions .btn.icon{
  width: 42px; height: 42px;
  padding: 0; border-radius: 12px;
  display: grid; place-items: center;
  font-size: 16px;
}

/* ØªØ­Ø³ÙŠÙ† ØªÙˆØ²ÙŠØ¹ Ø¹Ù†Ø§ØµØ± ØµÙÙ‘ Ø§Ù„Ù…Ø§Ø¯Ø© */
.item-row{ grid-template-columns: 28px 1.2fr 90px 1fr 60px; }
.item-row .name{ min-width: 0; }
.item-row .note{
  min-width: 0;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

/* Ø§Ø³ØªØ¬Ø§Ø¨Ø©: Ø¬ÙˆÙ‘Ø§Ù„/Ø´Ø§Ø´Ø§Øª Ø¶ÙŠÙ‘Ù‚Ø© â€” Ù†Ø®ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ØªÙ‰ Ù…Ø§ ØªÙ†Ø¹ØµØ± */
@media (max-width: 768px){
  .palette{ width: 96vw; max-height: 90vh; }
  .palette-top{ grid-template-columns: 1fr auto; gap: 8px; }
  .palette-search input{ font-size: 16px; } /* ÙƒÙŠØ¨Ø¯ Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ ÙˆØ§Ø¶Ø­ */
  .item-row{
    grid-template-columns: 24px 1fr 80px 44px;  /* Ù†Ø´ÙŠÙ„ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
    gap: 8px;
  }
  .item-row .note{ display: none; }
  .item-row input.qty{ padding: 6px; }
  .palette-actions .btn.icon{ width: 40px; height: 40px; }
}

/* Ø¬ÙˆÙ‘Ø§Ù„ Ø£ØµØºØ± */
@media (max-width: 480px){
  .item-row{
    grid-template-columns: 22px 1fr 72px 40px;
    padding: 8px;
  }
  .palette-actions .btn.icon{ width: 38px; height: 38px; }
}




:root{
  --pal-row-h: 64px;          /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ÙƒØ§Ø±Øª/Ø§Ù„Ø³Ø·Ø± */
  --pal-head-h: 52px;         /* ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ø§Ø±ØªÙØ§Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
}

.palette{
  max-height: 86vh;           /* Ø«Ø§Ø¨Øª Ù…Ø«Ù„ Ù…Ø§ Ø¹Ù†Ø¯Ùƒ */
}

.palette-body{
  /* Ø£Ù‚Ù„ Ø´ÙŠ ÙŠØ´ÙŠÙ„ 5 Ø¹Ù†Ø§ØµØ± + Ù…Ø³Ø§Ø­Ø© Ø¨Ø³ÙŠØ·Ø© */
  max-height: calc(var(--pal-row-h) * 5 + var(--pal-head-h));
  overflow-y: auto;
}

.item-row{
  min-height: var(--pal-row-h);
}




/* ===== Scrollbars â€¢ Right side â€¢ Hidden until hover/active ===== */

/* 0) Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù…Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ */
html, body,
.palette-body, .table-wrap, .invoices-list, #importedPdfList,
.cat-list, #autocompleteSuggestions {
  scrollbar-gutter: stable;                /* Ø­Ø¯ÙŠØ« ÙˆÙ…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
}

/* 1) Ø§Ø®ÙØ§Ø¡ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø³ÙƒØ±ÙˆÙˆÙ„Ø§Øª */
* {
  scrollbar-width: none;                   /* Firefox */
}
*::-webkit-scrollbar {
  width: 0; height: 0;                     /* Chrome/Edge/Safari */
}

/* 2) Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø´ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„Ù‡ÙˆÙØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± */
body:hover,
.palette-body:hover,
.table-wrap:hover,
.invoices-list:hover,
#importedPdfList:hover,
.cat-list:hover,
#autocompleteSuggestions:hover {
  scrollbar-width: thin;                   /* Firefox */
  scrollbar-color: #94a3b8 transparent;    /* Ù„ÙˆÙ† Ø§Ù„Ù…Ù‚Ø¨Ø¶ ÙÙ‚Ø· */
}

/* 3) WebKit: Ø´ÙƒÙ„ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¸Ù‡ÙˆØ± */
body:hover::-webkit-scrollbar,
.palette-body:hover::-webkit-scrollbar,
.table-wrap:hover::-webkit-scrollbar,
.invoices-list:hover::-webkit-scrollbar,
#importedPdfList:hover::-webkit-scrollbar,
.cat-list:hover::-webkit-scrollbar,
#autocompleteSuggestions:hover::-webkit-scrollbar {
  width: 10px;                             /* Ø³Ù…Ø§ÙƒØ© Ø£Ù†ÙŠÙ‚Ø© */
  height: 10px;
}

body:hover::-webkit-scrollbar-thumb,
.palette-body:hover::-webkit-scrollbar-thumb,
.table-wrap:hover::-webkit-scrollbar-thumb,
.invoices-list:hover::-webkit-scrollbar-thumb,
#importedPdfList:hover::-webkit-scrollbar-thumb,
.cat-list:hover::-webkit-scrollbar-thumb,
#autocompleteSuggestions:hover::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #21d4fd, #6d5efc);
  border-radius: 999px;
  border: 2px solid transparent;           /* Ø­ØªÙ‰ ÙŠØµÙŠØ± Ø£Ù†Ø¹Ù… */
  background-clip: content-box;
  box-shadow: 0 4px 10px rgba(0,0,0,.15);
}

body:hover::-webkit-scrollbar-track,
.palette-body:hover::-webkit-scrollbar-track,
.table-wrap:hover::-webkit-scrollbar-track,
.invoices-list:hover::-webkit-scrollbar-track,
#importedPdfList:hover::-webkit-scrollbar-track,
.cat-list:hover::-webkit-scrollbar-track,
#autocompleteSuggestions:hover::-webkit-scrollbar-track {
  background: transparent;                  /* Ù…Ø³Ø§Ø± Ø´ÙØ§Ù */
}

/* 4) Ø¶Ù…Ø§Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø§Øª RTL (Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹)
   Ø¥Ø°Ø§ Ø´ÙØª Ø£ÙŠ Ø­Ø§ÙˆÙŠØ© ØªØªØµØ±Ù ÙˆØªØ·Ù„Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© ÙŠØ³Ø§Ø±ØŒ Ø£Ø¹Ø·Ù‡Ø§ Ù‡Ø§Ù„ÙƒÙ„Ø§Ø³: .rtl-scroll */
.rtl-scroll { direction: rtl; }             /* ÙŠØ¨Ù‚ÙŠ Ø§Ù„Ø³Ù‘ÙƒØ±ÙˆÙ„ ÙŠÙ…ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ù…Ø§ ÙŠØºÙŠÙ‘Ø± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø© */




/* Ø¥Ø®ÙØ§Ø¡ Ø£Ø³Ù‡Ù… number ÙÙŠ ÙƒØ±ÙˆÙ…/Ø¥Ø¯Ø¬/Ø³ÙØ§Ø±ÙŠ */
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button{
  -webkit-appearance: none;
  margin: 0;
}
/* Ø¥Ø®ÙØ§Ø¡Ù‡Ø§ ÙÙŠ ÙØ§ÙŠØ±ÙÙˆÙƒØ³ */
input[type="number"]{
  -moz-appearance: textfield;
}







/* ===== Command Palette: Graphite + Royal Gold ===== */
.palette .group-title{
  background: linear-gradient(180deg, #17191f, #12141a);
  color:#f3e8c8;                  /* Ø°Ù‡Ø¨Ù€ÙŠ ÙØ§ØªØ­ Ù„Ù„Ø¹Ù†ÙˆØ§Ù† */
  border-left-color:#d4b25e;      /* Ø°Ù‡Ø¨Ù€ÙŠ */
}

/* ØµÙ Ø§Ù„Ø¹Ù†ØµØ± */
.palette .item-row{
  background: linear-gradient(180deg,#14171d,#0f1217);
  color:#e9edf6;
  border:1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
  transition: transform .08s ease, border-color .2s ease, background .25s ease;
}
.palette .item-row:hover{
  border-color: rgba(212,178,94,.55); /* Ø¥Ø¨Ø±Ø§Ø² Ø°Ù‡Ø¨ÙŠ */
  background: linear-gradient(180deg,#171b22,#11151b);
}
.palette .item-row:focus-within{
  border-color:#d4b25e;
  box-shadow: 0 0 0 2px rgba(212,178,94,.25);
}

/* Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
.palette .item-row .name{ color:#f4f6fb; }
.palette .item-row .note{ color:#b9c0cf; }

/* Ø­Ù‚Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© */
.palette .item-row input.qty{
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.16);
  color:#f4f6fb;
}
.palette .item-row input.qty:focus{
  border-color:#d4b25e;
  box-shadow:0 0 0 3px rgba(212,178,94,.22);
}

/* Ø²Ø± Ø§Ù„Ø­Ø°Ù â€“ Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† Ø£Ù†ÙŠÙ‚ */
.palette .item-row .del{
  background: linear-gradient(45deg,#b23b3b,#902e2e);
  color:#fff; border:none;
}
.palette .item-row .del:hover{
  transform: translateY(-2px);
  filter: brightness(1.06);
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ */
.palette .item-row .chk{
  accent-color:#d4b25e;   /* Ø°Ù‡Ø¨Ù€ÙŠ Ù„Ù„Ù†Ù‚Ø± */
}


    

/* ===== System Modal â€¢ Responsive & A11y Upgrades ===== */
:root{
  /* Ø­Ø¬Ù… Ø§Ù„Ø­Ù„Ù‚Ø©/Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© ÙŠØªØ£Ù‚Ù„Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ */
  --sys-ring: clamp(120px, 22vw, 180px);
  /* Ø£Ø­Ø¬Ø§Ù… Ù†Øµ Ù…Ø±Ù†Ø© */
  --sys-title-size: clamp(16px, 2.4vw, 20px);
  --sys-sub-size:   clamp(12px, 1.6vw, 14px);
  --sys-step-size:  clamp(11px, 1.5vw, 13px);
}

/* Ø§Ù„Ù†Ø§ÙØ°Ø©: ØªØªÙƒÙŠÙ‘Ù Ø¹Ø±Ø¶Ù‹Ø§ ÙˆØ§Ø±ØªÙØ§Ø¹Ù‹Ø§ + Ù‚Ø§Ø¨Ù„ÙŠØ© ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ÙŠØ© */
.sys-window{
  width: min(700px, 92vw);
  max-height: 92vh;              /* Ù…Ø§ ØªØ·Ù„Ø¹ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø´Ø§Ø´Ø© */
  overflow: auto;                /* Ø³ÙƒÙˆÙ„ Ø¯Ø§Ø®Ù„ÙŠ Ø¹Ù†Ø¯ ØµÙØºÙØ± Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
  padding: clamp(14px, 2.4vh, 22px) clamp(12px, 2.4vw, 18px);
}

/* Ø¯Ø¹Ù… Ø´Ø§Ø´Ø§Øª ÙˆØ§Ø³Ø¹Ø© Ø¬Ø¯Ù‹Ø§: ØªÙƒØ¨Ø± Ø´ÙˆÙŠ */
@media (min-width: 1400px){
  .sys-window{ width: min(820px, 70vw); }
}

/* Ø§Ù„Ù‡ÙŠØ±Ùˆ + Ø§Ù„ØªÙŠØ¨ÙˆØºØ±Ø§ÙÙŠØ§ Ù…Ø±Ù†Ø© */
.sys-headings .sys-title{ font-size: var(--sys-title-size); }
.sys-headings .sys-sub{   font-size: var(--sys-sub-size);   }

.sys-steps.row .sys-step{
  font-size: var(--sys-step-size);
  padding: clamp(6px, 1.2vh, 8px) clamp(10px, 1.2vw, 12px);
}

/* Ø§Ù„Ø­Ù„Ù‚Ø© ØªØªØ¨Ø¹ Ù…ØªØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… */
.ring{ width: var(--sys-ring); height: var(--sys-ring); }
.ring-svg{ width: var(--sys-ring); height: var(--sys-ring); }
.ring-percent{ font-size: clamp(13px, 1.7vw, 16px); }

/* Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ø®ØªÙŠØ§Ø±ÙŠ (Ø¥Ù† Ø£Ø¶ÙØªÙ‡) ÙŠØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ */
.sys-close{ width: 42px; height: 42px; }

/* Ø¹Ù†Ø¯ ØµÙØºÙØ± Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø£ÙÙ‚ÙŠ Ù…Ø«Ù„Ø§Ù‹) */
@media (max-height: 560px){
  .sys-window{
    max-height: 96vh;
    padding: 10px 12px;
  }
  .sys-steps.row{ gap: 6px; }
}

/* Ù„Ùˆ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø§ ÙŠØ¯Ø¹Ù… blurØŒ Ù†Ø®Ù„ÙŠ Ø®Ù„ÙÙŠØ© Ø£ÙƒØ«Ø± Ù‚ØªØ§Ù…Ø© */
@supports not ((backdrop-filter: blur(10px)) or (-webkit-backdrop-filter: blur(10px))){
  .sys-overlay{
    background: rgba(10,11,14,.85);
  }
}

/* ØªØ¨Ø§ÙŠÙ† Ø£ÙØ¶Ù„ Ù„Ø­Ø§Ù„Ø© Ø³ÙƒØ§Ù†-Ù„ÙˆÙ† */
@media (prefers-contrast: more){
  .sys-window{ border-color: rgba(255,255,255,.25); }
  .sys-steps.row .sys-step{ border-color: rgba(255,255,255,.3); }
}

/* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©: Ù†Ù„ØºÙŠ Ø§Ù„ØªØ±Ù†Ø²Ø´Ù†Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø© */
@media (prefers-reduced-motion: reduce){
  .sys-overlay, .sys-window, .ring-check, .ring-percent,
  .sys-steps.row, .ring-svg .progress{
    animation: none !important;
    transition: none !important;
  }
}




/* ØµÙÙŠÙ† Ù…ØªØ³Ø§ÙˆÙŠÙŠÙ†: Ø§Ù„Ø¹Ø¯Ø¯ + Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
.line-qty-note{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: stretch;
}

/* ØµÙ Ø§Ù„Ø£Ø²Ø±Ø§Ø±: Ø­ÙØ¸ + Ø·Ø¨Ø§Ø¹Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© + PDF */
.line-actions{
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* 3 Ø£Ø²Ø±Ø§Ø± Ù…ØªØ³Ø§ÙˆÙŠØ© */
  gap: 12px;
  align-items: stretch;
}

.line-qty-note .ginput,
.line-actions .btn{
  min-width: 0; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙ…Ø¯Ø¯ Ø§Ù„Ø²Ø§ÙŠØ¯ */
}





  </style>
</head>
<body>
  
  

  
  
  
  
  <div id="maintenanceOverlay" class="maint-overlay" style="display:none;">
  <div class="maint-card">
    <div class="maint-spin"></div>
    <h2>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
    <p>Ù†Ø±Ø¬Ø¹Ù„Ùƒ Ø­Ø§Ù„Ø§Ù‹.. Ø´ÙƒØ±Ø§Ù‹ Ù„ØµØ¨Ø±Ùƒ ğŸ’™</p>
  </div>
</div>
  
  
  

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (ØªØ­Ø¯ÙŠØ«/Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„/Ù…Ø¹Ù„ÙˆÙ…Ø©) -->
<div id="systemModal" class="sys-overlay" aria-hidden="true">
  <div class="sys-window" role="dialog" aria-modal="true" aria-live="polite">
   

    <div class="sys-hero">
  <div class="ring">
    <svg viewBox="0 0 120 120" class="ring-svg" aria-hidden="true">
      <circle class="track" cx="60" cy="60" r="52" />
      <circle class="progress" cx="60" cy="60" r="52" />
    </svg>

    <div class="ring-core">
      <!-- Ø­Ø°Ù brand-dot Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ -->
      <div class="ring-percent" id="sysPct">0%</div>
      <div class="ring-check" id="sysCheck" aria-hidden="true">
        <i class="fa-solid fa-check"></i>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ØªØ­Øª Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© -->
  <div class="sys-headings">
    <div class="sys-title" id="sysTitle">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
    <div class="sys-sub" id="sysSub">Ù†Ø­Ø¶Ù‘Ø± Ù„Ùƒ ÙƒÙ„ Ø´ÙŠØ¡â€¦</div>
  </div>

  <!-- Ø§Ù„Ø®Ø·ÙˆØ§Øª: ØµÙ ÙˆØ§Ø­Ø¯ ØªØ­Øª Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© -->
  <div class="sys-steps row" id="sysSteps" role="status"></div>
</div>

    
  </div>
</div>


  <!-- ====== Header ====== -->
  <header class="app-header">
    <div class="head-wrap">
      <div class="brand">
  <div class="badge">A</div>
  <span style="font-weight:700; font-size:18px;">ASSAL OFFICE</span>
</div>

      <div class="head-actions">
  <button class="icon-btn" id="btnReload" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©"><i class="fa-solid fa-rotate-right"></i></button>

  <!-- Ø²Ø± ØªØµØ¯ÙŠØ± JSON ÙÙ‚Ø· -->
 <button class="icon-btn" id="btnExportJSON" title="ØªØµØ¯ÙŠØ± Excel">
  <i class="fa-solid fa-file-excel"></i>
  </button>
  
  
  <button class="icon-btn" id="btnExportCSV" title="ØªØµØ¯ÙŠØ± CSV">
  <i class="fa-solid fa-file-csv"></i>
</button>

<button class="icon-btn" id="btnCommand" title="Ù„ÙˆØ­Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>


</div>



    </div>
  </header>
  
  
  
  
  
  <div id="paletteOverlay" class="palette-overlay" aria-hidden="true">
  <div class="palette" role="dialog" aria-modal="true">
    <div class="palette-top">
      
      
      
      
     <div class="palette-search">
  <i class="fa-solid fa-magnifying-glass" style="color:#21d4fd;"></i>
  <input id="palSearch" type="text" placeholder="Ø§Ø¨Ø­Ø« Ù‡Ù†Ø§ Ø¹Ù† Ø§ÙŠ Ù…Ø§Ø¯Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ø¨Ø§Ø´Ø±" />
  <button id="palClear" class="search-clear" title="Ù…Ø³Ø­" aria-label="Ù…Ø³Ø­">
    <i class="fa-solid fa-xmark"></i>
  </button>
</div>

      
      
      
      
    <div class="palette-actions">
  <button class="btn amber icon" id="palBulkDel" title="Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯" aria-label="Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯">
    <i class="fa-regular fa-trash-can"></i>
  </button>
  <button class="btn blue icon" id="palClose" title="Ø¥ØºÙ„Ø§Ù‚" aria-label="Ø¥ØºÙ„Ø§Ù‚">
    <i class="fa-solid fa-xmark"></i>
  </button>
</div>

    </div>

    <div class="palette-body" id="palList">
      <!-- ÙŠÙÙˆÙ„Ø¯ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>

   <div class="palette-foot">
  <div class="foot-note">ØªØ­Ø¯ÙŠØ« Ø­ÙŠÙ‘ â€” Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ ÙŠÙØ­ÙØ¸ ÙÙˆØ±Ù‹Ø§ ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹</div>
</div>

    
    
    
  </div>
</div>

  
  
  
  
  <!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø© -->
<div id="confirmModal" class="auth-overlay">
  <div class="auth-card" style="text-align:center;">
    <h3 style="margin:0 0 6px 0;">Ø§Ù„Ù…Ø§Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„</h3>
    <p style="margin:0 0 14px 0; color:#aab0c0;">Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø¯ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŸ</p>
    <div style="display:flex; gap:10px; justify-content:center;">
      <button id="confirmYes" class="btn green"><i class="fa-solid fa-check"></i> Ù†Ø¹Ù…</button>
      <button id="confirmNo" class="btn amber"><i class="fa-solid fa-xmark"></i> Ù„Ø§</button>
    </div>
  </div>
</div>




<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div id="deleteInvoiceModal" class="auth-overlay" aria-hidden="true">
  <div class="auth-card" role="dialog" aria-modal="true" style="text-align:center;">
    <h3 style="margin:0 0 6px 0;">Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ</h3>
    <p style="margin:0 0 14px 0; color:#aab0c0;">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø².</p>
    <div style="display:flex; gap:10px; justify-content:center;">
      <button id="delInvYes" class="btn green"><i class="fa-solid fa-check"></i> Ù†Ø¹Ù…</button>
      <button id="delInvNo"  class="btn amber"><i class="fa-solid fa-xmark"></i> Ù„Ø§</button>
    </div>
  </div>
</div>



<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div id="renameInvoiceModal" class="auth-overlay" aria-hidden="true">
  <div class="auth-card" role="dialog" aria-modal="true" style="text-align:center;">
    <h3 style="margin:0 0 6px 0;">Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
    <p style="margin:0 0 10px 0; color:#aab0c0;">Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸</p>
    <input id="renameInvInput" class="gfield" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©"
           style="text-align:center; margin-bottom:12px;" />
    <div style="display:flex; gap:10px; justify-content:center;">
      <button id="renameInvYes" class="btn green"><i class="fa-solid fa-check"></i> Ø­ÙØ¸</button>
      <button id="renameInvNo"  class="btn amber"><i class="fa-solid fa-xmark"></i> Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>




<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª -->
<div id="mergeConfirmModal" class="auth-overlay" aria-hidden="true">
  <div class="auth-card" role="dialog" aria-modal="true" style="text-align:center;">
    <h3 style="margin:0 0 6px 0;">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ù…ØªØ´Ø§Ø¨Ù‡Ø©</h3>
    <p id="mergeDupMsg" style="margin:0 0 14px 0; color:#aab0c0;">
      Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ø£Ø®Ø° <b>Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©</b> Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªØ´Ø§Ø¨Ù‡Ø©ØŸ
    </p>
    <div style="display:flex; gap:10px; justify-content:center;">
      <button id="mergeYes" class="btn green"><i class="fa-solid fa-check"></i> Ù†Ø¹Ù…ØŒ Ø¯Ù…Ø¬</button>
      <button id="mergeNo"  class="btn amber"><i class="fa-solid fa-xmark"></i> ØªØ±Ø§Ø¬Ø¹</button>
    </div>
  </div>
</div>


  
  
  
  
  

  <!-- ====== Layout ====== -->
  <main class="layout">

    <!-- ====== Sidebar ====== -->
    <aside class="sidebar" id="sidebar">
      <div class="panel-title">
  <h3><i class="fa-regular fa-folder-open"></i> Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>

  <!-- Ø²Ø± Ø§Ø³ØªÙŠØ±Ø§Ø¯ + Ù…ÙÙ„ØªÙ‚Ø· Ù…Ù„Ù Ù…Ø®ÙÙŠ -->
  <div style="display:flex; gap:8px;">
    <button class="icon-btn" id="btnImportPrev" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙØ§ØªÙˆØ±Ø© (Excel/CSV)">
      <i class="fa-solid fa-file-arrow-down"></i>
    </button>
    <input id="prevImportPicker" type="file"
           accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.csv,text/csv"
           style="display:none;">
  </div>
</div>
    

      <!-- Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ù†ÙØ³ Ø§Ù„Ù€ id Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„ÙƒÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙŠØ·) -->
      <div class="invoices-list" id="invoicesDropdown"></div>
    </aside>
    
    
    
        <!-- ====== Sidebar Ù…Ø³ØªÙ‚Ù„ (Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© PDF) ====== -->
    <aside class="sidebar" id="importedSidebar">
    <div class="panel-title">
  <h3><i class="fa-solid fa-file-import"></i>Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©</h3>
  <div style="display:flex; gap:8px;">
    <button class="icon-btn" id="btnImportPDF" title="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª">
      <i class="fa-solid fa-download"></i>
    </button>

    <!-- PDF: Ù†ÙØ³ Ø§Ù„Ø²Ø± Ø¨Ø³ Ø¨Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø£ÙˆØ¶Ø­ -->
    <button class="icon-btn" id="btnMergePDF" title="Ø¯Ù…Ø¬ (PDF Ù…Ø±ØªØ¨)">
      <i class="fa-regular fa-file-pdf"></i>
    </button>

    <!-- Ø¬Ø¯ÙŠØ¯: Ø¯Ù…Ø¬ ÙˆØªØµØ¯ÙŠØ± CSV -->
    <button class="icon-btn" id="btnMergeCSV" title="Ø¯Ù…Ø¬ (CSV)">
      <i class="fa-solid fa-file-csv"></i>
    </button>
  </div>
</div>


      <div id="importedPdfList" class="invoices-list"></div>
     <input id="pdfFilePicker" type="file"
  accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.csv,text/csv"
  multiple style="display:none;">

    </aside>

    
    
    
    

    <!-- ====== Content ====== -->
    <section class="content">


      <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
      <div class="card" style="display:flex; align-items:center; gap:12px;">
        <i class="fa-regular fa-file-lines" style="font-size:28px; color:#21d4fd;"></i>
        <div>
          <div style="font-weight:800; letter-spacing:.2px;">ÙØ§ØªÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ©</div>
          <div style="color:var(--muted); font-size:12px;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="invoiceId">-</span></div>
        </div>
      </div>

      <!-- Ù…Ø­Ø±Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
      <div class="card">
        <div class="title"><span><i class="fa-solid fa-pen-to-square"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</span><span class="muted">Editor</span></div>

       <div class="editor">

  <!-- Ø§Ù„ØµÙ†Ù -->
  <div class="category">
    <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
    <div class="cat-select" id="catSelect">
      <div class="cat-btn" id="catBtn">
        <span id="catText"><i class="fa-solid fa-layer-group"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù</span>
        <i class="fa-solid fa-chevron-down"></i>
      </div>

      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù -->
      <div class="cat-list" id="catList">
  <div class="cat-item" data-val="LCD"><i class="fa-solid fa-tv"></i> Ø´Ø§Ø´Ø§Øª</div>
  <div class="cat-item" data-val="BATTERY"><i class="fa-solid fa-bolt"></i> Ø¨Ø·Ø§Ø±ÙŠØ§Øª</div>
  <div class="cat-item" data-val="CAMERA"><i class="fa-solid fa-camera"></i> ÙƒØ§Ù…ÙŠØ±Ø§Øª</div>
  <div class="cat-item" data-val="CHARGING"><i class="fa-solid fa-plug"></i> Ø´Ø­Ù†</div>
  <div class="cat-item" data-val="SPEAKER"><i class="fa-solid fa-headphones"></i> Ø³Ù…Ø§Ø¹Ø©</div>
  <div class="cat-item" data-val="HOUSING"><i class="fa-solid fa-border-none"></i> Ø´ÙˆØ§ØµÙŠ</div>
  <div class="cat-item" data-val="BACK"><i class="fa-solid fa-mobile-screen"></i> Ø£Ø¸Ù‡Ø±</div>
  <div class="cat-item" data-val="BUZZER"><i class="fa-solid fa-bell"></i> Ø¬Ø±Ø³</div>
  <div class="cat-item" data-val="FINGER"><i class="fa-solid fa-fingerprint"></i> Ø¨ØµÙ…Ø©</div>

  <!-- Ø§Ù„ØµÙ†Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ -->
  <div class="cat-item" data-val="FLAT LCD"><i class="fa-solid fa-film"></i> ÙÙ„Ø§Øª Ø´Ø§Ø´Ø©</div>
  <div class="cat-item" data-val="POWER"><i class="fa-solid fa-charging-station"></i> ÙÙ„Ø§Øª Ø¨ÙˆØ±</div>
  <div class="cat-item" data-val="VOLUME"><i class="fa-solid fa-sliders"></i> ÙÙ„Ø§Øª ØµÙˆØª</div>

  <div class="cat-item" data-val="LENS"><i class="fa-solid fa-bullseye"></i> Ø¹Ø¯Ø³Ø© ÙƒØ§Ù…ÙŠØ±Ø§</div>


  <div class="cat-item" data-val="NO-CATEGORY"><i class="fa-regular fa-square"></i> Ø¨Ø¯ÙˆÙ† ØµÙ†Ù</div>
</div>

    </div>

    <!-- Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ -->
    <input id="categorySelect" type="hidden" />
  </div>

  <!-- Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© -->
  <div class="ginput">
    <div style="position:relative;">
      
      
   <input id="searchInput" class="gfield" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©..." 
       lang="en" style="ime-mode:disabled;" oninput="showSuggestions()" />
     
     
     
      <ul id="autocompleteSuggestions"></ul>
    </div>
  </div>

  <!-- Ø§Ù„Ø¹Ø¯Ø¯ + Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†ÙØ³ Ø§Ù„ØµÙ ÙˆÙ…ØªØ³Ø§ÙˆÙŠ -->
<div class="line-qty-note">
  <div class="ginput">
   <input id="itemQty" class="gfield" type="number" inputmode="numeric" pattern="\d*"
       min="1" step="1" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹" />

  </div>
  <div class="ginput">
    <input id="itemNote" class="gfield" type="text" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" />
  </div>
</div>


  <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„ÙˆØ­Ø¯Ù‡ -->
<div class="ginput">
  <button id="btnAddItem" class="btn" type="button" onclick="addItem()">
    <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ©
  </button>
</div>

<!-- Ø­ÙØ¸ + Ø·Ø¨Ø§Ø¹Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© + PDF Ø¨Ù†ÙØ³ Ø§Ù„ØµÙ -->
<div class="line-actions">
  <!-- ÙŠØ¨Ù‚Ù‰ Ù…Ø«Ù„ Ù…Ø§ Ù‡Ùˆ ğŸ”’ -->
  <button class="btn green" type="button" onclick="saveInvoice()">
    <i class="fa-regular fa-floppy-disk"></i> Ø­ÙØ¸
  </button>

  <!-- Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
  <button class="btn amber" type="button" onclick="printInvoiceHTML()">
    <i class="fa-solid fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ©
  </button>

  <!-- Ù†ÙØ³ Ø²Ø± Ø§Ù„Ù€ PDF Ø§Ù„Ù‚Ø¯ÙŠÙ… âœ… -->
  <button class="btn blue" type="button" onclick="exportPDF()">
    <i class="fa-regular fa-file-pdf"></i> PDF
  </button>
</div>



      <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
      <div class="card table-wrap">
        <table id="itemsTable">
          <thead>
            <tr>
              <th>Ø§Ù„ØµÙ†Ù</th>
              <th>Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
              <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
              <th>Ø¥Ø²Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </section>
  </main>

  <!-- Ø²Ø± Ø¹Ø§Ø¦Ù… = ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
  <button class="fab" id="fab" title="ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©">
    <i class="fa-solid fa-plus"></i>
  </button>

  <!-- Toast -->
  <div class="toast-container">
    <div class="toast" id="appToast">
      <i class="fa-solid fa-circle-check" style="color:#34d399;"></i>
      <span>ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.</span>
    </div>
  </div>

  <script>
    /* =========================
       Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© (Ù†ÙØ³ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
       ========================= */
    let currentInvoice = null;                                             // Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    let invoices = JSON.parse(localStorage.getItem("invoices") || "[]");   // ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù†Ø©
    let selectedInvoiceIndex = null;                                       // Ù…Ø¤Ø´Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    let database = {};                                                     // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù Ù…Ù† Ø§Ù„Ø¥ÙƒØ³Ù„
    let currentCategory = "";                                              // Ø§Ù„ØµÙ†Ù Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®ØªØ§Ø±
    let importedPdfFiles = [];                                             // Ù…Ù„ÙØ§Øª PDF Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ù…Ø¤Ù‚ØªÙ‹Ø§

    // Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ (Ù†ÙØ³Ùƒ)
  const dropboxMainFile = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSZww_ZDcqXnX6pUjlKccZdFUkRR9Z_JmfmdvNsnGVYT_rq_RTsSB1ydTy6QVrrS_o4s_ml1DNBTnaQ/pub?output=xlsx" + "&t=" + new Date().getTime();




function attachBackdropGuards(modalEl, cardSelector){
  const card = modalEl.querySelector(cardSelector);
  if(!card) return;

  const swallow = (e)=>{
    if(!card.contains(e.target)){         // Ø£ÙŠ Ø­Ø¯Ø« Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙÙ‚Ø·
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation?.();     // ØªØ£ÙƒÙŠØ¯ ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„ÙŠØ³Ù†Ø±Ø§Øª
    }
  };

  modalEl.__swallow = swallow;

  modalEl.addEventListener('touchstart', swallow, { passive:false });
  modalEl.addEventListener('touchmove',  swallow, { passive:false });
  modalEl.addEventListener('pointerdown',swallow, { passive:false });
  modalEl.addEventListener('wheel',      swallow, { passive:false });
  // âœ… Ø¬Ø¯ÙŠØ¯: Ø§Ø¨ØªÙ„Ø§Ø¹ click Ø£ÙŠØ¶Ø§Ù‹ Ø­ØªÙ‰ Ù…Ø§ ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ Ø£ÙŠ ÙƒÙˆØ¯ Ø«Ø§Ù†ÙŠ
  modalEl.addEventListener('click',      swallow, { passive:false });
}

function detachBackdropGuards(modalEl){
  const s = modalEl.__swallow;
  if(!s) return;
  modalEl.removeEventListener('touchstart', s, { passive:false });
  modalEl.removeEventListener('touchmove',  s, { passive:false });
  modalEl.removeEventListener('pointerdown',s, { passive:false });
  modalEl.removeEventListener('wheel',      s, { passive:false });
  // âœ… Ø¬Ø¯ÙŠØ¯: Ø¥Ø²Ø§Ù„Ø© click
  modalEl.removeEventListener('click',      s, { passive:false });
  delete modalEl.__swallow;
}



/* ===== System Modal Controller (Ø¬Ø¯ÙŠØ¯) ===== */
function createSystemController(){
  const modal = document.getElementById("systemModal");
  const title = document.getElementById("sysTitle");
  const sub   = document.getElementById("sysSub");
  const pctEl = document.getElementById("sysPct");
  const check = document.getElementById("sysCheck");
  const stepsHost = document.getElementById("sysSteps");
  const ring  = modal.querySelector(".ring-svg .progress");
  const CIRC  = 2 * Math.PI * 52;

  let steps = [];
  let activeIdx = -1;

  function show(){
    modal.classList.add("show");
    modal.setAttribute("aria-hidden", "false");
    document.body.classList.add("body-no-scroll");
    attachBackdropGuards(modal, ".sys-window");
  }
  function hide(){
    modal.classList.remove("show");
    modal.setAttribute("aria-hidden", "true");
    document.body.classList.remove("body-no-scroll");
    detachBackdropGuards(modal);
  }

  function renderSteps(){
    stepsHost.innerHTML = "";
    steps.forEach((s, i)=>{
      const el = document.createElement("div");
      el.className = "sys-step" + (i < activeIdx ? " done" : (i === activeIdx ? " active" : ""));
      el.innerHTML = `
        <div class="dot"></div>
        <div>${s.label}${s.hint ? ` <small>â€¢ ${s.hint}</small>` : ""}</div>
      `;
      stepsHost.appendChild(el);
    });
  }

  return {
    // ğŸ”„ Ø¨Ø¯ÙˆÙ† primaryText/primaryAction
    open({titleText, subText, stepsList = []} = {}){
      title.textContent = titleText || "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«";
      sub.textContent   = subText   || "";
      check.classList.remove("show");

      // Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ù†Ø³Ø¨Ø© Ø¸Ø§Ù‡Ø±Ø©
      pctEl.classList.remove("is-hidden");
      pctEl.textContent = "0%";

      // ØµÙØ± Ø§Ù„Ø­Ù„Ù‚Ø©
      ring.style.strokeDasharray  = CIRC;
      ring.style.strokeDashoffset = CIRC;

      // Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¥Ù† ÙƒØ§Ù†Øª Ù…Ø®ÙÙŠØ©
      stepsHost.style.removeProperty("display");
      stepsHost.style.opacity = "1";
      stepsHost.style.transform = "translateY(0)";

      steps = stepsList;
      activeIdx = steps.length ? 0 : -1;
      renderSteps();
      show();
    },

    setStep(i){
      activeIdx = Math.max(0, Math.min(i, steps.length - 1));
      renderSteps();
    },

    setProgress(p){
      const clamped = Math.max(0, Math.min(100, p|0));
      pctEl.textContent = clamped + "%";
      const off = CIRC * (1 - clamped/100);
      ring.style.strokeDashoffset = off;
    },

    setText({titleText, subText}={}){
      if(titleText != null) title.textContent = titleText;
      if(subText   != null) sub.textContent   = subText;
    },

    // âœ… ØªØ³Ù„Ø³Ù„ Ø£Ù†ÙŠÙ‚ Ø¹Ù†Ø¯ 100%:
    // 1) Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ù‚Ù…  2) Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµØ­  3) Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø·ÙˆØ§Øª  4) ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
    success({titleText="ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­ âœ…", subText="Ø´ÙƒØ±Ù‹Ø§ Ù„ØµØ¨Ø±ÙƒÙ… ğŸ’™"} = {}){
      this.setProgress(100);

      // (1) Ø£Ø®ÙÙ Ø§Ù„Ø±Ù‚Ù…
      pctEl.classList.add("is-hidden");

      // (2) Ø¨Ø¹Ø¯ Ù„Ù…Ø­Ø© Ù‚ØµÙŠØ±Ø©ØŒ Ø£Ø¸Ù‡Ø± Ø§Ù„ØµØ­
      setTimeout(()=>{ check.classList.add("show"); }, 150);

      // (3) Ø§Ø·Ù…Ø³ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨Ø³Ù„Ø§Ø³Ø©
      stepsHost.style.transition = "opacity .28s ease, transform .28s ease";
      requestAnimationFrame(()=>{
        stepsHost.style.opacity = "0";
        stepsHost.style.transform = "translateY(-4px)";
      });

      // (4) Ø¨Ø¹Ø¯ Ø·Ù…Ø³ Ø§Ù„Ø®Ø·ÙˆØ§ØªØŒ Ø£Ø®ÙÙ‡Ø§ ÙˆØ­Ø¯Ù‘Ø« Ø§Ù„Ù†ØµÙˆØµ
      setTimeout(()=>{
        stepsHost.style.display = "none";
        this.setText({ titleText, subText });
      }, 350);
    },

    close: hide
  };
}



/* ===== ØªØ¬Ø±Ø¨Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ===== */
function reloadPage({
  seconds = 4,
  steps = [
    {label:"ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©", hint:"ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ÙƒÙˆÙ‘Ù†Ø§Øª ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø·"},
    {label:"Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", hint:"Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙÙ‘Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©"},
    {label:"Ù„Ù…Ø³Ø§Øª Ø£Ø®ÙŠØ±Ø©",  hint:"ØªØ­Ø³ÙŠÙ†Ø§Øª ÙˆØªØ¬Ù…ÙŠØ¹"}
  ],
  preTitle = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©",
  preSub   = "Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø§Øªâ€¦",
  postTitle= "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…",
  postSub  = "Ù†Ø£Ø®Ø°Ùƒ Ù„Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ù„Ø¢Ù†â€¦"
} = {}){
  const ctl = createSystemController();
  let p = 0;
  let idx = 0;

 ctl.open({
  titleText: preTitle,
  subText:  preSub,
  stepsList: steps
});


  const totalMs = seconds * 1000;
  const tick    = 80;
  const perTick = 100 / (totalMs / tick);

  const timer = setInterval(()=>{
    p = Math.min(100, p + perTick);
    ctl.setProgress(Math.round(p));

    const stepSize = 100 / Math.max(steps.length, 1);
    const newIdx = Math.min(steps.length - 1, Math.floor(p / stepSize));
    if(newIdx !== idx){ idx = newIdx; ctl.setStep(idx); }

   if(p >= 100){
  clearInterval(timer);
  ctl.success({ titleText: postTitle, subText: postSub });
  setTimeout(()=> window.location.reload(), 1500);
}
  }, tick);
}

/* Ø²Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± */
document.getElementById("btnReload")?.addEventListener("click", ()=>{
  reloadPage({
    seconds: 4,
    preTitle: "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©",
    preSub:   "Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø§Øªâ€¦",
    postTitle:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­ âœ…",
    postSub:  "Ù†Ø£Ø®Ø°Ùƒ Ù„Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ù„Ø¢Ù†â€¦"
  });
});










    /* =========================
       ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¥ÙƒØ³Ù„
       ========================= */
    async function loadExcelFiles(){
      try{
        const response = await fetch(dropboxMainFile, { cache: 'no-store' });
        const buffer = await response.arrayBuffer();
        const workbook = XLSX.read(buffer, { type:"array" });
        database = {
          LCD      : XLSX.utils.sheet_to_json(workbook.Sheets["LCD"]      || {}, {defval:null}),
          BATTERY  : XLSX.utils.sheet_to_json(workbook.Sheets["BATTERY"]  || {}, {defval:null}),
          HOUSING  : XLSX.utils.sheet_to_json(workbook.Sheets["HOUSING"]  || {}, {defval:null}),
          BACK     : XLSX.utils.sheet_to_json(workbook.Sheets["BACK"]     || {}, {defval:null}),
          CAMERA   : XLSX.utils.sheet_to_json(workbook.Sheets["CAMERA"]   || {}, {defval:null}),
          CHARGING : XLSX.utils.sheet_to_json(workbook.Sheets["CHARGING"] || {}, {defval:null}),
          BUZZER   : XLSX.utils.sheet_to_json(workbook.Sheets["BUZZER"]   || {}, {defval:null}),
          SPEAKER : XLSX.utils.sheet_to_json(workbook.Sheets["SPEAKER"]|| {}, {defval:null}),
          FINGER   : XLSX.utils.sheet_to_json(workbook.Sheets["FINGER"]   || {}, {defval:null}),
          "FLAT LCD"   : XLSX.utils.sheet_to_json(workbook.Sheets["FLAT LCD"]   || {}, {defval:null}),
          POWER   : XLSX.utils.sheet_to_json(workbook.Sheets["POWER"]   || {}, {defval:null}),
          VOLUME   : XLSX.utils.sheet_to_json(workbook.Sheets["VOLUME"]   || {}, {defval:null}),
          LENS   : XLSX.utils.sheet_to_json(workbook.Sheets["LENS"]   || {}, {defval:null})
          
        };
      }catch(err){
        console.error("âŒ Ø®Ø·Ø£ ØªØ­Ù…ÙŠÙ„:", err);
        showToast("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âŒ", true);
      }
    }

    /* =========================
       Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
       ========================= */
       
       
       // ===== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ =====
function isPositiveInt(v){
  // Ù†Ù‚Ø¨Ù„ "001" Ø¨Ø³ Ù†Ø­ÙˆÙ„Ù‡ Ø±Ù‚Ù… ØµØ­ÙŠØ­ > 0
  const s = String(v ?? "").trim();
  if(!/^\d+$/.test(s)) return false;
  return parseInt(s, 10) > 0;
}

// ÙÙˆÙƒØ³ + ØªØ­Ø¯ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰
function focusAndSelect(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.focus();
  setTimeout(()=> el.select && el.select(), 0);
}

/**
 * ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© + Ø§Ù„Ø¹Ø¯Ø¯
 * @param {string} ctx Ø³ÙŠØ§Ù‚ Ø§Ù„ØªØ­Ù‚Ù‚ (add/save/enter) Ù„Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
 * @returns {boolean} ØµØ§Ù„Ø­/ØºÙŠØ± ØµØ§Ù„Ø­
 */
function validateItemFields(ctx="add"){
  const name = document.getElementById("searchInput").value.trim();
  const qty  = document.getElementById("itemQty").value.trim();

  // Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
  if(!name){
    showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© âŒ", true);
    focusAndSelect("searchInput");
    return false;
  }

  // Ø§Ù„Ø¹Ø¯Ø¯
  if(!qty){
    showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø¯Ø¯ âŒ", true);
    focusAndSelect("itemQty");
    return false;
  }
  if(!isPositiveInt(qty)){
    showToast("Ø¥Ø¯Ø®Ø§Ù„ Ø®Ø§Ø·Ø¦ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… ØµØ­ÙŠØ­ (1 ÙØ£Ø¹Ù„Ù‰) âŒ", true);
    focusAndSelect("itemQty");
    return false;
  }

  return true;
}

       
       
       
       
       
    function normalizeString(str){ return (str||"").replace(/\s+/g,'').toLowerCase(); }
    
    
    function escapeHtml(s){
  return String(s ?? "")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#39;");
}


    function getDayNameAr(d){
      return ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"][d.getDay()];
    }

    function formatInvoiceName(){
      const d = new Date();
      return `ÙØ§ØªÙˆØ±Ø© ${getDayNameAr(d)} - ${d.toLocaleDateString("ar-EG")}`;
    }

    /* =========================
       Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù
       ========================= */
  function showSuggestions(){
  const q = normalizeString(document.getElementById("searchInput").value.trim());
  const suggestions = document.getElementById("autocompleteSuggestions");
  suggestions.innerHTML = ""; 
  suggestions.style.display = "none";

  if(!q || !document.getElementById("categorySelect").value) return;
  currentCategory = document.getElementById("categorySelect").value;
  if(currentCategory === "NO-CATEGORY") return;

  const list = database[currentCategory] || [];
  const filtered = list.filter(it=>{
    const name = normalizeString(it["Item Name"] || it["Item"] || "");
    return name.includes(q);
  });

  if(filtered.length > 0){
    suggestions.style.display = "block";
    filtered.slice(0,20).forEach(it=>{
      const li = document.createElement("li");
      li.className = "list-group-item list-group-item-action";
      li.textContent = it["Item Name"] || it["Item"];

      // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ ğŸ‘‡
      li.addEventListener("click", ()=>{
        document.getElementById("searchInput").value = li.textContent;
        suggestions.style.display = "none";
        document.getElementById("itemQty").focus(); // ÙŠÙ†Ø²Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø¯
      });

      suggestions.appendChild(li);
    });
  }
}


    /* =========================
       Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ù„Ù„ÙØ§ØªÙˆØ±Ø©
       ========================= */
  function addItem(){
 if(!currentInvoice){
    showToast("Ø£Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹ âŒ","danger");
    return;
  }

  // âœ… ØªØ­Ù‚Ù‚ ØµØ§Ø±Ù… Ù‚Ø¨Ù„ Ø£ÙŠ Ø´ÙŠØ¡
  if(!validateItemFields("add")) return;

  const category = document.getElementById("categorySelect").value;
  const name     = document.getElementById("searchInput").value.trim();
  const qty      = document.getElementById("itemQty").value.trim() || "1";
  const note     = document.getElementById("itemNote").value.trim() || "";

  if(!category || !name){
    showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„ØµÙ†Ù ÙˆØ§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© âŒ","danger");
    return;
  }

  
// Ù†Ø¹Ø¯Ù‘Ù„Ù‡ Ù„ÙŠØµÙŠØ±: Ù†ÙØ³ Ø§Ù„ØµÙ†Ù + Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… + Ù†ÙØ³ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
const existingIndex = (currentInvoice.items || []).findIndex(
  (it) =>
    it.category === category &&
    it.name === name &&
    (String(it.note || "").trim() === String(note || "").trim())
);


  if(existingIndex !== -1){
    // Ø§ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
    const modal = document.getElementById("confirmModal");
    modal.style.display = "flex";

    // Ù†Ø¹Ù… = Ø¹Ø¯Ù‘Ù„ Ù†ÙØ³ Ø§Ù„Ø³Ø·Ø±
    document.getElementById("confirmYes").onclick = ()=>{
      currentInvoice.items[existingIndex].qty  = qty;
      currentInvoice.items[existingIndex].note = note;

      renderItems();
      autoSaveInvoice();

      modal.style.display = "none";
      showToast("âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©","info");

      // ØªÙØ±ÙŠØº + ÙÙˆÙƒØ³
      document.getElementById("searchInput").value="";
      document.getElementById("itemQty").value="";
      document.getElementById("itemNote").value="";
      document.getElementById("searchInput").focus();
    };

    // Ù„Ø§ = Ø¥ØºÙ„Ø§Ù‚ ÙÙ‚Ø·
    document.getElementById("confirmNo").onclick = ()=>{
      modal.style.display = "none";
    };

  } else {
    // Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
    if(!Array.isArray(currentInvoice.items)) currentInvoice.items = [];
    currentInvoice.items.push({category,name,qty,note});

    renderItems();
    autoSaveInvoice();

    showToast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© âœ…","success");

    // ØªÙØ±ÙŠØº + ÙÙˆÙƒØ³
    document.getElementById("searchInput").value="";
    document.getElementById("itemQty").value="";
    document.getElementById("itemNote").value="";
    document.getElementById("searchInput").focus();
  }
}

    /* =========================
       Ø±Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
       ========================= */
    function renderItems(){
      const tbody = document.querySelector("#itemsTable tbody");
      tbody.innerHTML = "";
      if(!currentInvoice) return;

      currentInvoice.items.forEach((it, i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${it.category}</td>
          <td>${it.name}</td>
          <td>${it.qty}</td>
          <td>${it.note}</td>
          <td>
            <button class="btn-danger-custom" title="Ø­Ø°Ù" onclick="removeItem(${i})">
  <i class="fa-regular fa-trash-can"></i>
</button>

          </td>`;
        tbody.appendChild(tr);
      });
    }

    function removeItem(i){
  currentInvoice.items.splice(i,1);
  renderItems();
  autoSaveInvoice(); // âœ… Ø¥Ø¶Ø§ÙØ©
  showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ—‘ï¸");
}


    /* =========================
       Ø¥Ù†Ø´Ø§Ø¡ / Ø­ÙØ¸ / ÙØªØ­ / Ø­Ø°Ù ÙÙˆØ§ØªÙŠØ±
       ========================= */
       
       
 function newInvoice(){
  const today = new Date().toLocaleDateString("ar-EG");
  const defaultName = formatInvoiceName(); // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: "ÙØ§ØªÙˆØ±Ø© <Ø§Ù„ÙŠÙˆÙ…> - <Ø§Ù„ØªØ§Ø±ÙŠØ®>"

  // Ù†Ø¨Ø­Ø« ÙÙ‚Ø· Ø¹Ù† ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªÙŠ Ù…Ø§ Ø²Ø§Ù„Øª ØªØ­Ù…Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (ÙŠØ¹Ù†ÙŠ ØºÙŠØ± Ù…ÙØ¹Ø§Ø¯ ØªØ³Ù…ÙŠØªÙ‡Ø§)
  const existingIndex = invoices.findIndex(inv => inv.date === today && inv.id === defaultName);

  if(existingIndex !== -1){
    currentInvoice = invoices[existingIndex];
    selectedInvoiceIndex = existingIndex;
    showToast("ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙŠÙˆÙ… Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ âœ…");
  } else {
    // Ù…Ø§ÙƒÙˆ ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ â‡’ Ø£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
    currentInvoice = { id: defaultName, date: today, items: [] };
    invoices.push(currentInvoice);
    selectedInvoiceIndex = invoices.length - 1;
    showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© âœ…");
  }

  document.getElementById("invoiceId").textContent = currentInvoice.id;
  renderItems();
  renderInvoicesDropdown();
}

    
    
    
    
    
    // ===== ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© =====
let __pendingDeleteInvoiceIndex = null;

function openDeleteInvoiceModal(i, ev){
  if(ev) ev.stopPropagation();
  __pendingDeleteInvoiceIndex = i;
  const modal = document.getElementById('deleteInvoiceModal');
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');

  // ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (html + body)
  document.documentElement.classList.add('no-scroll');
  document.body.classList.add('no-scroll');

  // ğŸ›¡ï¸ Ø§Ù…Ù†Ø¹ Ù„Ù…Ø³/Ø³Ø­Ø¨/Ù†Ù‚Ø± Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ ÙˆØ§Ø³Ù…Ø­ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª
  attachBackdropGuards(modal, '.auth-card');

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  document.getElementById('delInvYes').onclick = confirmDeleteInvoice;
  document.getElementById('delInvNo').onclick  = closeDeleteInvoiceModal;
 

  // âŒ Ø§Ø­Ø°Ù Ø³Ø·Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„ÙƒØ§Ø±Øª
  // modal.addEventListener('click', outsideClickClose);

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¨Ù€ ESC â€” Ø§ØªØ±ÙƒÙ‡ Ø£Ùˆ Ø§Ø­Ø°ÙÙ‡ Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ
  document.addEventListener('keydown', escClose);
}









function confirmDeleteInvoice(){
  if(__pendingDeleteInvoiceIndex===null) return;
  // Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ
  invoices.splice(__pendingDeleteInvoiceIndex, 1);
  localStorage.setItem("invoices", JSON.stringify(invoices));

  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø­Ø§Ù„Ø©
  currentInvoice = null;
  selectedInvoiceIndex = null;
  document.getElementById("invoiceId").textContent = "-";
  renderItems();
  renderInvoicesDropdown();

  closeDeleteInvoiceModal();
  showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ—‘ï¸");
}

function closeDeleteInvoiceModal(){
  const modal = document.getElementById('deleteInvoiceModal');
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden','true');
  __pendingDeleteInvoiceIndex = null;

  // ğŸ”“ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
  document.documentElement.classList.remove('no-scroll');
  document.body.classList.remove('no-scroll');

  // ğŸ§¹ ÙÙƒÙ‘ Ø§Ù„Ø­Ø±Ø³
  detachBackdropGuards(modal);

  // âŒ Ù„Ø§ ØªØ²ÙŠÙ„ listener ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ·
  // modal.removeEventListener('click', outsideClickClose);

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¥Ø°Ø§ Ø£Ø¨Ù‚ÙŠØª ESC Ù…ÙØ¹Ù‘Ù„ ÙÙˆÙ‚ØŒ ÙÙƒÙ‘Ù‡ Ù‡Ù†Ø§:
  document.removeEventListener('keydown', escClose);
}



function outsideClickClose(e){
  const card = e.currentTarget.querySelector('.auth-card');
  if(!card.contains(e.target)) closeDeleteInvoiceModal();
}

function escClose(e){
  if(e.key === 'Escape') closeDeleteInvoiceModal();
}

    
    
    
    
    
// ===== Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø© =====
let __pendingRenameInvoiceIndex = null;

function openRenameInvoiceModal(i, ev){
  ev?.stopPropagation?.();
  __pendingRenameInvoiceIndex = i;

  const modal = document.getElementById('renameInvoiceModal');
  const input = document.getElementById('renameInvInput');
  const inv = invoices[i];

  input.value = inv?.id || "";
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');

  // ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ù…Ø«Ù„ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø°Ù)
  document.documentElement.classList.add('no-scroll');
  document.body.classList.add('no-scroll');

  // ğŸ›¡ï¸ Ø§Ù…Ù†Ø¹ Ù„Ù…Ø³/Ø³Ø­Ø¨/Ù†Ù‚Ø± Ø§Ù„Ø®Ù„ÙÙŠØ© â€” ÙˆØ§Ø³Ù…Ø­ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª ÙÙ‚Ø·
  attachBackdropGuards(modal, '.auth-card');

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  document.getElementById('renameInvYes').onclick = confirmRenameInvoice;
  document.getElementById('renameInvNo').onclick  = closeRenameInvoiceModal;

  // Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø±ÙŠØ­
  setTimeout(()=>{
    input.focus();
    input.select?.();
  }, 10);

  // Ø¯Ø¹Ù… Enter/ESC
  document.addEventListener('keydown', renameEscEnterHandler);
}

function confirmRenameInvoice(){
  if(__pendingRenameInvoiceIndex === null) return;

  const input = document.getElementById('renameInvInput');
  const newName = String(input.value || "").trim();

  if(!newName){
    showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ§Ù„Ø­ âŒ", true);
    input.focus(); return;
  }

  // Ø­Ø¯Ù‘Ø« Ø§Ù„Ø§Ø³Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØµÙÙˆÙØ©
  invoices[__pendingRenameInvoiceIndex].id = newName;

  // Ø¥Ø°Ø§ Ù‡ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
  if(selectedInvoiceIndex === __pendingRenameInvoiceIndex && currentInvoice){
    currentInvoice.id = newName;
    document.getElementById("invoiceId").textContent = newName;
  }

  // Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  localStorage.setItem("invoices", JSON.stringify(invoices));
  renderInvoicesDropdown();

  closeRenameInvoiceModal();
  showToast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© âœ…");
}

function closeRenameInvoiceModal(){
  const modal = document.getElementById('renameInvoiceModal');
  modal.style.display = 'none';
  modal.setAttribute('aria-hidden','true');

  // ğŸ”“ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
  document.documentElement.classList.remove('no-scroll');
  document.body.classList.remove('no-scroll');

  // ğŸ§¹ ÙÙƒÙ‘ Ø§Ù„Ø­Ø±Ø³
  detachBackdropGuards(modal);

  // ÙÙƒÙ‘ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯
  document.removeEventListener('keydown', renameEscEnterHandler);

  // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§Ù„Ø©
  __pendingRenameInvoiceIndex = null;
}

function renameEscEnterHandler(e){
  if(e.key === 'Escape'){ e.preventDefault(); closeRenameInvoiceModal(); return; }
  if(e.key === 'Enter'){
    // Ù†ÙÙ‘Ø° Ø­ÙØ¸ Ø¥Ø°Ø§ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…ÙØªÙˆØ­Ø©
    const within = document.getElementById('renameInvoiceModal');
    if(within && within.style.display === 'flex'){
      e.preventDefault();
      confirmRenameInvoice();
    }
  }
}
    
    
    
    
    

    function saveInvoice(){
      if(!currentInvoice) return;
      if(selectedInvoiceIndex !== null){
        invoices[selectedInvoiceIndex] = currentInvoice;
      } else {
        invoices.push(currentInvoice);
      }
      localStorage.setItem("invoices", JSON.stringify(invoices));
      renderInvoicesDropdown();
      showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ’¾");
    }
    
    
    
    function autoSaveInvoice(){
  if(!currentInvoice) return;
  if(selectedInvoiceIndex!==null){
    invoices[selectedInvoiceIndex] = currentInvoice;
  } else {
    invoices.push(currentInvoice);
    selectedInvoiceIndex = invoices.length - 1;
  }
  localStorage.setItem("invoices", JSON.stringify(invoices));
  renderInvoicesDropdown();
}

    
    

   function renderInvoicesDropdown(){
  const wrap = document.getElementById("invoicesDropdown");
  wrap.innerHTML = "";
  invoices.forEach((inv, i)=>{
    const row = document.createElement("div");
    row.className = "invoice-chip";
   row.innerHTML = `
  <div class="chip-meta">
    <strong>${inv.id}</strong>
    <small>${inv.date} â€¢ ${inv.items.length} Ù…Ø§Ø¯Ø©</small>
  </div>
  <div style="display:flex; gap:8px;">
    <button class="btn-rename-custom" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©" aria-label="Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©"
            onclick="openRenameInvoiceModal(${i}, event)">
      <i class="fa-regular fa-pen-to-square"></i>
    </button>
    <button class="btn-danger-custom" title="Ø­Ø°Ù" aria-label="Ø­Ø°Ù"
            onclick="openDeleteInvoiceModal(${i}, event)">
      <i class="fa-regular fa-trash-can"></i>
    </button>
  </div>
`;

    row.onclick = ()=> loadInvoice(i);
    wrap.appendChild(row);
  });
}


    function loadInvoice(i){
      selectedInvoiceIndex = i;
      currentInvoice = invoices[i];
      document.getElementById("invoiceId").textContent = currentInvoice.id;
      renderItems();
      showToast("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ“„");
    }
    

    function deleteInvoice(i){
      invoices.splice(i,1);
      localStorage.setItem("invoices", JSON.stringify(invoices));
      currentInvoice = null;
      document.getElementById("invoiceId").textContent = "-";
      renderItems();
      selectedInvoiceIndex = null;
      renderInvoicesDropdown();
      showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ—‘ï¸");
    }
    
    
    
    
   function openMergeConfirmModal(dupCount, onConfirm){
  const modal = document.getElementById('mergeConfirmModal');
  const msg   = document.getElementById('mergeDupMsg');
  msg.innerHTML = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ <b>${dupCount}</b> Ø§ÙŠØªÙ…Ø§Øª Ù…ØªØ´Ø§Ø¨Ù‡Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ø£Ø®Ø° <b>Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©</b>ØŸ`;

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');

  // ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ù†ÙØ³ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø°Ù)
  document.documentElement.classList.add('no-scroll');
  document.body.classList.add('no-scroll');

  // ğŸ›¡ï¸ Ù…Ù†Ø¹ Ù„Ù…Ø³/Ø³Ø­Ø¨/Ù†Ù‚Ø± Ø§Ù„Ø®Ù„ÙÙŠØ© â€” ÙˆØ§Ù„Ø³Ù…Ø§Ø­ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª ÙÙ‚Ø·
  attachBackdropGuards(modal, '.auth-card');

  const yes = document.getElementById('mergeYes');
  const no  = document.getElementById('mergeNo');

  // Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ­Ù‘Ø¯
  function close(){
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');

    // ğŸ”“ ÙÙƒ Ø§Ù„Ù‚ÙÙ„ Ùˆ Ø§Ù„Ø­Ø§Ø±Ø³
    document.documentElement.classList.remove('no-scroll');
    document.body.classList.remove('no-scroll');
    detachBackdropGuards(modal);

    document.removeEventListener('keydown', esc);
    yes.onclick = null;
    no.onclick  = null;
  }

  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡
  yes.onclick = ()=>{ close(); onConfirm && onConfirm(); };
  no.onclick  = close;

  // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¥ØºÙ„Ø§Ù‚ Ø¨Ù€ ESC
  const esc = (e)=>{ if(e.key === 'Escape') close(); };
  document.addEventListener('keydown', esc);
}


    
    
    
    
    
    
        // ===== Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª PDF Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© ÙÙŠ Ø§Ù„Ù€ Aside Ø§Ù„Ù…Ø³ØªÙ‚Ù„ =====
   function renderImportedPdfList(){
  const wrap = document.getElementById("importedPdfList");
  wrap.innerHTML = "";
  if(!importedPdfFiles.length){
    const empty = document.createElement("div");
    empty.className = "chip-meta";
    empty.style.color = "var(--muted)";
    empty.style.textAlign = "center";
    empty.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Excel/CSV Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ø¹Ø¯";
    wrap.appendChild(empty);
    return;
  }
  importedPdfFiles.forEach((f, i)=>{
    const ext = f.name.split(".").pop().toUpperCase();
    const row = document.createElement("div");
    row.className = "invoice-chip";
    row.innerHTML = `
      <div class="chip-meta">
        <strong>${f.name}</strong>
        <small>${Math.round(f.size/1024)}KB â€¢ ${ext}</small>
      </div>
      <button class="btn-danger-custom" title="Ø¥Ø²Ø§Ù„Ø©" onclick="removeImportedPdf(${i})">
        <i class="fa-regular fa-trash-can"></i>
      </button>
    `;
    wrap.appendChild(row);
  });
}


    function removeImportedPdf(i){
      importedPdfFiles.splice(i,1);
      renderImportedPdfList();
      showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯ ğŸ—‘ï¸");
    }
    
    
    
    
    
    
   async function exportCSVOnly(){
  if(!currentInvoice || !(currentInvoice.items||[]).length){
    showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ± âŒ", true);
    return;
  }

  // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ø«Ù„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
  const d = new Date();
  const invoiceId = `INV-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,"0")}${String(d.getDate()).padStart(2,"0")}`;
  const csvName   = `Invoice_${invoiceId}.csv`;

  // ØªØ±ØªÙŠØ¨ Ù…Ø«Ù„ PDF/Excel: Category Ø«Ù… Item
  const sorted = [...(currentInvoice.items||[])].sort((a,b)=>{
    const c = String(a.category||"").localeCompare(String(b.category||""), "en", {sensitivity:"base"});
    return c!==0 ? c : String(a.name||"").localeCompare(String(b.name||""), "en", {sensitivity:"base"});
  });

  // Ù…Ø­ÙˆÙ‘Ù„ Ø¢Ù…Ù† Ù„Ù‚ÙŠÙ… CSV (ÙŠØ¯Ø¹Ù‘Ù… Ø§Ù„ÙÙˆØ§ØµÙ„ØŒ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù‚ØªØ¨Ø§Ø³ØŒ ÙˆØ§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
  const esc = (val)=>{
    const s = String(val ?? "");
    const needsQuotes = /[",\r\n]/.test(s);
    const doubled = s.replace(/"/g, '""');
    return needsQuotes ? `"${doubled}"` : doubled;
  };

  // Ø§Ù„Ù‡ÙŠØ¯Ø± + Ø§Ù„ØµÙÙˆÙ
  const header = ["Category","Item","Quantity","Notes"];
  const rows = [
    header,
    ...sorted.map(it=>[it.category, it.name, it.qty, it.note])
  ];

  // Ù†Øµ CSV Ù…Ø¹ BOM Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ØªÙØªØ­ ØµØ­ Ø¨Ø§Ù„Ø¥ÙƒØ³Ù„
  const csv = "\uFEFF" + rows.map(r => r.map(esc).join(",")).join("\r\n");

  // Ù†Ù†Ø´Ø¦ Blob ÙˆÙ†Ù†Ø²Ù‘Ù„ Ø¨Ø§Ù„Ù€ fallback Ù…Ø§Ù„ØªÙƒ (Ø¨Ø¯ÙˆÙ† data:url)
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
downloadBlobDirect(csvName, blob);

  showToast("âœ… ØªÙ… ØªØµØ¯ÙŠØ± CSV");
}





// ÙŠØ­Ø§ÙˆÙ„ ÙŠØ±Ø¬Ù‘Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø£Ø¹Ù…Ø¯Ø© Ù…ÙˆØ­Ø¯Ø© Ù…Ù† Ø£ÙŠ Ù…Ù„Ù (Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ/Ø£Ø­Ø±Ù Ù…Ø®ØªÙ„ÙØ©)
function pick(r, keys){
  for(const k of keys){
    if(r[k] != null && r[k] !== "") return String(r[k]);
  }
  return "";
}

// ØªØ­ÙˆÙŠÙ„ ÙˆØ±Ù‚Ø© (Sheet) Ø¥Ù„Ù‰ Ø¢ÙŠØªÙ…Ø§Øª Ù…ÙˆØ­Ø¯Ø©
function sheetToItems(ws){
  // defval:"" Ø­ØªÙ‰ Ù…Ø§ ØªØ·Ù„Ø¹ undefined
  const rows = XLSX.utils.sheet_to_json(ws, { defval: "", raw: false });
  const out = [];
  rows.forEach(r=>{
    const category = pick(r, ["category","Category","CATEGORY","Ø§Ù„ØµÙ†Ù","ØµÙ†Ù"]);
    const item     = pick(r, ["item","Item","ITEM","Ø§Ù„Ù‚Ø·Ø¹Ø©","Ù‚Ø·Ø¹Ø©","Item Name","Ø§Ø³Ù…","Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©"]);
    const qty      = pick(r, ["qty","Qty","QTY","Quantity","Ø§Ù„Ø¹Ø¯Ø¯","Ø¹Ø¯Ø¯"]);
    const note     = pick(r, ["note","Note","NOTES","Notes","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]);

    if(String(item).trim().length){ // Ù„Ø§Ø²Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
      out.push({
        category: String(category||"").trim(),
        item    : String(item||"").trim(),
        qty     : String(qty||"").trim(),
        note    : String(note||"").trim()
      });
    }
  });
  return out;
}

// ÙŠÙ‚Ø±Ø£ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ (XLSX Ø£Ùˆ CSV) ÙˆÙŠØ±Ø¬Ù‘Ø¹ Array Ù…Ù† Ø§Ù„Ø¢ÙŠØªÙ…Ø§Øª
async function extractItemsFromFile(file){
  // Ù†Ø³ØªØ®Ø¯Ù… arrayBuffer Ø­ØªÙ‰ ÙŠØ´ØªØºÙ„ Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ ÙˆÙŠØ£Ø®Ø° BOM Ù„Ù„Ù€ CSV
  const buf = await file.arrayBuffer();
  // SheetJS ÙŠÙ…ÙŠÙ‘Ø² CSV/XLSX ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ù€ buffer
  const wb  = XLSX.read(buf, { type: "array" });
  const items = [];
  (wb.SheetNames || []).forEach(name=>{
    const ws = wb.Sheets[name];
    if(ws) items.push(...sheetToItems(ws));
  });
  return items;
}



function printCustom(htmlContent, title = 'ÙØ§ØªÙˆØ±Ø©') {
  const w = window.open('', '_blank');
  if (!w) {
    alert('Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©');
    return;
  }

  const safeTitle = String(title)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');

  w.document.open();
  w.document.write(`
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
      <meta charset="utf-8" />
      <title>${safeTitle}</title>
      <style>
        @page {
          size: A4;
          margin: 14mm;
        }

        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap');

        *{
          box-sizing: border-box;
          font-family: "Cairo", system-ui, -apple-system, "Segoe UI", sans-serif;
        }

        body{
          margin: 0;
          background: #f3f4f6;
        }

        .page{
          max-width: 800px;
          margin: 0 auto;
          padding: 18px 0;
        }

        .invoice{
          background: #ffffff;
          border-radius: 16px;
          border: 1px solid #e5e7eb;
          box-shadow: 0 18px 40px rgba(15,23,42,.14);
          padding: 20px 24px 18px;
        }

        /* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± ===== */
        .invoice-header{
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 16px;
          margin-bottom: 10px;
        }

        .brand{
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .brand-logo{
          width: 40px;
          height: 40px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          background: radial-gradient(circle at 30% 20%, #facc15, #f97316);
          color: #111827;
          font-weight: 800;
          font-size: 18px;
          box-shadow: 0 8px 18px rgba(250,204,21,.45);
        }

        .brand-text-main{
          font-size: 18px;
          font-weight: 800;
          color: #0f172a;
        }

        .brand-text-sub{
          font-size: 11px;
          color: #6b7280;
          margin-top: 2px;
        }

        .doc-meta{
          text-align: left;
          font-size: 10.5px;
          color: #4b5563;
          line-height: 1.7;
          min-width: 160px;
        }

        .doc-meta-row{
          display: flex;
          justify-content: space-between;
          gap: 6px;
        }

        .doc-meta-label{
          color: #9ca3af;
        }

        .doc-meta-value{
          font-weight: 600;
          color: #111827;
        }

        /* ===== Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===== */
        .inv-title-block{
          text-align: center;
          margin: 4px 0 10px;
        }

        .inv-title-eyebrow{
          font-size: 9px;
          letter-spacing: .18em;
          text-transform: uppercase;
          color: #9ca3af;
          margin-bottom: 3px;
        }

        .inv-title-main{
          font-size: 16px;
          font-weight: 800;
          letter-spacing: .3px;
        }

        .inv-title-sub{
          font-size: 10px;
          color: #9ca3af;
          margin-top: 3px;
        }

        /* ===== Ø«Ù„Ø§Ø« Ù…Ø³ØªØ·ÙŠÙ„Ø§Øª ÙˆØ³Ø· Ø§Ù„ØµÙØ­Ø© ===== */
        .inv-meta-strip{
          display: flex;
          justify-content: center;
          gap: 10px;
          margin: 12px 0 10px;
          flex-wrap: wrap;
        }

        .meta-box{
          min-width: 160px;
          padding: 7px 11px;
          border-radius: 12px;
          border: 1px solid #e5e7eb;
          background: linear-gradient(145deg,#f9fafb,#eef2ff);
          box-shadow: 0 7px 16px rgba(148,163,184,.28);
          text-align: center;
        }

        .meta-label{
          font-size: 10px;
          color: #6b7280;
          margin-bottom: 2px;
        }

        .meta-value{
          font-size: 12px;
          font-weight: 700;
          color: #111827;
          min-height: 16px;
          word-break: break-word;
        }

        .inv-divider{
          border: none;
          border-top: 1px solid #e5e7eb;
          margin: 8px 0 10px;
        }

        /* ===== Ù‡ÙŠØ¯Ø± Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ ===== */
        .section-head{
          margin-bottom: 6px;
          display: flex;
          justify-content: space-between;
          gap: 10px;
          align-items: baseline;
        }

        .section-title{
          font-size: 11px;
          font-weight: 700;
          color: #111827;
        }

        .section-sub{
          font-size: 9px;
          color: #9ca3af;
          text-align: left;
        }

        /* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ ===== */
        .inv-table{
          width: 100%;
          border-collapse: collapse;
          border-radius: 10px;
          overflow: hidden;
        }

        .inv-table th,
        .inv-table td{
          border: 1px solid #e5e7eb;
          padding: 6px 7px;
          font-size: 11px;
          text-align: center;
          word-break: break-word;
        }

        .inv-table th{
          background: #020617;
          color: #f9fafb;
          font-weight: 700;
        }

        .inv-table tbody tr:nth-child(odd){
          background: #f9fafb;
        }

        /* ===== Ù…Ù„Ø®Øµ Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø© ===== */
        .inv-bottom-row{
          display: flex;
          justify-content: space-between;
          gap: 14px;
          margin-top: 12px;
          align-items: flex-start;
        }

        .inv-summary{
          font-size: 11px;
          min-width: 150px;
        }

        .summary-line{
          display: flex;
          justify-content: space-between;
          gap: 8px;
          margin-bottom: 3px;
        }

        .summary-line span:first-child{
          color: #6b7280;
        }

        .summary-line span:last-child{
          font-weight: 600;
        }

        .inv-note{
          text-align: left;
          font-size: 9.5px;
          color: #9ca3af;
          max-width: 260px;
        }

        /* ===== Ø§Ù„ØªÙˆØ§Ù‚ÙŠØ¹ ===== */
        .inv-sign-row{
          display: flex;
          justify-content: space-between;
          gap: 24px;
          margin-top: 20px;
          font-size: 10px;
          color: #6b7280;
        }

        .sign-col{
          flex: 1;
          text-align: center;
        }

        .sign-line{
          border-top: 1px dashed #9ca3af;
          padding-top: 18px;
          margin-bottom: 4px;
        }

        .sign-label{
          font-size: 10px;
        }

        @media print {
          body{
            background: #ffffff;
          }
          .page{
            padding: 0;
          }
          .invoice{
            box-shadow: none;
            border-radius: 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="page">
        <div class="invoice">
          ${htmlContent}
        </div>
      </div>

      <script>
        setTimeout(function(){
          window.focus();
          window.print();
        }, 200);
      <\/script>
    </body>
    </html>
  `);
  w.document.close();
}


function printInvoiceHTML() {
  if (!currentInvoice || !(currentInvoice.items || []).length) {
    showToast("Ù…Ø§ÙƒÙˆ Ù…ÙˆØ§Ø¯ Ø­ØªÙ‰ Ù†Ø·Ø¨Ø¹ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù†Ù‚Øµ / Ø§Ù„Ù…Ø±ØªØ¬Ø¹ âŒ", "danger");
    return;
  }

  const invId   = currentInvoice.id   || "";
  const invDate = currentInvoice.date || new Date().toLocaleDateString("ar-EG");

  const sortedItems = [...(currentInvoice.items || [])].sort((a, b) => {
    const catA  = String(a.category || "");
    const catB  = String(b.category || "");
    const nameA = String(a.name || "");
    const nameB = String(b.name || "");
    if (catA === catB) return nameA.localeCompare(nameB, "ar");
    return catA.localeCompare(catB, "ar");
  });

  const rowsHtml = sortedItems.map((it, idx) => `
    <tr>
      <td>${idx + 1}</td>
      <td>${escapeHtml(it.category || "")}</td>
      <td>${escapeHtml(it.name || "")}</td>
      <td>${escapeHtml(it.qty || "")}</td>
      <td>${escapeHtml(it.note || "")}</td>
    </tr>
  `).join("");

  const totalQty = sortedItems.reduce((sum, it) => {
    const q = parseInt(it.qty, 10);
    return sum + (isNaN(q) ? 0 : q);
  }, 0);

  // Ù†Ø®Ù„ÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± + Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¯Ø§Ø®Ù„ thead Ø­ØªÙ‰ ÙŠÙ†Ø¹Ø§Ø¯ Ø¨ÙƒÙ„ ØµÙØ­Ø© Ø·Ø¨Ø§Ø¹Ø©
  const html = `
    <div class="inv-body">
      <table class="inv-layout">
        <thead>
          <tr>
            <td>
              <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¨ÙŠØ¶ÙˆÙŠ Ø§Ù„ØºØ§Ù…Ù‚ -->
              <div class="inv-hero-pill">
                <div class="inv-hero-left">
                  <div class="inv-hero-logo">AS</div>
                  <div class="inv-hero-text">
                    <div class="inv-hero-name">Ù…ÙƒØªØ¨ Ø¹Ø³Ù„</div>
                    <div class="inv-hero-tagline">Ù„ØªØ¬Ù‡ÙŠØ² Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ Ø¬Ù…Ù„Ø© ÙˆÙ…ÙØ±Ø¯</div>
                  </div>
                </div>
                <div class="inv-hero-right">
                  <div class="inv-hero-line">
                    <span class="label">Ø§Ù„Ø±Ù‚Ù…:</span>
                    <span class="value">${escapeHtml(invId || "ØºÙŠØ± Ù…Ø°ÙƒÙˆØ±")}</span>
                  </div>
                  <div class="inv-hero-line">
                    <span class="label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                    <span class="value">${escapeHtml(invDate)}</span>
                  </div>
                  <div class="inv-hero-line">
                    <span class="label">Ø§Ù„Ù†ÙˆØ¹:</span>
                    <span class="value">Ù†Ù‚Øµ / Ù…Ø±ØªØ¬Ø¹ Ù…ÙˆØ§Ø¯</span>
                  </div>
                </div>
              </div>

              <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø± -->
              <div class="inv-title-block">
                <div class="inv-title-eyebrow">Ø¥Ø´Ø¹Ø§Ø± Ù…Ø®Ø²Ù†ÙŠ</div>
                <div class="inv-title-main">ÙØ§ØªÙˆØ±Ø© Ù†Ù‚Øµ Ù…ÙˆØ§Ø¯ / Ù…Ø±ØªØ¬Ø¹ Ù…ÙˆØ§Ø¯</div>
                <div class="inv-title-sub">
                  Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ØªÙˆØ«ÙŠÙ‚ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù†Ù‚Øµ Ø£Ùˆ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª Ù…Ù† Ù…Ø®Ø²ÙˆÙ† Ù…ÙƒØªØ¨ Ø¹Ø³Ù„ ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.
                </div>
              </div>

              <hr class="inv-divider" />
            </td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <!-- Ù‡ÙŠØ¯Ø± Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
              <div class="section-head">
                <div class="section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯</div>
                <div class="section-sub">
                  Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ù…Ø³Ø¬Ù‘Ù„Ø© Ø¨Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†.
                </div>
              </div>

              <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ -->
              <table class="inv-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Ø§Ù„ØµÙ†Ù</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                  </tr>
                </thead>
                <tbody>
                  ${rowsHtml}
                </tbody>
              </table>

              <!-- Ù…Ù„Ø®Øµ + Ù…Ù„Ø§Ø­Ø¸Ø© -->
              <div class="inv-bottom-row">
                <div class="inv-summary">
                  <div class="summary-line">
                    <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯</span>
                    <span>${sortedItems.length}</span>
                  </div>
                  <div class="summary-line">
                    <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</span>
                    <span>${totalQty}</span>
                  </div>
                </div>
                <div class="inv-note">
                  ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¢Ù„ÙŠØ§Ù‹ Ù…Ù† Ù†Ø¸Ø§Ù… Ù…ÙƒØªØ¨ Ø¹Ø³Ù„ØŒ ÙˆØªÙØ³ØªØ®Ø¯Ù… Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¬Ø±Ø¯ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© Ù„Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª.
                </div>
              </div>

              <!-- Ø§Ù„ØªÙˆØ§Ù‚ÙŠØ¹ -->
              <div class="inv-sign-row">
                <div class="sign-col">
                  <div class="sign-line"></div>
                  <div class="sign-label">Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²Ù†</div>
                </div>
                <div class="sign-col">
                  <div class="sign-line"></div>
                  <div class="sign-label">Ø§Ù„Ù…ÙˆØ±Ø¯ / Ø§Ù„Ù…Ø³ØªÙ„Ù…</div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  `;

  printCustom(`
    <style>
      .inv-body{
        font-size: 11px;
        color: #0f172a;
        line-height: 1.7;
      }

      /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØºÙ„ÙŠÙ Ø­ØªÙ‰ Ù†ÙƒØ±Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨ÙƒÙ„ ØµÙØ­Ø© */
      .inv-layout{
        width: 100%;
        border-collapse: collapse;
      }
      .inv-layout thead{
        display: table-header-group;
      }

      /* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¨ÙŠØ¶ÙˆÙŠ Ø§Ù„ØºØ§Ù…Ù‚ ===== */
      .inv-hero-pill{
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        padding: 10px 18px;
        border-radius: 18px; /* Ø­ÙˆØ§Ù Ø£Ù‚Ù„ Ø¨ÙŠØ¶ÙˆÙŠØ© */
        border: 1px solid #020617;
        background: linear-gradient(135deg,#020617,#111827,#1f2937);
        box-shadow: 0 10px 26px rgba(15,23,42,.55);
        margin-bottom: 10px;
      }

      .inv-hero-left{
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .inv-hero-logo{
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at 30% 20%, #facc15, #f97316);
        color: #111827;
        font-weight: 800;
        font-size: 17px;
        box-shadow: 0 8px 18px rgba(250,204,21,.55);
      }

      .inv-hero-text{
        display: flex;
        flex-direction: column;
      }

      .inv-hero-name{
        font-size: 15px;
        font-weight: 800;
        color: #f9fafb; /* ØºØ§Ù…Ù‚ ÙØ® Ù†Ø®Ù„ÙŠÙ‡Ø§ ÙØ§ØªØ­Ø© */
      }

      .inv-hero-tagline{
        font-size: 10px;
        color: #e5e7eb;
        margin-top: 1px;
      }

      .inv-hero-right{
        font-size: 10.5px;
        color: #e5e7eb;
        text-align: left;
      }

      .inv-hero-line{
        display: flex;
        gap: 4px;
        justify-content: flex-start;
      }

      .inv-hero-line .label{
        color: #9ca3af;
      }

      .inv-hero-line .value{
        font-weight: 600;
        color: #f9fafb;
      }

      /* ===== Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===== */
      .inv-title-block{
        text-align: center;
        margin-bottom: 8px;
      }

      .inv-title-eyebrow{
        font-size: 9px;
        letter-spacing: .18em;
        text-transform: uppercase;
        color: #9ca3af;
        margin-bottom: 3px;
      }

      .inv-title-main{
        font-size: 16px;
        font-weight: 800;
        letter-spacing: .3px;
      }

      .inv-title-sub{
        font-size: 10px;
        color: #9ca3af;
        margin-top: 4px;
      }

      .inv-divider{
        border: none;
        border-top: 1px solid #e5e7eb;
        margin: 6px 0 8px;
      }

      /* ===== Ù‡ÙŠØ¯Ø± Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ ===== */
      .section-head{
        margin-bottom: 6px;
        display: flex;
        justify-content: space-between;
        gap: 10px;
        align-items: baseline;
      }

      .section-title{
        font-size: 11px;
        font-weight: 700;
        color: #111827;
      }

      .section-sub{
        font-size: 9px;
        color: #9ca3af;
        text-align: left;
      }

      /* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ ===== */
      .inv-table{
        width: 100%;
        border-collapse: collapse;
        border-radius: 10px;
        overflow: hidden;
      }

      .inv-table th,
      .inv-table td{
        border: 1px solid #e5e7eb;
        padding: 6px 7px;
        font-size: 11px;
        text-align: center;
        word-break: break-word;
      }

      .inv-table th{
        background: #020617;
        color: #f9fafb;
        font-weight: 700;
      }

      .inv-table tbody tr:nth-child(odd){
        background: #f9fafb;
      }

      /* ===== Ù…Ù„Ø®Øµ Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø© ===== */
      .inv-bottom-row{
        display: flex;
        justify-content: space-between;
        gap: 14px;
        margin-top: 12px;
        align-items: flex-start;
      }

      .inv-summary{
        font-size: 11px;
        min-width: 150px;
      }

      .summary-line{
        display: flex;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 3px;
      }

      .summary-line span:first-child{
        color: #6b7280;
      }

      .summary-line span:last-child{
        font-weight: 600;
      }

      .inv-note{
        text-align: left;
        font-size: 9.5px;
        color: #9ca3af;
        max-width: 260px;
      }

      /* ===== Ø§Ù„ØªÙˆØ§Ù‚ÙŠØ¹ ===== */
      .inv-sign-row{
        display: flex;
        justify-content: space-between;
        gap: 24px;
        margin-top: 20px;
        font-size: 10px;
        color: #6b7280;
      }

      .sign-col{
        flex: 1;
        text-align: center;
      }

      .sign-line{
        border-top: 1px dashed #9ca3af;
        padding-top: 18px;
        margin-bottom: 4px;
      }

      .sign-label{
        font-size: 10px;
      }
    </style>
    ${html}
  `, `ÙØ§ØªÙˆØ±Ø© Ù†Ù‚Øµ/Ù…Ø±ØªØ¬Ø¹ - ${invId || invDate}`);
}


  

    /* =========================
       ØªØµØ¯ÙŠØ± PDF Ø¨Ø´ÙƒÙ„ Ø£Ù†ÙŠÙ‚ Ø¨Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ
       ========================= */
  async function exportPDF() {
  if (!currentInvoice || (currentInvoice.items || []).length === 0) {
    showToast("No data to export âŒ", true);
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "p", unit: "pt", format: "a4" });

  // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± (Category Ø«Ù… Item)
  const sortedItems = [...(currentInvoice.items || [])].sort((a, b) => {
    const catA = String(a.category || "");
    const catB = String(b.category || "");
    const nameA = String(a.name || "");
    const nameB = String(b.name || "");
    const catCompare = catA.localeCompare(catB, "en", { sensitivity: "base" });
    return catCompare !== 0 ? catCompare : nameA.localeCompare(nameB, "en", { sensitivity: "base" });
  });

  const pageWidth  = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();

  // Header
  doc.setFont("helvetica", "bold");
  doc.setFontSize(22);
  doc.setTextColor(25, 25, 112);
  doc.text("ASSAL OFFICE", pageWidth / 2, 65, { align: "center" });
  doc.setFontSize(12);
  doc.setTextColor(100);
  doc.text("YOUR BEST CHOICE", pageWidth / 2, 85, { align: "center" });

  // Meta
  const today = new Date();
  const invoiceDate = today.toLocaleDateString("en-GB");
  const invoiceId = `INV-${today.getFullYear()}${String(today.getMonth()+1).padStart(2,"0")}${String(today.getDate()).padStart(2,"0")}`;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(12);
  doc.setTextColor(0);
  doc.text(`Invoice ID: ${invoiceId}`, pageWidth - 60, 120, { align: "right" });
  doc.text(`Date: ${invoiceDate}`, 60, 120, { align: "left" });

  // Table
  doc.autoTable({
    head: [["#", "Category", "Item", "Quantity", "Notes"]],
    body: sortedItems.map((it, i) => [
      i + 1,
      String(it.category || ""),
      String(it.name || ""),
      String(it.qty || ""),
      String(it.note || "")
    ]),
    startY: 160,
    theme: "grid",
    styles: { halign: "center", font: "helvetica", fontSize: 11 },
    headStyles: { fillColor: [40, 90, 160], textColor: [255, 255, 255], fontStyle: "bold" },
    alternateRowStyles: { fillColor: [245, 245, 245] },
    margin: { left: 50, right: 50 },
    didDrawPage: () => {
      doc.setDrawColor(80, 80, 80);
      doc.setLineWidth(1.5);
      doc.rect(30, 30, pageWidth - 60, pageHeight - 60, "S");
      const pageCount   = doc.internal.getNumberOfPages();
      const pageCurrent = doc.internal.getCurrentPageInfo().pageNumber;
      doc.setFontSize(10);
      doc.setTextColor(100);
      doc.text(`Page ${pageCurrent} of ${pageCount}`, pageWidth / 2, pageHeight - 20, { align: "center" });
    }
  });

  // â¬…ï¸ Ø­ÙØ¸ PDF ÙÙ‚Ø· (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
  doc.save(`Invoice_${invoiceId}.pdf`);
  showToast("ØªÙ… ØªØµØ¯ÙŠØ± PDF ÙÙ‚Ø· âœ…");
}





async function exportExcelOnly(){
  if(!currentInvoice || !(currentInvoice.items||[]).length){
    showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ± âŒ", true);
    return;
  }

  // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ø«Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  const d = new Date();
  const invoiceId = `INV-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,"0")}${String(d.getDate()).padStart(2,"0")}`;
  const xlsxName  = `Invoice_${invoiceId}.xlsx`;

  // ØªØ±ØªÙŠØ¨ Ù…Ø«Ù„ PDF (Category Ø«Ù… Item)
  const sorted = [...(currentInvoice.items||[])].sort((a,b)=>{
    const c = String(a.category||"").localeCompare(String(b.category||""), "en", {sensitivity:"base"});
    return c!==0 ? c : String(a.name||"").localeCompare(String(b.name||""), "en", {sensitivity:"base"});
  });

  // ØµÙÙˆÙ Ø§Ù„Ø¥ÙƒØ³Ù„ (Ù‡ÙŠØ¯Ø± + Ø¨ÙŠØ§Ù†Ø§Øª)
  const rows = [
    ["Category","Item","Quantity","Notes"],
    ...sorted.map(it=>[
      String(it.category||""),
      String(it.name||""),
      String(it.qty||""),
      String(it.note||""),
    ])
  ];

  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel Ø¹Ø¨Ø± SheetJS ÙˆØ­ÙØ¸ Ù…Ø¨Ø§Ø´Ø± (Ù†ÙØ³ ÙÙƒØ±Ø© doc.save Ù„Ù„Ù€ PDF)
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(rows);
  XLSX.utils.book_append_sheet(wb, ws, "Invoice");

  XLSX.writeFile(wb, xlsxName, { compression: true }); // â¬…ï¸ Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø±
  showToast("ØªÙ… ØªØµØ¯ÙŠØ± Excel âœ…");
}


// ØªØ­Ù…ÙŠÙ„ Blob ÙŠØ´ØªØºÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ¨Ø§ÙŠÙ„/ÙˆÙŠØ¨ ÙÙŠÙˆ/Ø¯ÙŠØ³ÙƒØªÙˆØ¨
function downloadBlobFallback(filename, blob){
  // 1) Web Share API (Ø£ÙØ¶Ù„ Ø´ÙŠ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¥Ù† ÙƒØ§Ù† Ù…Ø¯Ø¹ÙˆÙ…)
  try{
    const file = new File([blob], filename, { type: blob.type || "application/octet-stream" });
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      navigator.share({ files: [file], title: filename }).catch(()=>{});
      return;
    }
  }catch(_e){ /* Ù†ØªØ¬Ø§Ù‡Ù„ ÙˆÙ†ÙƒÙ…Ù‘Ù„ */ }

  // 2) Edge Ø§Ù„Ù‚Ø¯ÙŠÙ…
  if (window.navigator && window.navigator.msSaveOrOpenBlob){
    window.navigator.msSaveOrOpenBlob(blob, filename);
    return;
  }

  // 3) Ø±Ø§Ø¨Ø· ØªÙ†Ø²ÙŠÙ„ + fallback ÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ (Ù„Ù„ÙˆÙØ¨ ÙÙŠÙˆ Ø§Ù„Ù„ÙŠ ÙŠØªØ¬Ø§Ù‡Ù„ download)
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.style.display = "none";
  document.body.appendChild(a);
  a.click();

  // Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙŠØ¨ ÙÙŠÙˆ Ù…Ø§ ÙŠÙ†Ø²Ù„ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø·Ø› Ø¬Ø±Ù‘Ø¨ Ù†ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
  setTimeout(()=>{
    // Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯
    const win = window.open(url, "_blank");
    if(!win){
      // Ø¢Ø®Ø± Ø­Ù„: ØªØ­ÙˆÙŠÙ„ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©
      window.location.href = url;
    }
    // ØªÙ†Ø¸ÙŠÙ
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 2000);
  }, 250);
}

  
  
  
    /* =========================
       Toast Ø¨Ø³ÙŠØ·
       ========================= */
    function showToast(message, isError){
      const toast = document.getElementById("appToast");
      toast.querySelector("span").textContent = message || "Done";
      toast.style.borderColor = isError ? "rgba(239,68,68,.6)" : "var(--stroke)";
      toast.firstElementChild.style.color = isError ? "#ef4444" : "#34d399";
      toast.classList.add("show");
      clearTimeout(window.__t);
      window.__t = setTimeout(()=> toast.classList.remove("show"), 2200);
    }
    
    
    
    
    
    // Ø²Ø± Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰ "Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©"
document.getElementById("btnImportPrev").addEventListener("click", ()=>{
  const p = document.getElementById("prevImportPicker");
  p.value = "";
  p.click();
});

document.getElementById("prevImportPicker").addEventListener("change", async (e)=>{
  const file = (e.target.files || [])[0];
  if(!file) return;

  try{
    // Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ: extractItemsFromFile -> sheetToItems
    const raw = await extractItemsFromFile(file); // ÙŠÙØ±Ø¬ÙØ¹ [{category,item,qty,note}, ...]
    if(!raw.length){
      showToast("Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ© âŒ", true);
      e.target.value = "";
      return;
    }

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„Ø´ÙƒÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ: name Ø¨Ø¯Ù„ item
    const mapped = raw
      .map(r=>({
        category: String(r.category||"NO-CATEGORY").trim(),
        name    : String(r.item||"").trim(),
        qty     : String(r.qty||"1").trim() || "1",
        note    : String(r.note||"").trim()
      }))
      .filter(it=> it.name.length);

    if(!mapped.length){
      showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¯ ØµØ§Ù„Ø­Ø© âŒ", true);
      e.target.value = "";
      return;
    }

    // Ù†ØµÙ†Ø¹ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯
   const today = new Date().toLocaleDateString("ar-EG");
const inv   = {
  id: formatInvoiceName(),   // Ù†ÙØ³ Ø´ÙƒÙ„ "ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ø­Ø¯ - Ù¢Ù Ù¢Ù¥/Ù Ù¡/Ù Ù£"
  date: today,
  items: mapped
};


    // Ù†Ø­ÙØ¸Ù‡Ø§ Ø¶Ù…Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆÙ†Ø¹Ø±Ø¶Ù‡Ø§ ÙÙˆØ±Ù‹Ø§ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
    invoices.push(inv);
    selectedInvoiceIndex = invoices.length - 1;
    currentInvoice = inv;

    localStorage.setItem("invoices", JSON.stringify(invoices));
    document.getElementById("invoiceId").textContent = inv.id;

    renderInvoicesDropdown();
    renderItems();

    showToast("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ âœ…");
  }catch(err){
    console.error(err);
    showToast("ØªØ¹Ø°Ø± Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù âŒ", true);
  }finally{
    e.target.value = "";
  }
});

    
    
    
    
    
    

    /* =========================
       Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…
       ========================= */
       
 
    document.getElementById("btnExportJSON").addEventListener("click", exportExcelOnly);
    document.getElementById("fab").addEventListener("click", newInvoice);
    document.getElementById("btnExportCSV")?.addEventListener("click", exportCSVOnly);
    
    // ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
document.getElementById("btnCommand")?.addEventListener("click", palOpen);



    
    
    
    
    
    // âœ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù„ÙØªØ­ Ù…ÙÙ„ØªÙ‚Ø· Ø§Ù„Ù…Ù„ÙØ§Øª
document.getElementById("btnImportPDF").addEventListener("click", ()=>{
  const picker = document.getElementById("pdfFilePicker");
  picker.value = "";           // Ù†Ù†Ø¸Ù‘Ù Ø§Ù„Ù‚ÙŠÙ…Ø© Ø­ØªÙ‰ ÙŠØ³Ù…Ø­ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©
  picker.click();              // Ù†ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª
});
    
    
    
    
        // ===== PDF Imported Sidebar: Import & Merge =====
    // ÙØªØ­ Ù…ÙÙ„ØªÙ‚Ø· PDF
  document.getElementById("pdfFilePicker").addEventListener("change", async (e)=>{
  const files = Array.from(e.target.files || []);
  if(!files.length) return;

  // Ù†Ù‚Ø¨Ù„ XLSX Ø£Ùˆ CSV
  const ok = files.filter(f => {
    const name = f.name.toLowerCase();
    const type = (f.type || "").toLowerCase();
    return name.endsWith(".xlsx") ||
           name.endsWith(".csv")  ||
           type.includes("spreadsheet") ||
           type.includes("csv");
  });

  if(!ok.length){
    showToast("Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Excel Ø£Ùˆ CSV âŒ", true);
    e.target.value = "";
    return;
  }

  // Ù†Ø®Ø²Ù‘Ù†Ù‡Ø§ Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­ØªÙ‰ ØªØ¨ÙŠÙ† Ø¨Ø§Ù„Ù€ sidebar (Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©)
  importedPdfFiles.push(...ok);
  renderImportedPdfList();
  e.target.value = "";
  showToast("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª âœ…");
});


    // Ø§Ù„Ø¯Ù…Ø¬ + Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙŠØªÙ…Ø§Øª Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹
document.getElementById("btnMergePDF").addEventListener("click", async ()=>{
  if(importedPdfFiles.length < 2){
    showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙÙŠÙ†  (Excel/CSV) âŒ", true);
    return;
  }

  try{
    const arrays = await Promise.all(importedPdfFiles.map(extractItemsFromFile));
    let items = arrays.flat().filter(it => (it.item||"").trim().length);
    if(!items.length){
      showToast("Ù…Ø§ÙƒÙˆ Ø¹Ù†Ø§ØµØ± ØµØ§Ù„Ø­Ø© Ø¨Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© âŒ", true);
      return;
    }

    // Ø§Ø­Ø³Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ (Category+Item+Notes)
    const group = new Map();
    for(const it of items){
      const k = `${(it.category||"").toLowerCase()}||${(it.item||"").toLowerCase()}||${(it.note||"").toLowerCase()}`;
      group.set(k, (group.get(k)||0)+1);
    }
    const dupCount = Array.from(group.values()).filter(c=> c>1).length;

    const proceed = async ()=>{
      // Ø¯Ù…Ø¬ Ø¨Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©
      const merged = mergeByMaxQuantity(items);
      const doc = await buildItemsPdf(merged);
      const fileName = autoMergedName("ASSAL_SORTED","pdf");
      doc.save(fileName);
      showToast("ØªÙ… ØªÙˆÙ„ÙŠØ¯ PDF Ù…Ø¯Ù…Ø¬ (Ø£Ø®Ø° Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©) âœ…");
    };

    if(dupCount > 0){
      openMergeConfirmModal(dupCount, proceed);
      return;
    }

    await proceed();

  } catch(err){
    console.error(err);
    showToast("ÙØ´Ù„ Ø§Ù„Ø¯Ù…Ø¬ âŒ", true);
  }
});



document.getElementById("btnMergeCSV").addEventListener("click", async ()=>{
  if(importedPdfFiles.length < 2){
    showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙÙŠÙ†  (Excel/CSV) âŒ", true);
    return;
  }
  try{
    const arrays = await Promise.all(importedPdfFiles.map(extractItemsFromFile));
    let items = arrays.flat().filter(it => (it.item||"").trim().length);
    if(!items.length){ showToast("Ù…Ø§ÙƒÙˆ Ø¹Ù†Ø§ØµØ± ØµØ§Ù„Ø­Ø© âŒ", true); return; }

    // Ø§Ø­Ø³Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
    const group = new Map();
    for(const it of items){
      const k = `${(it.category||"").toLowerCase()}||${(it.item||"").toLowerCase()}||${(it.note||"").toLowerCase()}`;
      group.set(k, (group.get(k)||0)+1);
    }
    const dupCount = Array.from(group.values()).filter(c=> c>1).length;

    const proceed = ()=>{
      // âœ³ï¸ Ø¯Ù…Ø¬ Ø¨Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©
      const merged = mergeByMaxQuantity(items);

      // CSV Ø¢Ù…Ù† + BOM
      const esc = v=>{
        const s = String(v ?? "");
        const needs = /[",\r\n]/.test(s);
        const dd = s.replace(/"/g,'""');
        return needs ? `"${dd}"` : dd;
      };
      const rows = [
        ["Category","Item","Quantity","Notes"],
        ...merged.map(it=> [it.category||"", it.item||"", it.qty||"", it.note||""])
      ];
      const csv = "\uFEFF" + rows.map(r=>r.map(esc).join(",")).join("\r\n");

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
      const name = autoMergedName("ASSAL_SORTED","csv");
      downloadBlobDirect(name, blob);

      showToast("ØªÙ… ØªÙˆÙ„ÙŠØ¯ CSV Ù…Ø¯Ù…Ø¬ (Ø£Ø®Ø° Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©) âœ…");
    };

    if(dupCount > 0){
      openMergeConfirmModal(dupCount, proceed);
      return;
    }

    proceed();
  }catch(err){
    console.error(err);
    showToast("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ CSV âŒ", true);
  }
});





    /* =========================
       Ù…Ù†Ø·Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®ØµØµØ©
       ========================= */
    const catBtn  = document.getElementById('catBtn');
    const catList = document.getElementById('catList');
    const catText = document.getElementById('catText');

    catBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const visible = catList.style.display==='block';
      document.querySelectorAll('.cat-list').forEach(el=> el.style.display='none');
      catList.style.display = visible ? 'none' : 'block';
    });

   document.querySelectorAll('.cat-item').forEach(it=>{
  it.addEventListener('click', ()=>{
    const val = it.getAttribute('data-val');
    document.getElementById('categorySelect').value = val;              // Ù†Ø­Ø¯Ù‘Ø« Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙ†Ù (Ø§Ù„Ù‚Ø¯ÙŠÙ…)
    catText.innerHTML = it.innerHTML;                                   // Ù†Ø­Ø¯Ù‘Ø« Ù†Øµ Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    catList.style.display='none';
    showToast('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ†Ù âœ…');
    document.getElementById("searchInput").focus(); // ÙŠÙ†Ù‚Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
  });
});

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', ()=> { catList.style.display='none'; });

    /* =========================
       ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
       ========================= */
       window.addEventListener("load", ()=>{
      loadExcelFiles();
      renderInvoicesDropdown();
      renderImportedPdfList(); // â† ÙŠØ¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© PDF Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© 
       setTimeout(()=> showToast("ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§"), 300);
    });

    
    
     // Ø±Ø¨Ø· Enter Ø¨Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
 let __autoSugIndex = -1;

document.getElementById('searchInput').addEventListener('keydown', (e)=>{
  const sug = document.getElementById('autocompleteSuggestions');
  const visible = sug && sug.style.display === 'block';

  // Ù„Ùˆ Ù…Ø§ÙƒÙˆ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
  if(!visible){
    __autoSugIndex = -1;

    if(e.key === 'Enter'){
      e.preventDefault();
      const name = document.getElementById('searchInput').value.trim();
      if(!name){
        showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© âŒ", true);
        focusAndSelect('searchInput');
        return;
      }
      // Ø§Ø³Ù… Ù…Ø¶Ø¨ÙˆØ· â†’ Ù†Ù†ØªÙ‚Ù„ Ù„Ù„Ø¹Ø¯Ø¯
      document.getElementById('itemQty').focus();
    }
    return;
  }
  
  
  
  const items = Array.from(sug.querySelectorAll('li'));
  if(!items.length) return;

  if(e.key === 'ArrowDown' || e.key === 'ArrowUp'){
    e.preventDefault();
    const step = e.key === 'ArrowDown' ? 1 : -1;
    if(__autoSugIndex < 0){
      __autoSugIndex = (e.key === 'ArrowDown') ? 0 : items.length - 1;
    }else{
      __autoSugIndex = Math.max(0, Math.min(items.length - 1, __autoSugIndex + step));
    }
    items.forEach((li, i)=> li.classList.toggle('active', i === __autoSugIndex));
    items[__autoSugIndex].scrollIntoView({ block: 'nearest' });
  }

  if(e.key === 'Enter' && __autoSugIndex >= 0){
    e.preventDefault();
    const li = items[__autoSugIndex];
    document.getElementById('searchInput').value = li.textContent;
    sug.style.display = 'none';
    __autoSugIndex = -1;
    document.getElementById('itemQty').focus();
  }

  if(e.key === 'Escape'){
    sug.style.display = 'none';
    __autoSugIndex = -1;
  }
});
document.getElementById("itemQty").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();

    const qty = document.getElementById("itemQty").value.trim();
    if(!qty){
      showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø¯Ø¯ âŒ", true);
      focusAndSelect("itemQty");
      return;
    }
    if(!isPositiveInt(qty)){
      showToast("Ø¥Ø¯Ø®Ø§Ù„ Ø®Ø§Ø·Ø¦ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… ØµØ­ÙŠØ­ (1 ÙØ£Ø¹Ù„Ù‰) âŒ", true);
      focusAndSelect("itemQty");
      return;
    }

    document.getElementById("itemNote").focus();
  }
});

    
    
  document.getElementById("itemNote").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();

    if (!currentInvoice) {
      showToast("âš ï¸ Ø£Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹", "danger");
      return;
    }

    // âœ… ØªØ­Ù‚Ù‘Ù‚ Ø³Ø±ÙŠØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©:
    if(!validateItemFields("enter")) return;

    addItem(); 
    autoSaveInvoice();
    showToast("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", "success");
    document.getElementById("searchInput").focus();
  }
});







// ØªÙ†Ø²ÙŠÙ„ Blob Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø¨Ø¯ÙˆÙ† Web Share â€” Ù†ÙØ³ Ø¥Ø­Ø³Ø§Ø³ doc.save
function downloadBlobDirect(filename, blob){
  // Edge Ø§Ù„Ù‚Ø¯ÙŠÙ…
  if (window.navigator && window.navigator.msSaveOrOpenBlob){
    window.navigator.msSaveOrOpenBlob(blob, filename);
    return;
  }
  // Ø±Ø§Ø¨Ø· ØªÙ†Ø²ÙŠÙ„ Ù…Ø®ÙÙŠ
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.style.display = "none";
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1500);
}



    // ===== Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¯Ù…Ø¬ ÙˆØ§Ù„ÙØ±Ø² ÙˆØ¨Ù†Ø§Ø¡ PDF Ù…Ø±ØªØ¨ =====



// ÙŠØ¯Ù…Ø¬ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© Ø¨Ø£Ø®Ø° Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ© (Category + Item + Notes)
function mergeByMaxQuantity(items){
  const map = new Map();
  for(const it of (items||[])){
    const category = String(it.category || "").trim();
    const item     = String(it.item     || it.name || "").trim();
    const note     = String(it.note     || "").trim();

    // Ø®Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯ Ø±Ù‚Ù… ØµØ­ÙŠØ­ØŒ ÙˆØ¥Ø°Ø§ Ù…Ø§ÙƒÙˆ Ù†Ø®Ù„ÙŠÙ‡ 1
    let qty = parseInt(String(it.qty ?? "").trim(), 10);
    if(isNaN(qty) || qty < 0) qty = 1;

    const key = `${category.toLowerCase()}||${item.toLowerCase()}||${note.toLowerCase()}`;
    if(!map.has(key)){
      map.set(key, { category, item, qty, note });
    }else{
      const cur = map.get(key);
      cur.qty = Math.max(cur.qty, qty); // Ø£Ø®Ø° Ø£ÙƒØ¨Ø± ÙƒÙ…ÙŠØ©
    }
  }

  // Ø±Ø¬Ù‘Ø¹ Ù…ØµÙÙˆÙØ© Ù…Ø±ØªÙ‘Ø¨Ø©: Category Ø«Ù… Item
  return Array.from(map.values()).sort((a,b)=>{
    const c = a.category.localeCompare(b.category, 'en', {sensitivity:'base'});
    return c !== 0 ? c : a.item.localeCompare(b.item, 'en', {sensitivity:'base'});
  });
}






    // Ø§Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø§ØªØ¬
   function autoMergedName(prefix="ASSAL_MERGED", ext="pdf"){
  const d  = new Date();
  const y  = d.getFullYear();
  const mo = String(d.getMonth()+1).padStart(2,"0");
  const da = String(d.getDate()).padStart(2,"0");
  const hh = String(d.getHours()).padStart(2,"0");
  const mm = String(d.getMinutes()).padStart(2,"0");
  return `${prefix}_${y}${mo}${da}_${hh}${mm}.${ext}`;
}

    // ØªÙ†Ø²ÙŠÙ„ Bytes ÙƒÙ€ PDF
    function downloadBytes(bytes, filename){
      const blob = new Blob([bytes], {type:"application/pdf"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
    }
    
    
  





    // ØªØ±ØªÙŠØ¨ Ø£Ø¨Ø¬Ø¯ÙŠ (item Ø«Ù… category) + ÙˆØ³Ù… Ø§Ù„Ù…ÙƒØ±Ø±
   function sortAndFlagDuplicates(items){
  items.sort((a,b)=>{
    const catA = String(a.category || "");
    const catB = String(b.category || "");
    const itemA = String(a.item || "");
    const itemB = String(b.item || "");
    const catCompare = catA.localeCompare(catB, "en", { sensitivity: "base" });
    return catCompare !== 0 ? catCompare : itemA.localeCompare(itemB, "en", { sensitivity: "base" });
  });

  const map = new Map();
  const out = items.map(it => ({...it, __dup:false}));
  out.forEach((it, idx)=>{
    const key = `${(it.category||"").toLowerCase()}||${(it.item||"").toLowerCase()}||${(it.note||"").toLowerCase()}`;
    if(!map.has(key)) map.set(key, []);
    map.get(key).push(idx);
  });
  for(const arr of map.values()){
    if(arr.length > 1) arr.forEach(i => out[i].__dup = true);
  }
  return out;
}


    // ØªÙˆÙ„ÙŠØ¯ PDF Ø¬Ø¯ÙŠØ¯ Ø¨Ø¬Ø¯ÙˆÙ„ Ù…Ø±ØªØ¨ + ØªØ¸Ù„ÙŠÙ„ Ù…ÙƒØ±Ø± (jsPDF + autoTable)
    async function buildItemsPdf(sortedItems){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation:"p", unit:"pt", format:"a4" });
      const pageWidth  = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();

      // Header
      doc.setFont("helvetica", "bold"); doc.setFontSize(22); doc.setTextColor(25,25,112);
      doc.text("ASSAL OFFICE", pageWidth/2, 65, { align:"center" });
      doc.setFontSize(12); doc.setTextColor(100);
      doc.text("YOUR BEST CHOICE", pageWidth/2, 85, { align:"center" });

      // Meta
      const today = new Date();
      const invoiceDate = today.toLocaleDateString("en-GB");
      const invoiceId = `MERGE-${today.getFullYear()}${String(today.getMonth()+1).padStart(2,"0")}${String(today.getDate()).padStart(2,"0")}`;
      doc.setFont("helvetica","normal"); doc.setFontSize(12); doc.setTextColor(0);
      doc.text(`Merge ID: ${invoiceId}`, pageWidth - 60, 120, { align:"right" });
      doc.text(`Date: ${invoiceDate}`, 60, 120, { align:"left" });

      // Ø¬Ø¯ÙˆÙ„
      doc.autoTable({
        head: [["#", "Category", "Item", "Quantity", "Notes"]],
        body: sortedItems.map((it, i)=>[
          i+1,
          String(it.category||""),
          String(it.item||""),
          String(it.qty||""),
          String(it.note||"")
        ]),
        startY: 160,
        theme: "grid",
        styles: { halign:"center", font:"helvetica", fontSize:11 },
        headStyles: { fillColor:[40,90,160], textColor:[255,255,255], fontStyle:"bold" },
        alternateRowStyles: { fillColor:[245,245,245] },
        margin: { left:50, right:50 },

        didParseCell: function(data){
          if(data.section==='body'){
            const r = data.row.index;
            if(sortedItems[r].__dup){
              data.cell.styles.fillColor = [255,230,230]; // Ø£Ø­Ù…Ø± Ø®ÙÙŠÙ Ù„Ù„Ù…ÙƒØ±Ø±
            }
          }
        },

        didDrawPage: ()=>{
          doc.setDrawColor(80,80,80); doc.setLineWidth(1.5);
          doc.rect(30, 30, pageWidth-60, pageHeight-60, "S");
          const pageCount   = doc.internal.getNumberOfPages();
          const pageCurrent = doc.internal.getCurrentPageInfo().pageNumber;
          doc.setFontSize(10); doc.setTextColor(100);
          doc.text(`Page ${pageCurrent} of ${pageCount}`, pageWidth/2, pageHeight-20, {align:"center"});
        }
      });

     return doc; // Ù†Ø±Ø¬Ù‘Ø¹ ÙƒØ§Ø¦Ù† jsPDF Ù†ÙØ³Ù‡


    }
    
    
    
    
    
    /* ===== Command Palette (Ctrl+K): open, render, inline edit, multi-select, delete ===== */
let __palFilter = "";
let __palMap = [];          // {orig, category, name, qty, note}
let __palSel = new Set();   // selected original indexes
let __palFocus = -1;        // focused row for arrows
let __palDirty = false;     // â† ØµØ§Ø± ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±ØŸ

function palOpen(){
  const ov   = document.getElementById('paletteOverlay');
  const list = document.getElementById('palList');

  __palFilter = "";
  __palSel.clear();
  __palFocus = -1;
  document.getElementById('palSearch').value = "";
  
  document.getElementById('palSearch').closest('.palette-search')?.classList.remove('has-text');

  __palDirty = false; // â† ØµÙÙ‘Ø± Ø§Ù„Ø¹Ù„Ù… Ø¹Ù†Ø¯ ÙƒÙ„ ÙØªØ­

  if(!currentInvoice){
    // Ø­Ø§Ù„Ø©: Ù…Ø§ÙƒÙˆ ÙØ§ØªÙˆØ±Ø©
    list.innerHTML = `
      <div class="group-title">Ù…Ø§ÙƒÙˆ ÙØ§ØªÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
      <div class="item-row" style="grid-template-columns:1fr; text-align:center;">
        <div>Ø¥Ø¶ØºØ· <b>ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</b> Ù…Ù† Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… Ø£Ùˆ Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± Ø­ØªÙ‰ ØªØ¨Ø¯ÙŠ.</div>
      </div>`;
    ov.classList.add('show'); 
    ov.setAttribute('aria-hidden','false');

    // â¬…ï¸ Ø§Ù…Ù†Ø¹ Ø³ÙƒØ±ÙˆÙ„ ÙˆØªÙØ§Ø¹Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ©
    document.body.classList.add('body-no-scroll');

    // â¬…ï¸ ÙƒØªÙ… Ø£ÙŠ Ù„Ù…Ø³/ØªÙ…Ø±ÙŠØ± Ø®Ø§Ø±Ø¬ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    const swallow = (e)=>{
      if(!e.target.closest('.palette')){
        e.preventDefault();
        e.stopPropagation();
      }
    };
    ov.__swallow = swallow;
    ov.addEventListener('wheel', swallow, { passive:false });
    ov.addEventListener('touchmove', swallow, { passive:false });
    ov.addEventListener('touchstart', swallow, { passive:false });
    ov.addEventListener('pointerdown', swallow, { passive:false });

    setTimeout(()=> document.getElementById('palSearch').focus(), 10);
    document.addEventListener('keydown', palKeyHandler);
    return;
  }

  if(!(currentInvoice.items||[]).length){
    // Ø­Ø§Ù„Ø©: ÙØ§ØªÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø³ Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ§Ø¯
    list.innerHTML = `
      <div class="group-title">${escapeHtml(currentInvoice.id)}</div>
      <div class="item-row" style="grid-template-columns:1fr; text-align:center;">
        <div>Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙØ§Ø±ØºØ©. Ø£Ø¶Ù Ù…Ø§Ø¯Ø© Ù…Ù† ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ¨Ø¹Ø¯ÙŠÙ† Ø§Ø±Ø¬Ø¹ Ù„Ù„ÙˆØ­Ø©.</div>
      </div>`;
    ov.classList.add('show'); 
    ov.setAttribute('aria-hidden','false');

    // â¬…ï¸ Ø§Ù…Ù†Ø¹ Ø³ÙƒØ±ÙˆÙ„ ÙˆØªÙØ§Ø¹Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ©
    document.body.classList.add('body-no-scroll');

    // â¬…ï¸ ÙƒØªÙ… Ø£ÙŠ Ù„Ù…Ø³/ØªÙ…Ø±ÙŠØ± Ø®Ø§Ø±Ø¬ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    const swallow = (e)=>{
      if(!e.target.closest('.palette')){
        e.preventDefault();
        e.stopPropagation();
      }
    };
    ov.__swallow = swallow;
    ov.addEventListener('wheel', swallow, { passive:false });
    ov.addEventListener('touchmove', swallow, { passive:false });
    ov.addEventListener('touchstart', swallow, { passive:false });
    ov.addEventListener('pointerdown', swallow, { passive:false });

    setTimeout(()=> document.getElementById('palSearch').focus(), 10);
    document.addEventListener('keydown', palKeyHandler);
    return;
  }

  // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©: Ù…ÙˆØ§Ø¯ Ù…ÙˆØ¬ÙˆØ¯Ø©
  palBuildMap();
  palRender();

  ov.classList.add('show'); 
  ov.setAttribute('aria-hidden','false');

  // â¬…ï¸ Ø§Ù…Ù†Ø¹ Ø³ÙƒØ±ÙˆÙ„ ÙˆØªÙØ§Ø¹Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ©
  document.body.classList.add('body-no-scroll');

  // â¬…ï¸ ÙƒØªÙ… Ø£ÙŠ Ù„Ù…Ø³/ØªÙ…Ø±ÙŠØ± Ø®Ø§Ø±Ø¬ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
  const swallow = (e)=>{
    if(!e.target.closest('.palette')){
      e.preventDefault();
      e.stopPropagation();
    }
  };
  ov.__swallow = swallow;
  ov.addEventListener('wheel', swallow, { passive:false });
  ov.addEventListener('touchmove', swallow, { passive:false });
  ov.addEventListener('touchstart', swallow, { passive:false });
  ov.addEventListener('pointerdown', swallow, { passive:false });

  setTimeout(()=> document.getElementById('palSearch').focus(), 10);
  document.addEventListener('keydown', palKeyHandler);
}

function palClose(){
  const ov = document.getElementById('paletteOverlay');

  ov.classList.remove('show'); 
  ov.setAttribute('aria-hidden','true');
  document.removeEventListener('keydown', palKeyHandler);

  // â¬…ï¸ Ø±Ø¬Ù‘Ø¹ Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©
  document.body.classList.remove('body-no-scroll');

  // â¬…ï¸ ÙÙƒÙ‘ Ù„Ø³ØªÙ‘Ù†Ø±Ø§Øª Ø§Ù„ÙƒØªÙ…
  if(ov.__swallow){
    ov.removeEventListener('wheel', ov.__swallow, { passive:false });
    ov.removeEventListener('touchmove', ov.__swallow, { passive:false });
    ov.removeEventListener('touchstart', ov.__swallow, { passive:false });
    ov.removeEventListener('pointerdown', ov.__swallow, { passive:false });
    delete ov.__swallow;
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙÙˆØ± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
  renderItems();

  if (__palDirty) {                    // â† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§ÙƒÙˆ ØªØ¹Ø¯ÙŠÙ„
    showToast("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
    __palDirty = false;                // â† ØµÙÙ‘Ø± Ø§Ù„Ø¹Ù„Ù…
  }
}

function palBuildMap(){
  __palMap = (currentInvoice.items||[]).map((it, idx)=> ({
    orig: idx,
    category: String(it.category||""),
    name: String(it.name||""),
    qty: String(it.qty||""),
    note: String(it.note||"")
  }));
}

function __norm2(s){ 
  return String(s||"")
    .toLowerCase()
    .replace(/\s+/g,'')
    .replace(/[-_.]/g,'');
}


function palFiltered(){
  const q = __norm2(__palFilter);
  if(!q) return __palMap;
  return __palMap.filter(it=>
    __norm2(it.category).includes(q) ||
    __norm2(it.name).includes(q)     ||
    __norm2(it.qty).includes(q)      ||
    __norm2(it.note).includes(q));
}

function palRender(){
  const host = document.getElementById('palList');
  host.innerHTML = "";
  const data = palFiltered();

  // Ù†Ø¬Ù…Ø¹ Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù
  const groups = new Map();
  data.forEach(it=>{
    const k = it.category || "Ø¨Ø¯ÙˆÙ† ØµÙ†Ù";
    if(!groups.has(k)) groups.set(k, []);
    groups.get(k).push(it);
  });

  groups.forEach((items, cat)=>{
    const gt = document.createElement('div');
    gt.className = 'group-title';
    gt.textContent = cat;
    host.appendChild(gt);

    items.forEach((it, i)=>{
      const row = document.createElement('div');
      row.className = 'item-row';
      row.setAttribute('data-orig', it.orig);

      const checked = __palSel.has(it.orig) ? 'checked' : '';
      row.innerHTML = `
        <input type="checkbox" class="chk" ${checked} />
        <div class="name">${escapeHtml(it.name)}</div>
        <input class="qty" type="number" value="${escapeHtml(it.qty)}" />
        <div class="note" title="${escapeHtml(it.note)}">${escapeHtml(it.note)}</div>
        <button class="del" title="Ø­Ø°Ù"><i class="fa-regular fa-trash-can"></i></button>
      `;

      // ØªØ­Ø¯ÙŠØ¯
      row.querySelector('.chk').addEventListener('change', (e)=>{
        if(e.currentTarget.checked) __palSel.add(it.orig);
        else __palSel.delete(it.orig);
      });

      // Ø¨Ø¹Ø¯ (Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¹Ù„Ø§Ù‡ Ø¨Ù‡Ø°Ø§)
const qtyEl = row.querySelector('.qty');
let prevVal = qtyEl.value;              // Ù†Ø®Ø²Ù‘Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø±ÙŠØ±

// Ù„Ù…Ø§ ÙŠØ§Ø®Ø° ÙÙˆÙƒØ³ØŒ Ù†Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
qtyEl.addEventListener('focus', ()=>{
  prevVal = qtyEl.value;
});

// Ø­ÙØ¸ ÙØ¹Ù„ÙŠ + Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (change)
qtyEl.addEventListener('change', (e)=>{
  const val = e.currentTarget.value.trim();
  currentInvoice.items[it.orig].qty = val;
  autoSaveInvoice();
  renderItems();
  __palDirty = true;
  showToast("ØªÙ… ØªØºÙŠØ± Ø¹Ø¯Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©");   // â† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
});

// Enter = Ø«Ø¨Ù‘Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø«Ù… Ø§Ù†Ù‚Ù„ ÙÙˆÙƒØ³ Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø³Ø·Ø± Ø§Ù„ØªØ§Ù„ÙŠ
qtyEl.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){
    e.preventDefault();

    // 1) Ø«Ø¨Ù‘Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¨Ø± blur (ÙŠØ´ØºÙ‘Ù„ change Ø£Ø¹Ù„Ø§Ù‡)
    qtyEl.blur();

    // 2) Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø© Ù‚ØµÙŠØ±Ø©ØŒ Ø­Ø±Ù‘Ùƒ Ø§Ù„ÙÙˆÙƒØ³ Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ§Ù„ÙŠ (ÙŠÙ„Ù Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)
    setTimeout(()=>{
      const inputs = Array.from(document.querySelectorAll('#palList .item-row .qty'));
      const idx = inputs.indexOf(qtyEl);
      if(inputs.length){
        const next = inputs[(idx + 1) % inputs.length]; // ÙŠÙ„Ù Ù„Ù„Ø£ÙˆÙ„ Ø¥Ø°Ø§ Ø¢Ø®Ø± ÙˆØ§Ø­Ø¯
        next?.focus();
        next?.select?.();
      }
    }, 10);
  }
});


// Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ù„Ùˆ ØªØ­Ø¨ ØªØ¸Ù‡Ø± ØªÙˆØ³Øª Ø£ÙŠØ¶Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¥Ø°Ø§ Ø§Ø®ØªÙ„ÙØª Ø§Ù„Ù‚ÙŠÙ…Ø©
qtyEl.addEventListener('blur', (e)=>{
  const now = e.currentTarget.value.trim();
  if(now !== prevVal){
    // Ø§Ù„ØªÙˆØ³Øª ØµØ§Ø± Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ change Ø¹Ø§Ø¯Ø©Ù‹ØŒ Ù‡Ø°Ø§ Ù„Ù„ØªØ£ÙƒÙŠØ¯ ÙÙŠ Ø­Ø§Ù„Ø§Øª Ù…Ø¹ÙŠÙ‘Ù†Ø©
    // showToast(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ "${it.name}" Ø¥Ù„Ù‰ ${now} âœ…`);
  }
});


      // Ø­Ø°Ù ÙÙˆØ±ÙŠ
      row.querySelector('.del').addEventListener('click', ()=>{
        palDeleteOne(it.orig);
      });

      // ÙÙˆÙƒØ³ Ù„Ù„ØªÙ†Ù‚Ù‘Ù„ Ø¨Ø§Ù„Ø£Ø³Ù‡Ù…
      row.addEventListener('click', ()=>{
        __palFocus = it.orig;
        // ÙÙˆÙƒØ³ Ø¹Ù„Ù‰ qty
        row.querySelector('.qty').focus();
      });

      host.appendChild(row);
    });
  });
}

function palDeleteOne(orig){
  if(!currentInvoice || !currentInvoice.items) return;
  if(!currentInvoice.items[orig]) return;
  currentInvoice.items.splice(orig, 1);
  autoSaveInvoice();
  showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© âœ…");
  __palDirty = true; // â† ØµØ§Ø± ØªØ¹Ø¯ÙŠÙ„

  // Ø£Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø£Ù† Ø§Ù„ÙÙ‡Ø§Ø±Ø³ ØªØºÙŠÙ‘Ø±Øª
  palBuildMap();
  palRender();
  renderItems();
}

function palBulkDelete(){
  if(!__palSel.size){ showToast("Ù…Ø§ Ù…Ø­Ø¯Ø¯ Ø´ÙŠ Ù„Ù„Ø­Ø°Ù âŒ", true); return; }
  const arr = Array.from(__palSel).sort((a,b)=> b-a);
  arr.forEach(i=>{
    if(currentInvoice.items[i]) currentInvoice.items.splice(i,1);
  });
  __palSel.clear();
  autoSaveInvoice();
  showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© âœ…");
  __palDirty = true; // â† ØµØ§Ø± ØªØ¹Ø¯ÙŠÙ„

  palBuildMap(); palRender(); renderItems();
}

/* Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø© */
function palKeyHandler(e){
  const isOpen = document.getElementById('paletteOverlay').classList.contains('show');
  if(!isOpen) return;

  // Esc = Ø¥ØºÙ„Ø§Ù‚
  if(e.key === 'Escape'){ e.preventDefault(); palClose(); return; }

  // â†‘â†“ Ù„Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ (ÙŠØ±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…ÙŠØ©)
  if(e.key === 'ArrowDown' || e.key === 'ArrowUp'){
    e.preventDefault();
    const data = palFiltered().map(it=> it.orig);
    if(!data.length) return;
    if(__palFocus === -1) { __palFocus = data[0]; }
    else{
      const pos = data.indexOf(__palFocus);
      if(pos === -1) __palFocus = data[0];
      else{
        if(e.key === 'ArrowDown') __palFocus = data[Math.min(pos+1, data.length-1)];
        else                      __palFocus = data[Math.max(pos-1, 0)];
      }
    }
    // Ø³ÙƒÙˆÙ„ + ÙÙˆÙƒØ³
    const row = document.querySelector(`.item-row[data-orig="${__palFocus}"]`);
    if(row){
      row.scrollIntoView({block:'nearest'});
      row.querySelector('.qty')?.focus();
    }
    return;
  }

  // Delete = Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¬Ù…Ø§Ø¹ÙŠ
  if(e.key === 'Delete'){
    e.preventDefault();
    palBulkDelete(); return;
  }

 
  // + / - Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø³Ø±ÙŠØ¹Ø§Ù‹ (Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„Ù…ØªØ±ÙƒØ²)
  if(e.key === '+' || e.key === '-' ){
    if(__palFocus === -1) return;
    const el = document.querySelector(`.item-row[data-orig="${__palFocus}"] .qty`);
    if(!el) return;
    const cur = Number(el.value || "0");
    const next = e.key==='+' ? cur+1 : Math.max(0, cur-1);
    el.value = next;
    currentInvoice.items[__palFocus].qty = String(next);
    autoSaveInvoice();
    renderItems();
    e.preventDefault();
  }
 
 
}

/* ÙØªØ­ Ø§Ù„Ù„ÙˆØ­Ø©: Ctrl+K / âŒ˜K */
document.addEventListener('keydown', (e)=>{
  const isMac = navigator.platform.toLowerCase().includes('mac');
  if((isMac && e.metaKey && e.key.toLowerCase()==='k') ||
     (!isMac && e.ctrlKey && e.key.toLowerCase()==='k')){
    e.preventDefault(); palOpen();
  }
});

/* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„ÙˆØ­Ø© (Ø£Ø²Ø±Ø§Ø± ÙˆØ£Ø­Ø¯Ø§Ø«) */
document.getElementById('palClose').addEventListener('click', palClose);
document.getElementById('palBulkDel').addEventListener('click', palBulkDelete);
const palSearchEl = document.getElementById('palSearch');
const palSearchWrap = palSearchEl.closest('.palette-search');

palSearchEl.addEventListener('input', (e)=>{
  __palFilter = e.target.value;
  // Ø£Ø¸Ù‡Ø±/Ø£Ø®ÙÙ Ø²Ø± Ø§Ù„Ù…Ø³Ø­ Ø­Ø³Ø¨ ÙˆØ¬ÙˆØ¯ Ù†Øµ
  if(palSearchEl.value.trim()){
    palSearchWrap.classList.add('has-text');
  }else{
    palSearchWrap.classList.remove('has-text');
  }
  palRender();
});

// Ø²Ø± Ø§Ù„Ù…Ø³Ø­
document.getElementById('palClear').addEventListener('click', ()=>{
  palSearchEl.value = "";
  palSearchWrap.classList.remove('has-text');
  __palFilter = "";
  palRender();
  palSearchEl.focus();
});







// ===== Keyboard Scrolling (Desktop) =====
// ===== Keyboard Scrolling (Desktop) â€” safer =====
// ===== Keyboard Scrolling (Desktop) â€” robust =====
function isTypingContext(e){
  const tag = (e.target.tagName||'').toLowerCase();
  return ['input','textarea','select'].includes(tag) || e.target.isContentEditable;
}

// Ù†Ø­ÙØ¸ Ø¢Ø®Ø± Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ù…Ø§ÙˆØ³ (Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø§ÙˆÙŠØ© ØªØ­Øª Ø§Ù„Ù…Ø¤Ø´Ø±)
let __lastPointer = { x: 0, y: 0 };
document.addEventListener('mousemove', e => { __lastPointer = { x: e.clientX, y: e.clientY }; });

function isScrollable(el){
  if(!el) return false;
  const st = getComputedStyle(el);
  const canY = /(auto|scroll)/.test(st.overflowY);
  return canY && (el.scrollHeight - el.clientHeight) > 1;
}

// Ù†ØµØ¹Ø¯ Ù„Ù„Ø£Ø¨ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±
function climbToScrollable(start){
  let el = start;
  while(el && el !== document && el !== document.documentElement){
    if(isScrollable(el)) return el;
    el = el.parentElement;
  }
  return null;
}

// Ù†Ø®ØªØ§Ø± Ø£ÙØ¶Ù„ Ù‡Ø¯Ù Ù„Ù„ØªÙ…Ø±ÙŠØ±
function findScrollableTarget(){
  // 1) Ø¨Ø­Ø³Ø¨ Ø§Ù„ÙÙˆÙƒØ³
  const byFocus = climbToScrollable(document.activeElement);
  if(byFocus) return byFocus;

  // 2) ØªØ­Øª Ø§Ù„Ù…Ø§ÙˆØ³
  const under = document.elementFromPoint(__lastPointer.x, __lastPointer.y);
  const byPointer = climbToScrollable(under);
  if(byPointer) return byPointer;

  // 3) fallback: ØµÙØ­Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
  return document.scrollingElement || document.documentElement || document.body;
}

// Ø¯Ø§Ù„Ø© ØªÙ…Ø±ÙŠØ± Ø¹Ø§Ù…Ø© (ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ window ÙˆØ§Ù„Ù€ elements)
function doScroll(el, amount){
  // Ù„Ùˆ Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ø³ØªØ¹Ù…Ù„ window.scrollBy
  const isDoc = (el === document.scrollingElement) ||
                (el === document.documentElement) ||
                (el === document.body);

  if(isDoc){
    window.scrollBy({ top: amount, behavior: 'smooth' });
  }else{
    // Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØªØ­ØªØ§Ø¬ Ø¥Ø²Ø§Ù„Ø© behavior Ù„Ù„Ø³Ù„Ø§Ø³Ø© ÙÙŠ Ù…ØªØµÙØ­Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
    el.scrollBy({ top: amount, behavior: 'smooth' });
  }
}

document.addEventListener('keydown', (e)=>{
  // Ø¯ÙŠØ³ÙƒØªÙˆØ¨ ÙÙ‚Ø·
  if(window.innerWidth < 992) return;
  // Ù„Ø§ Ù†ØªØ¯Ø®Ù„ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠÙƒØªØ¨
  if(isTypingContext(e)) return;

  const key = e.key;
  if(!['ArrowDown','ArrowUp','PageDown','PageUp','Home','End'].includes(key)) return;

  const el = findScrollableTarget();
  if(!el) return;

  // Ø§Ø­Ø³Ø¨ Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ±
  let amount = 0;
  if(key === 'ArrowDown') amount =  60;
  if(key === 'ArrowUp')   amount = -60;
  if(key === 'PageDown')  amount =  Math.floor((el.clientHeight || window.innerHeight) * 0.9);
  if(key === 'PageUp')    amount = -Math.floor((el.clientHeight || window.innerHeight) * 0.9);
  if(key === 'Home')      amount = -el.scrollTop;
  if(key === 'End')       amount =  (el.scrollHeight - el.clientHeight - el.scrollTop);

  // Ø¥Ø°Ø§ ÙØ¹Ù„Ø§Ù‹ ÙŠÙˆØ¬Ø¯ Ù…Ø¬Ø§Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±ØŒ Ø§Ù…Ù†Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙˆÙ†ÙÙ‘Ø° Ø§Ù„ØªÙ…Ø±ÙŠØ±
  const canScrollY = (el.scrollHeight - el.clientHeight) > 1 || ['Home','End'].includes(key);
  if(canScrollY){
    e.preventDefault();
    doScroll(el, amount);
  }
});

    
    
    
    /* ===== Maintenance Mode ===== */
// ØºÙŠÙ‘Ø±Ù‡Ø§ Ø¥Ù„Ù‰ true Ù„Ù…Ø§ ØªØ±ÙŠØ¯ ØªØ¸Ù‡Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©
const MAINTENANCE_MODE = false;

/**
 * Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©
 * ÙŠÙˆÙ‚Ù ØªÙ…Ø±ÙŠØ± Ø§Ù„ØµÙØ­Ø© ÙˆÙŠØªØ¬Ø§Ù‡Ù„ ÙƒÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø¨Ø§Ù„Ø®Ù„ÙÙŠØ©
 */
function toggleMaintenance(show){
  const ov = document.getElementById('maintenanceOverlay');
  if(!ov) return;
  ov.style.display = show ? 'flex' : 'none';
  // Ù‚ÙÙ„/ÙØªØ­ Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©
  document.documentElement.style.overflow = show ? 'hidden' : '';
  document.body.style.overflow = show ? 'hidden' : '';
}

/* ØªÙØ¹ÙŠÙ„ Ø¹Ø¨Ø± Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ± Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ): ?maintenance=1 */
function getQueryFlag(name){
  return new URLSearchParams(location.search).get(name);
}

/* ÙØ¹Ù‘Ù„ Ø§Ù„ÙˆØ¶Ø¹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ Ø§Ù„ÙÙ„Ø§Øº ÙŠØ·Ù„Ø¨ Ø°Ù„Ùƒ */
window.addEventListener('load', ()=>{
  const viaQuery = getQueryFlag('maintenance') === '1';
  toggleMaintenance( MAINTENANCE_MODE || viaQuery );
});

    
  
    
  </script>
  
  
  <!-- ====== Footer ====== -->
  <footer class="app-footer">
    <div class="foot-wrap">
      <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ù…ÙƒØªØ¨ Ø¹Ø³Ù„ 2025</span>
    </div>
  </footer>
  
  
  
</body>
</html>

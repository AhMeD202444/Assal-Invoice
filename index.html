<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ASSAL OFFICE â€¢ Invoices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <!-- Ø®Ø·ÙˆØ· (Cairo Ù„Ù„Ø¹Ø±Ø¨ÙŠ + Poppins Ù„Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ) -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <!-- XLSX + jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <style>
  

  
  /* Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© */
#reloadModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© */
.reload-box {
  background: #141821;
  padding: 24px;
  border-radius: 16px;
  text-align: center;
  color: #fff;
  min-width: 220px;
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
}

/* Ø¯Ø§Ø¦Ø±Ø© ØªØ­Ù…ÙŠÙ„ */
.loader {
  border: 4px solid rgba(255,255,255,.2);
  border-top: 4px solid #21d4fd;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  margin: 0 auto 12px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

  
  
  
  
    :root{
  --bg-1:#0e0f13;
  --bg-2:#0a0b0e;
  --glass: rgba(255,255,255,.06);
  --stroke: rgba(255,255,255,.14);
  --text:#f5f7ff;
  --muted:#aab0c0;
  --brand-1:#6d5efc;
  --brand-2:#21d4fd;
  --good:#22c55e;
  --warn:#f59e0b;
  --danger:#ef4444;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
  --radius: 18px;
  --blur: 14px;
  --speed: .32s;
}

*{ box-sizing: border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: "Cairo","Poppins", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
  color: var(--text);
  background:
    radial-gradient(1200px 1200px at 120% -20%, rgba(33,212,253,.20), transparent 60%),
    radial-gradient(900px 900px at -10% 120%, rgba(109,94,252,.20), transparent 60%),
    linear-gradient(180deg, var(--bg-1), var(--bg-2));
  overflow-x:hidden;
}

/* ====== Header ====== */
.app-header{
  position:sticky; top:0; z-index:50;
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient( to bottom, rgba(10,11,14,.75), rgba(10,11,14,.35) );
  border-bottom: 1px solid var(--stroke);
}
.head-wrap{
  max-width:1200px; margin:auto; padding:14px 18px;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.brand{
  display:flex; align-items:center; gap:12px;
  font-weight:700; letter-spacing:.3px;
}
.brand .badge{
  width:40px; height:40px; display:grid; place-items:center;
  background: radial-gradient(120% 120% at 20% 20%, var(--brand-2), var(--brand-1));
  border-radius:12px; color:#0b0d13; font-weight:900;
  box-shadow: var(--shadow);
}
.brand small{ color: var(--muted); font-weight:600; display:block; margin-top:-2px; font-size:12px; }
.head-actions{ display:flex; align-items:center; gap:10px; }
.icon-btn{
  width:40px; height:40px; display:grid; place-items:center;
  border:1px solid var(--stroke);
  background: var(--glass);
  border-radius:12px; color:var(--text);
  cursor:pointer; transition: transform var(--speed), background var(--speed), border-color var(--speed);
}
.icon-btn:hover{ transform: translateY(-2px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.25); }

/* ====== Layout ====== */
.layout{
  max-width:1200px; margin:22px auto; padding:0 16px;
  display:grid; grid-template-columns: 280px 1fr; gap:16px;
}

/* ØªØ§Ø¨Ù„Øª */
@media (max-width: 992px){
  .layout{ grid-template-columns: 1fr; }
}

/* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width: 576px){
  .layout{
    display: flex;             /* Ø¨Ø¯Ù„ Grid Ø­ØªÙ‰ Ù†Ø³ØªØ®Ø¯Ù… order */
    flex-direction: column;
    padding: 0 10px;
    margin: 14px auto;
  }
  .content { order: 1; }
  .sidebar { order: 2; }
}


@media (max-width: 768px){
  .editor > div{
    flex-direction: column;    /* Ø£ÙŠ Ø³Ø·Ø± Ø¯Ø§Ø®Ù„Ù‡ display:flex (Ù…Ø«Ù„ Ø§Ù„Ø¹Ø¯Ø¯+Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª/Ø§Ù„Ø£Ø²Ø±Ø§Ø±) ÙŠØµÙŠØ± Ø¹Ù…ÙˆØ¯ÙŠ */
  }
  .editor .ginput{ flex: 1 1 100%; }
}



/* ====== Sidebar ====== */
.sidebar{
  background: var(--glass);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:14px;
  position:relative;
  overflow:hidden;
}
.panel-title{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:8px 6px 12px; border-bottom:1px dashed var(--stroke);
  margin-bottom:10px;
}
.panel-title h3{ margin:0; font-size:16px; font-weight:800; letter-spacing:.2px; }
.pill{
  background: rgba(255,255,255,.08);
  border:1px solid var(--stroke);
  padding:6px 10px; border-radius:999px; color: var(--muted); font-size:12px;
}

/* Category select */
.category{ margin-top:10px; display:flex; flex-direction:column; gap:10px; }
.cat-label{ font-size:12px; color:var(--muted); padding:0 6px; }
.cat-select{ position:relative; user-select:none; }
.cat-btn{
  width:100%;
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  background: rgba(255,255,255,.06);
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:12px 14px; cursor:pointer;
  transition: background var(--speed), border-color var(--speed), transform var(--speed);
}
.cat-btn:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.25); transform: translateY(-1px); }
.cat-list{
  position:absolute; inset-inline:0; top: calc(100% + 8px); z-index:5;
  background: rgba(16,18,24,.98);
  border:1px solid var(--stroke);
  border-radius:16px;
  box-shadow: var(--shadow);
  padding:6px;
  display:none;
  max-height: 280px; overflow:auto;
}
.cat-item{
  padding:10px 12px; border-radius:10px; cursor:pointer;
  display:flex; align-items:center; justify-content:center; gap:8px;
  color:var(--text); font-weight:600;
  transition: background var(--speed), transform var(--speed);
  border-bottom: 1px dashed rgba(255,255,255,.08);
  text-align:center;
}
.cat-item:last-child{ border-bottom:none; }
.cat-item:hover{ background: rgba(255,255,255,.06); transform: translateY(-1px); }
.cat-item i{ color: var(--brand-2); }

/* Invoices list */
.invoices-list{ display:flex; flex-direction:column; gap:8px; margin-top:12px; }
.invoice-chip{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  background: rgba(255,255,255,.05);
  border:1px solid var(--stroke);
  padding:10px 12px; border-radius:12px; cursor:pointer;
  transition: background var(--speed), transform var(--speed);
}
.invoice-chip:hover{ background: rgba(255,255,255,.09); transform: translateY(-1px); }
.chip-meta{ display:flex; flex-direction:column; gap:4px; }
.chip-meta strong{ font-size:13px; }
.chip-meta small{ color:var(--muted); }

/* ====== Content ====== */
.content{ display:flex; flex-direction:column; gap:18px; }

/* Grid cards */
.grid{
  display:grid; grid-template-columns: repeat(3,1fr); gap:14px;
}
@media (max-width: 992px){
  .grid{ grid-template-columns: repeat(2,1fr); }
}
@media (max-width: 576px){
  .editor .ginput {
    flex: 1 1 100%;
  }
  .editor > div {
    flex-direction: column;
  }
  .gfield, .btn {
    font-size:14px;
    padding:10px 12px;
  }
}

.card{
  background: var(--glass);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:16px;
  overflow:hidden;
  position:relative;
}
.card .title{ display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-size:12px; margin-bottom:8px; }
.value{ font-weight:900; font-size:22px; letter-spacing:.3px; display:flex; align-items:center; gap:8px; }
.trend{ font-size:12px; color: var(--good); }

/* Editor */
.editor{ display: flex; flex-direction: column; gap: 12px; }
#searchInput { width: 100%; }
.card.table-wrap { margin-top: 20px; }

/* Footer */
.app-footer {
  position: sticky; bottom: 0; z-index: 50;
  backdrop-filter: blur(var(--blur));
  -webkit-backdrop-filter: blur(var(--blur));
  background: linear-gradient(to top, rgba(10,11,14,.85), rgba(10,11,14,.35));
  border-top: 1px solid var(--stroke);
}
.foot-wrap {
  max-width: 1200px;
  margin: auto;
  padding: 12px 18px;
  text-align: center;
  font-size: 13px;
  color: var(--muted);
}

/* Inputs and buttons */
.ginput{ display:flex; flex-direction:column; gap:8px; }
.glabel{ font-size:12px; color:var(--muted); padding:0 6px; }
.gfield{
  background: rgba(255,255,255,.06);
  border:1px solid var(--stroke);
  padding:12px 14px; border-radius:14px; color: var(--text);
  outline:none; transition: border-color var(--speed), background var(--speed), transform var(--speed);
  text-align:center;
  width:100%; max-width:100%;
}
.gfield::placeholder{ color: #93a0b8; }
.gfield:focus{ border-color: rgba(255,255,255,.35); background: rgba(255,255,255,.09); transform: translateY(-1px); }

.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:12px 14px; border:none; cursor:pointer; font-weight:800; letter-spacing:.3px;
  border-radius:14px; color:#0b0d13;
  background: linear-gradient(135deg, var(--brand-2), var(--brand-1));
  box-shadow: 0 8px 20px rgba(109,94,252,.35);
  transition: transform var(--speed), box-shadow var(--speed), filter var(--speed);
  width:100%; max-width:100%;
}
.btn:hover{ transform: translateY(-2px); filter: brightness(1.05); box-shadow: 0 10px 26px rgba(109,94,252,.45); }
.btn.green{ background:linear-gradient(135deg,#34d399,#10b981); color:#091018; }
.btn.amber{ background:linear-gradient(135deg,#f59e0b,#d97706); color:#0b0d13; }
.btn.blue{ background:linear-gradient(135deg,#60a5fa,#2563eb); color:#0b0d13; }

/* Table */
.table-wrap {
  padding: 0;
  overflow-x: auto;              /* ÙŠØ·Ù„Ø¹ Ø³ÙƒØ±ÙˆÙ„ Ø¥Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ø¹Ø±Ø¶ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
  -webkit-overflow-scrolling: touch; /* Ø³Ù„Ø§Ø³Ø© Ø¹Ù„Ù‰ iOS */
  border-radius: 14px;

  max-height: 300px;             /* ÙŠØ­Ø¯Ø¯ Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ (ØªÙ‚Ø¯ÙŠØ±Ø§Ù‹ 5 ØµÙÙˆÙ) */
  overflow-y: auto;              /* ÙŠØ®Ù„ÙŠ Ø³ÙƒØ±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÙŠ Ø¥Ø°Ø§ ØªØ¹Ø¯Ù‰ 5 ØµÙÙˆÙ */
}


table{
  width: 100%;
  min-width: 680px;            /* Ù†Ø®Ù„ÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£ÙƒØ¨Ø± Ø´ÙˆÙŠØ© Ø­ØªÙ‰ ÙŠØ·Ù„Ø¹ Scroll Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  border-collapse: collapse;
  table-layout: fixed;         /* Ø­ØªÙ‰ ÙŠÙ„ÙÙ‘ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
  background: rgba(255,255,255,.04);
  border: 1px solid var(--stroke);
  border-radius: 14px;
  overflow: hidden;
}

thead th, tbody td{
  word-break: break-word;      /* ÙŠÙƒØ³Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„ÙŠØ© */
  text-align: center;
  padding: 14px;
}

tbody tr:last-child td{ border-bottom:none; }



.btn-danger-custom {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  color: #fff;
  background: linear-gradient(45deg,#ef4444,#dc2626);
  border: none;
  cursor: pointer;
  transition: transform .2s, background .2s;
}
.btn-danger-custom:hover {
  background: linear-gradient(45deg,#dc2626,#b91c1c);
  transform: translateY(-2px);
}


#itemsTable td:last-child {
  text-align: center;
  vertical-align: middle;
}




/* ====== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ====== */
table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--stroke);   /* Ø­Ø¯ÙˆØ¯ Ø®Ø§Ø±Ø¬ÙŠØ© */
  border-radius: 14px;
  overflow: hidden;
}

/* Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
thead th {
  background: linear-gradient(135deg, #1e293b, #0f172a); /* ØªØ¯Ø±Ø¬ Ø¯Ø§ÙƒÙ† Ø£Ù†ÙŠÙ‚ (ÙƒØ­Ù„ÙŠ/Ø£Ø³ÙˆØ¯ Ù…Ø²Ø±Ù‚) */
  color: #f1f5f9;                          /* Ù†Øµ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ (Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø§Ø¦Ù„ Ù„Ù„Ø£Ø¨ÙŠØ¶) */
  font-weight: 700;                        /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
  padding: 14px;
  border: 1px solid rgba(255,255,255,.08); /* Ø­Ø¯ÙˆØ¯ Ù†Ø§Ø¹Ù…Ø© Ø¬Ø¯Ø§Ù‹ */
  text-align: center;
  letter-spacing: .5px;                    /* Ù…Ø³Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø±ÙˆÙ */
  font-size: 15px;
  text-transform: none;                    /* Ù†Ø®Ù„ÙŠ Ø§Ù„Ù†Øµ Ø·Ø¨ÙŠØ¹ÙŠ Ø¨Ø¯ÙˆÙ† Ø£Ø­Ø±Ù ÙƒØ¨ÙŠØ±Ø© */
  box-shadow: inset 0 -1px 6px rgba(0,0,0,.4); /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ ØºØ§Ù…Ù‚ ÙŠØ¶ÙŠÙ Ø¹Ù…Ù‚ */
}


/* Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
tbody td {
  padding: 12px;
  border: 1px solid #cbd5e1;  /* Ø®Ø·ÙˆØ· Ù†Ø§Ø¹Ù…Ø© Ø¨ÙŠÙ† Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
  text-align: center;
  font-size: 14px;
  color: #0f172a;             /* Ù†Øµ Ø¯Ø§ÙƒÙ† ÙˆØ§Ø¶Ø­ */
}




#itemsTable .btn-danger-custom {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
}






/* ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ Ø¨Ø§Ù„ØªÙ†Ø§ÙˆØ¨ */
/* ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
tbody tr:nth-child(even) {
  background-color: #f8fafc;  /* Ù„ÙˆÙ† ÙØ§ØªØ­ Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø²ÙˆØ¬ÙŠØ© */
}
tbody tr:nth-child(odd) {
  background-color: #e2e8f0;  /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ø´ÙˆÙŠ Ù„Ù„ØµÙÙˆÙ Ø§Ù„ÙØ±Ø¯ÙŠØ© */
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ */
tbody tr:hover {
  background: rgba(33,212,253,.15);  /* Ù‡Ø§ÙŠÙ„Ø§ÙŠØª Ø£Ù†ÙŠÙ‚ */
  transition: background 0.3s ease;
}




/* Floating button */
.fab{
  position:fixed; inset-inline-start:20px; inset-block-end:20px; z-index:60;
  width:58px; height:58px; display:grid; place-items:center; border-radius:50%;
  background: conic-gradient(from 180deg at 50% 50%, var(--brand-2), var(--brand-1), var(--brand-2));
  color:#0b0d13; font-size:20px; font-weight:900;
  box-shadow: 0 14px 35px rgba(100,95,255,.45);
  cursor:pointer; transition: transform var(--speed);
}
.fab:hover{ transform: translateY(-3px) rotate(-2deg); }

/* Toast */
.toast-container{ position: fixed; inset-block-start:18px; inset-inline:0; display:grid; place-items:center; z-index:70; }
.toast{
  background: rgba(20,24,33,.96);
  border: 1px solid var(--stroke);
  color: var(--text);
  padding:12px 16px; border-radius:12px; box-shadow: var(--shadow);
  display:none; align-items:center; gap:10px; font-weight:700;
}
.toast.show{ display:flex; animation: pop .3s ease; }
@keyframes pop{ from{ transform: translateY(-8px); opacity:.0; } to{ transform: translateY(0); opacity:1; } }

/* Search suggestions */
#autocompleteSuggestions{
  position: absolute; inset-inline:0; inset-block-start:100%; margin-block-start:6px;
  background: rgba(16,18,24,.98);
  border:1px solid var(--stroke);
  border-radius:14px;
  max-height:240px; overflow:auto; z-index:40; display:none;
}
#autocompleteSuggestions li{
  list-style:none; padding:10px 12px; cursor:pointer; text-align:center; color:#eaf0ff;
  border-bottom:1px dashed rgba(255,255,255,.08);
}
#autocompleteSuggestions li:last-child{ border-bottom:none; }
#autocompleteSuggestions li:hover{ background: rgba(255,255,255,.06); }

/* Responsive header + footer for small screens */
@media (max-width:576px){
  .brand .badge{ width:32px; height:32px; font-size:14px; }
  .head-actions .icon-btn{ width:34px; height:34px; }
  .head-wrap, .foot-wrap{ padding:10px 12px; }
}



/* ===== Auth Overlay (Login) ===== */
.auth-overlay{
  position: fixed; inset: 0; z-index: 9999;
  display: none;                 /* Ù†Ø¨Ø¯ÙŠ Ù…Ø®ÙÙŠ */
  align-items: center; justify-content: center;
  background: rgba(10,11,14,.55);          /* Ø´ÙØ§ÙÙŠØ© */
  backdrop-filter: blur(10px);             /* Blur Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© */
  -webkit-backdrop-filter: blur(10px);
}

.auth-card{
  width: min(420px, 92%);
  background: rgba(20,24,33,.92);
  border: 1px solid rgba(255,255,255,.14);
  border-radius: 18px;
  box-shadow: 0 18px 50px rgba(0,0,0,.45);
  padding: 22px 18px;
  color: #eaf0ff;
  animation: pop .25s ease;
}

.auth-head{
  display:flex; align-items:center; gap:12px; margin-bottom:14px;
}
.auth-badge{
  width:44px; height:44px; display:grid; place-items:center;
  border-radius:12px;
  background: radial-gradient(120% 120% at 20% 20%, #21d4fd, #6d5efc);
  color:#0b0d13; font-weight:900; font-size:18px;
  box-shadow: 0 12px 30px rgba(109,94,252,.45);
}
.auth-title{ font-weight:800; letter-spacing:.2px; }
.auth-sub{ color:#aab0c0; font-size:12px; margin-top:2px; }

.auth-group{ display:flex; flex-direction:column; gap:8px; margin-top:12px; }
.auth-input{
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.14);
  border-radius: 14px; padding: 12px 14px; color:#fff;
  outline:none; text-align:center; transition: .2s;
}
.auth-input::placeholder{ color:#93a0b8; }
.auth-input:focus{ border-color: rgba(255,255,255,.35); background: rgba(255,255,255,.09); }

.auth-btn{
  width:100%; margin-top:14px;
  display:inline-flex; align-items:center; justify-content:center; gap:10px;
  padding:12px 14px; border:none; cursor:pointer; font-weight:800; letter-spacing:.3px;
  border-radius:14px; color:#0b0d13;
  background: linear-gradient(135deg, #21d4fd, #6d5efc);
  box-shadow: 0 10px 26px rgba(109,94,252,.45);
  transition: transform .2s, filter .2s;
}
.auth-btn:hover{ transform: translateY(-2px); filter: brightness(1.05); }

.auth-btn[disabled]{ opacity:.7; cursor:not-allowed; filter:grayscale(0.2); }

.auth-err{
  display:none; margin-top:10px;
  padding:10px 12px; border-radius:12px;
  background: linear-gradient(135deg,#ef4444,#dc2626);
  color:#fff; font-weight:700; text-align:center;
  box-shadow: 0 10px 24px rgba(239,68,68,.35);
}
.shake{ animation: shake .35s ease; }
@keyframes shake{
  10%, 90% { transform: translateX(-2px); }
  20%, 80% { transform: translateX(4px); }
  30%, 50%, 70% { transform: translateX(-6px); }
  40%, 60% { transform: translateX(6px); }
}

.auth-hint{ margin-top:10px; color:#aab0c0; font-size:12px; text-align:center; }

.auth-row{
  display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:8px;
}
.auth-mini{
  font-size:12px; color:#aab0c0; cursor:pointer; user-select:none;
}
.toggle-pass{
  position:absolute; inset-inline-end:10px; inset-block-start:50%;
  transform: translateY(-50%); cursor:pointer; color:#aab0c0;
}

@keyframes pop{ from{ transform:translateY(8px); opacity:.0 } to{ transform:translateY(0); opacity:1 } }





  </style>
</head>
<body>
  
  
  
  
  <!-- ===== Login Overlay ===== -->
<div class="auth-overlay" id="authOverlay">
  <div class="auth-card">
    <div class="auth-head">
      <div class="auth-badge">A</div>
      <div>
        <div class="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ ASSAL OFFICE</div>
        <div class="auth-sub">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± â€¢ Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ø­Ù…ÙŠ</div>
      </div>
    </div>

    <div class="auth-group" style="position:relative;">
      <input id="emailInput" class="auth-input" type="email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" autocomplete="username" />
    </div>

    <div class="auth-group" style="position:relative;">
      <input id="passwordInput" class="auth-input" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" autocomplete="current-password" />
      <i class="fa-regular fa-eye toggle-pass" id="togglePass" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡"></i>
    </div>

    <button id="loginBtn" class="auth-btn">
      <i class="fa-solid fa-right-to-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </button>

    <div id="authErr" class="auth-err">Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
    <div class="auth-hint">Ø¯Ø®ÙˆÙ„Ùƒ ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² â€¢ Ù…Ø§ ØªØ­ØªØ§Ø¬ ØªØ¹ÙŠØ¯ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©</div>
  </div>
</div>

  
  

  
  
  
  
  <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« -->
<div id="reloadModal">
  <div class="reload-box">
    <div class="loader"></div>
    <p id="reloadText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
  </div>
</div>

  
  
  
  
  <!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø© -->
<div id="confirmModal" class="auth-overlay">
  <div class="auth-card" style="max-width:360px; text-align:center;">
    <div class="auth-head" style="justify-content:center;">
      <div class="auth-badge"><i class="fa-solid fa-circle-question"></i></div>
      <div>
        <div class="auth-title">Ø§Ù„Ù…Ø§Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„</div>
        <div class="auth-sub">Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø¯ ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŸ</div>
      </div>
    </div>
    <div style="display:flex; gap:10px; margin-top:14px;">
      <button id="confirmYes" class="btn green"><i class="fa-solid fa-check"></i> Ù†Ø¹Ù…</button>
      <button id="confirmNo" class="btn amber"><i class="fa-solid fa-xmark"></i> Ù„Ø§</button>
    </div>
  </div>
</div>

  
<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
<div id="logoutModal" class="auth-overlay">
  <div class="auth-card" style="max-width:360px; text-align:center;">
    <div class="auth-head" style="justify-content:center;">
      <div class="auth-badge"><i class="fa-solid fa-circle-question"></i></div>
      <div>
        <div class="auth-title">Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ</div>
        <div class="auth-sub">Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
      </div>
    </div>
    <div style="display:flex; gap:10px; margin-top:14px;">
      <button id="logoutYes" class="btn green"><i class="fa-solid fa-check"></i> Ù†Ø¹Ù…</button>
      <button id="logoutNo" class="btn amber"><i class="fa-solid fa-xmark"></i> Ù„Ø§</button>
    </div>
  </div>
</div>
  
  
  
  

  <!-- ====== Header ====== -->
  <header class="app-header">
    <div class="head-wrap">
      <div class="brand">
  <div class="badge">A</div>
  <span style="font-weight:700; font-size:18px;">ASSAL OFFICE</span>
</div>

      <div class="head-actions">
        <button class="icon-btn" id="btnNew" title="ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©"><i class="fa-solid fa-plus"></i></button>
      <!-- Ø²Ø± ØªØ­Ø¯ÙŠØ« -->
<button class="icon-btn" id="btnReload" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©">
  <i class="fa-solid fa-rotate-right"></i>
</button>


<button class="icon-btn" id="btnLogout" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">
  <i class="fa-solid fa-right-from-bracket"></i>
</button>

      </div>
    </div>
  </header>

  <!-- ====== Layout ====== -->
  <main class="layout">

    <!-- ====== Sidebar ====== -->
    <aside class="sidebar" id="sidebar">
      <div class="panel-title">
        <h3><i class="fa-regular fa-folder-open"></i> Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
        <span class="pill">Ø§Ù„ÙŠÙˆÙ…</span>
      </div>

    

      <!-- Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ù†ÙØ³ Ø§Ù„Ù€ id Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„ÙƒÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙŠØ·) -->
      <div class="invoices-list" id="invoicesDropdown"></div>
    </aside>

    <!-- ====== Content ====== -->
    <section class="content">


      <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
      <div class="card" style="display:flex; align-items:center; gap:12px;">
        <i class="fa-regular fa-file-lines" style="font-size:28px; color:#21d4fd;"></i>
        <div>
          <div style="font-weight:800; letter-spacing:.2px;">ÙØ§ØªÙˆØ±Ø© Ø­Ø§Ù„ÙŠØ©</div>
          <div style="color:var(--muted); font-size:12px;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="invoiceId">-</span></div>
        </div>
      </div>

      <!-- Ù…Ø­Ø±Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
      <div class="card">
        <div class="title"><span><i class="fa-solid fa-pen-to-square"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</span><span class="muted">Editor</span></div>

       <div class="editor">

  <!-- Ø§Ù„ØµÙ†Ù -->
  <div class="category">
    <!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
    <div class="cat-select" id="catSelect">
      <div class="cat-btn" id="catBtn">
        <span id="catText"><i class="fa-solid fa-layer-group"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ†Ù</span>
        <i class="fa-solid fa-chevron-down"></i>
      </div>

      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù -->
      <div class="cat-list" id="catList">
        <div class="cat-item" data-val="LCD"><i class="fa-solid fa-tv"></i> Ø´Ø§Ø´Ø§Øª</div>
        <div class="cat-item" data-val="BATTERY"><i class="fa-solid fa-bolt"></i> Ø¨Ø·Ø§Ø±ÙŠØ§Øª</div>
        <div class="cat-item" data-val="CAMERA"><i class="fa-solid fa-camera"></i> ÙƒØ§Ù…ÙŠØ±Ø§Øª</div>
        <div class="cat-item" data-val="CHARGING"><i class="fa-solid fa-plug"></i> Ø´Ø­Ù†</div>
        <div class="cat-item" data-val="HEADPHONE"><i class="fa-solid fa-headphones"></i> Ø³Ù…Ø§Ø¹Ø©</div>
        <div class="cat-item" data-val="HOUSING"><i class="fa-solid fa-border-none"></i> Ø´ÙˆØ§ØµÙŠ</div>
        <div class="cat-item" data-val="BACK"><i class="fa-solid fa-mobile-screen"></i> Ø£Ø¸Ù‡Ø±</div>
        <div class="cat-item" data-val="BUZZER"><i class="fa-solid fa-bell"></i> Ø¬Ø±Ø³</div>
        <div class="cat-item" data-val="FINGER"><i class="fa-solid fa-fingerprint"></i> Ø¨ØµÙ…Ø©</div>
        <div class="cat-item" data-val="NO-CATEGORY"><i class="fa-regular fa-square"></i> Ø¨Ø¯ÙˆÙ† ØµÙ†Ù</div>
      </div>
    </div>

    <!-- Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ -->
    <input id="categorySelect" type="hidden" />
  </div>

  <!-- Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© -->
  <div class="ginput">
    <div style="position:relative;">
      
      
   <input id="searchInput" class="gfield" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©..." 
       lang="en" style="ime-mode:disabled;" oninput="showSuggestions()" />
     
     
     
      <ul id="autocompleteSuggestions"></ul>
    </div>
  </div>

  <!-- Ø§Ù„Ø¹Ø¯Ø¯ + Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†ÙØ³ Ø§Ù„ØµÙ -->
  <div style="display:flex; gap:12px;">
    <div class="ginput" style="flex:1;">
      <input id="itemQty" class="gfield" type="text" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹" />
    </div>
    <div class="ginput" style="flex:1;">
      <input id="itemNote" class="gfield" type="text" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" />
    </div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± -->
  <div class="ginput" style="display:flex; gap:10px;">
    
    
    
   <button id="btnAddItem" class="btn" type="button" onclick="addItem()">
  <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ©
</button>
    
    
    
    <button class="btn green" onclick="saveInvoice()"><i class="fa-regular fa-floppy-disk"></i> Ø­ÙØ¸</button>
    <button class="btn blue" onclick="exportPDF()"><i class="fa-regular fa-file-pdf"></i> PDF</button>
  </div>
</div>
      <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
      <div class="card table-wrap">
        <table id="itemsTable">
          <thead>
            <tr>
              <th>Ø§Ù„ØµÙ†Ù</th>
              <th>Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
              <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
              <th>Ø¥Ø²Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </section>
  </main>

  <!-- Ø²Ø± Ø¹Ø§Ø¦Ù… = ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
  <button class="fab" id="fab" title="ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©">
    <i class="fa-solid fa-plus"></i>
  </button>

  <!-- Toast -->
  <div class="toast-container">
    <div class="toast" id="appToast">
      <i class="fa-solid fa-circle-check" style="color:#34d399;"></i>
      <span>ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.</span>
    </div>
  </div>
  
  
  
  
   
    <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
  const firebaseConfig = {
    apiKey: "AIzaSyCQvdUYJmysi5PuOoI5xYvsgBCwG8Xi9Xw",
    authDomain: "assal-invoice.firebaseapp.com",
    projectId: "assal-invoice",
    storageBucket: "assal-invoice.firebasestorage.app",
    messagingSenderId: "867466471896",
    appId: "1:867466471896:web:2fb92a2fc3ad3778a4eaad"
  };

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³
  const app = initializeApp(firebaseConfig);
  window.db = getFirestore(app); // Ù†Ø³ÙˆÙŠÙ‡Ø§ global Ø­ØªÙ‰ Ù†ÙƒØ¯Ø± Ù†Ø³ØªØ¹Ù…Ù„Ù‡Ø§ Ø¨Ø£ÙŠ Ø¯Ø§Ù„Ø©
</script>



<script type="module">
  import { getAuth, setPersistence, browserLocalPersistence, 
           onAuthStateChanged, signInWithEmailAndPassword } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  // Ù†Ø¬ÙŠØ¨ app Ù…Ù† Ø³ÙƒØ±Ø¨Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚
  const auth = getAuth();

  // Ù†Ø®Ù„ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙŠØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ù…Ø±Ø© ÙˆØ­Ø¯Ø© ØªÙƒÙÙŠ)
  await setPersistence(auth, browserLocalPersistence);

  const overlay = document.getElementById("authOverlay");
  const emailEl = document.getElementById("emailInput");
  const passEl  = document.getElementById("passwordInput");
  const btn     = document.getElementById("loginBtn");
  const errBox  = document.getElementById("authErr");
  const togglePass = document.getElementById("togglePass");

  // Ø¥Ø°Ø§ Ù…Ø®Ø²Ù†ÙŠÙ† Ø¥ÙŠÙ…ÙŠÙ„ Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŒ Ù†ÙØ±Ù‘ØºÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø§Ù„Ø­Ù‚Ù„ (Ù…Ùˆ Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø£Ù† Ø§Ù„Ø¬Ù„Ø³Ø© ØªØ¨Ù‚Ù‰ØŒ Ø¨Ø³ Ù…ÙÙŠØ¯ Ù„Ùˆ ØµØ§Ø± Logout)
  const savedEmail = localStorage.getItem("savedEmail");
  if(savedEmail) emailEl.value = savedEmail;

  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
  togglePass.addEventListener("click", ()=>{
    const isPwd = passEl.type === "password";
    passEl.type = isPwd ? "text" : "password";
    togglePass.classList.toggle("fa-eye");
    togglePass.classList.toggle("fa-eye-slash");
  });

  // Ù†Ø±Ø§Ù‚Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: Ø¥Ø°Ø§ Ø¯Ø§Ø®Ù„ Ù†Ø®ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©ØŒ Ø¥Ø°Ø§ Ù„Ø§ Ù†Ø¹Ø±Ø¶Ù‡Ø§
onAuthStateChanged(auth, (user)=>{
  if(user){
    overlay.style.display = "none";
    // Ù†Ø®Ø²Ù‘Ù† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø±Ù‘Ø© ÙˆØ­Ø¯Ø©
    if(user.email) localStorage.setItem("savedEmail", user.email);

    // ğŸ‘‡ Toast Ø±Ø³Ø§Ù„Ø© ÙƒÙ„ Ù…Ø±Ø© ÙŠØ¯Ø®Ù„ Ø¨ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if(window.showToast){
      const name  = user.displayName || ""; 
      const email = user.email || "";
      window.showToast(`ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ ${name || "Ø¨Ùƒ"} â€¢ Ø§Ù†Øª Ø¯Ø§Ø®Ù„ Ø¨Ø­Ø³Ø§Ø¨ ${email}`);
    }

  } else {
    overlay.style.display = "flex";
  }
});
  // ØªØ±Ø¬Ù…Ø© Ø£Ø®Ø·Ø§Ø¡ Firebase Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ø±Ø¨ÙŠØ© Ø£Ù†ÙŠÙ‚Ø©
  function mapAuthError(code){
    switch(code){
      case "auth/invalid-credential": 
      case "auth/wrong-password":     return "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
      case "auth/user-not-found":     return "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„.";
      case "auth/invalid-email":      return "ØµÙŠØºØ© Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
      case "auth/too-many-requests":  return "Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©. Ø¬Ø±Ù‘Ø¨ Ù„Ø§Ø­Ù‚Ø§Ù‹.";
      case "auth/network-request-failed": return "Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù†Øª.";
      default: return "ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
    }
  }

  // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  btn.addEventListener("click", async ()=>{
    const email = emailEl.value.trim();
    const pass  = passEl.value;

    // UI lock
    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
    errBox.style.display = "none";

    try{
      const cred = await signInWithEmailAndPassword(auth, email, pass);
      // Ù†Ø¬Ø§Ø­: onAuthStateChanged Ø±Ø§Ø­ ÙŠØ®ÙÙŠ Ø§Ù„Ù€ overlay ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    }catch(e){
      // ÙØ´Ù„: Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¹ÙˆÙ…Ø© + Ø±Ø¬Ù‘Ø© Ø®ÙÙŠÙØ©
      errBox.textContent = mapAuthError(e.code || "");
      errBox.style.display = "block";
      errBox.classList.remove("shake");
      void errBox.offsetWidth; // reflow Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
      errBox.classList.add("shake");
    }finally{
      btn.disabled = false;
      btn.innerHTML = '<i class="fa-solid fa-right-to-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
    }
  });

  // Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ù€ Enter
  passEl.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") btn.click();
  });
</script>




  
  

  <script>
    
  
    /* =========================
       Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© (Ù†ÙØ³ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
       ========================= */
    let currentInvoice = null;                                             // Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    let invoices = JSON.parse(localStorage.getItem("invoices") || "[]");   // ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù†Ø©
    let selectedInvoiceIndex = null;                                       // Ù…Ø¤Ø´Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    let database = {};                                                     // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù Ù…Ù† Ø§Ù„Ø¥ÙƒØ³Ù„
    let currentCategory = "";                                              // Ø§Ù„ØµÙ†Ù Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®ØªØ§Ø±



// Ù†Ù†Ø´Ø±Ù‡Ù… Ø¹Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù… Ø­ØªÙ‰ ÙŠÙ„ÙƒØ§Ù‡Ù… Ø£ÙŠ Ø³ÙƒØ±Ø¨Øª module
window.currentInvoice = currentInvoice;
window.invoices = invoices;
window.selectedInvoiceIndex = selectedInvoiceIndex;



    // Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ (Ù†ÙØ³Ùƒ)
    const dropboxMainFile = "https://assap-app-project.ahmed-al-bayatii-90.workers.dev/file1?t=" + new Date().getTime();






function reloadPage(){
  const modal = document.getElementById("reloadModal");
  const text  = document.getElementById("reloadText");

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
  modal.style.display = "flex";
  text.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...";

  // Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù†ØºÙŠØ± Ø§Ù„Ù†Øµ
  setTimeout(()=>{
    text.textContent = "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…";
  }, 2000);

  // Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ Ù†Ø¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙØ¹Ù„ÙŠØ§Ù‹
  setTimeout(()=>{
    window.location.reload();
  }, 3000);
}






    /* =========================
       ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¥ÙƒØ³Ù„
       ========================= */
    async function loadExcelFiles(){
      try{
        const response = await fetch(dropboxMainFile, { cache: 'no-store' });
        const buffer = await response.arrayBuffer();
        const workbook = XLSX.read(buffer, { type:"array" });
        database = {
          LCD      : XLSX.utils.sheet_to_json(workbook.Sheets["LCD"]      || {}, {defval:null}),
          BATTERY  : XLSX.utils.sheet_to_json(workbook.Sheets["BATTERY"]  || {}, {defval:null}),
          HOUSING  : XLSX.utils.sheet_to_json(workbook.Sheets["HOUSING"]  || {}, {defval:null}),
          BACK     : XLSX.utils.sheet_to_json(workbook.Sheets["BACK"]     || {}, {defval:null}),
          CAMERA   : XLSX.utils.sheet_to_json(workbook.Sheets["CAMERA"]   || {}, {defval:null}),
          CHARGING : XLSX.utils.sheet_to_json(workbook.Sheets["CHARGING"] || {}, {defval:null}),
          BUZZER   : XLSX.utils.sheet_to_json(workbook.Sheets["BUZZER"]   || {}, {defval:null}),
          HEADPHONE: XLSX.utils.sheet_to_json(workbook.Sheets["HEADPHONE"]|| {}, {defval:null}),
          FINGER   : XLSX.utils.sheet_to_json(workbook.Sheets["FINGER"]   || {}, {defval:null})
        };
      }catch(err){
        console.error("âŒ Ø®Ø·Ø£ ØªØ­Ù…ÙŠÙ„:", err);
        showToast("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âŒ", true);
      }
    }

    /* =========================
       Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
       ========================= */
    function normalizeString(str){ return (str||"").replace(/\s+/g,'').toLowerCase(); }

    function getDayNameAr(d){
      return ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"][d.getDay()];
    }

    function formatInvoiceName(){
      const d = new Date();
      return `ÙØ§ØªÙˆØ±Ø© ${getDayNameAr(d)} - ${d.toLocaleDateString("ar-EG")}`;
    }

    /* =========================
       Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù
       ========================= */
  function showSuggestions(){
  const q = normalizeString(document.getElementById("searchInput").value.trim());
  const suggestions = document.getElementById("autocompleteSuggestions");
  suggestions.innerHTML = ""; 
  suggestions.style.display = "none";

  if(!q || !document.getElementById("categorySelect").value) return;
  currentCategory = document.getElementById("categorySelect").value;
  if(currentCategory === "NO-CATEGORY") return;

  const list = database[currentCategory] || [];
  const filtered = list.filter(it=>{
    const name = normalizeString(it["Item Name"] || it["Item"] || "");
    return name.includes(q);
  });

  if(filtered.length > 0){
    suggestions.style.display = "block";
    filtered.slice(0,20).forEach(it=>{
      const li = document.createElement("li");
      li.className = "list-group-item list-group-item-action";
      li.textContent = it["Item Name"] || it["Item"];

      // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ ğŸ‘‡
      li.addEventListener("click", ()=>{
        document.getElementById("searchInput").value = li.textContent;
        suggestions.style.display = "none";
        document.getElementById("itemQty").focus(); // ÙŠÙ†Ø²Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø¯
      });

      suggestions.appendChild(li);
    });
  }
}


    /* =========================
       Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ù„Ù„ÙØ§ØªÙˆØ±Ø©
       ========================= */
 /* =========================
   Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ù„Ù„ÙØ§ØªÙˆØ±Ø© (Ù…Ø¹Ø¯Ù„Ø©)
   ========================= */
function addItem(){
  if(!currentInvoice){
    showToast("âš ï¸ Ø£Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹","danger");
    return;
  }

  const category = document.getElementById("categorySelect").value;
  const name     = document.getElementById("searchInput").value.trim();
  const qty      = document.getElementById("itemQty").value.trim() || "1";
  const note     = document.getElementById("itemNote").value.trim() || "";

  if(!category || !name){
    showToast("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„ØµÙ†Ù ÙˆØ§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©","danger");
    return;
  }

  // Ù‡Ù„ Ø§Ù„Ù…Ø§Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£ØµÙ„Ø§Ù‹ØŸ
  const existingIndex = currentInvoice.items.findIndex(
    (it) => it.category === category && it.name === name
  );

  if(existingIndex !== -1){
    // ğŸ‘‡ Ù†ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
    const modal = document.getElementById("confirmModal");
    modal.style.display = "flex";

    // Ø²Ø± Ù†Ø¹Ù…
    document.getElementById("confirmYes").onclick = async ()=>{
      currentInvoice.items[existingIndex].qty  = qty;
      currentInvoice.items[existingIndex].note = note;

      renderItems();

      // âœ… Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
      autoSaveInvoice();

      // âœ… Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ
      if (typeof window.saveInvoice === "function") {
        await window.saveInvoice();
      }

      modal.style.display = "none";
      showToast("âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©","info");

      // âœ¨ Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©
      document.getElementById("searchInput").value="";
      document.getElementById("itemQty").value="";
      document.getElementById("itemNote").value="";
      document.getElementById("searchInput").focus();
    };

    // Ø²Ø± Ù„Ø§
    document.getElementById("confirmNo").onclick = ()=>{
      modal.style.display = "none";
    };

  } else {
    // ğŸ‘‡ Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
    currentInvoice.items.push({category,name,qty,note});
    renderItems();

    // âœ… Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
    autoSaveInvoice();

    // âœ… Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ
    if (typeof window.saveInvoice === "function") {
      window.saveInvoice();
    }

    showToast("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©","success");

    // âœ¨ ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById("searchInput").value="";
    document.getElementById("itemQty").value="";
    document.getElementById("itemNote").value="";
    document.getElementById("searchInput").focus();
  }
}


    /* =========================
       Ø±Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
       ========================= */
    function renderItems(){
      const tbody = document.querySelector("#itemsTable tbody");
      tbody.innerHTML = "";
      if(!currentInvoice) return;

      currentInvoice.items.forEach((it, i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${it.category}</td>
          <td>${it.name}</td>
          <td>${it.qty}</td>
          <td>${it.note}</td>
          <td>
            <button class="btn-danger-custom" onclick="removeItem(${i})" title="Ø­Ø°Ù">
              <i class="fa-regular fa-trash-can"></i>
            </button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function removeItem(i){
      currentInvoice.items.splice(i,1);
      renderItems();
    }
    
    
    
    
    
    

    /* =========================
       Ø¥Ù†Ø´Ø§Ø¡ / Ø­ÙØ¸ / ÙØªØ­ / Ø­Ø°Ù ÙÙˆØ§ØªÙŠØ±
       ========================= */
    function newInvoice(){
  const today = new Date().toLocaleDateString("ar-EG");
  const existingIndex = invoices.findIndex(inv => inv.date === today);

  if(existingIndex !== -1){
    currentInvoice = invoices[existingIndex];
    selectedInvoiceIndex = existingIndex;
    showToast("ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙŠÙˆÙ… Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ âœ…","info");
  }
  else {
    currentInvoice = { 
      id: formatInvoiceName(), 
      date: today, 
      items: [] 
    };
    invoices.push(currentInvoice);
    selectedInvoiceIndex = invoices.length - 1;
    showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© âœ…","success");
  }

  document.getElementById("invoiceId").textContent = currentInvoice.id;
  renderItems();
  renderInvoicesDropdown();
  syncGlobals();
}

    
    
 function autoSaveInvoice(){
  if(!currentInvoice) return;

  if(selectedInvoiceIndex !== null){
    invoices[selectedInvoiceIndex] = currentInvoice;
  } else {
    invoices.push(currentInvoice);
    selectedInvoiceIndex = invoices.length - 1;
  }

  // âœ… ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ Ø£Ù‚ØµÙ‰ (3 ÙÙˆØ§ØªÙŠØ±)
  if (invoices.length > 3) {
    invoices.shift(); 
    selectedInvoiceIndex = invoices.length - 1;
  }

  localStorage.setItem("invoices", JSON.stringify(invoices));
  renderInvoicesDropdown();
  syncGlobals();
  showToast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© âœ…","success");
}

    

    function renderInvoicesDropdown(){
      const wrap = document.getElementById("invoicesDropdown");
      wrap.innerHTML = "";
      invoices.forEach((inv, i)=>{
        const row = document.createElement("div");
        row.className = "invoice-chip";
        row.innerHTML = `
          <div class="chip-meta">
            <strong>${inv.id}</strong>
            <small>${inv.date} â€¢ ${inv.items.length} Ù…Ø§Ø¯Ø©</small>
          </div>
          <button class="btn-danger-custom" title="Ø­Ø°Ù" onclick="deleteInvoice(${i}); event.stopPropagation();">
            <i class="fa-regular fa-trash-can"></i>
          </button>
        `;
        row.onclick = ()=> loadInvoice(i);
        wrap.appendChild(row);
      });
    }

    function loadInvoice(i){
      selectedInvoiceIndex = i;
      currentInvoice = invoices[i];
      document.getElementById("invoiceId").textContent = currentInvoice.id;
      renderItems();
      showToast("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ“„");
    }

    function deleteInvoice(i){
      invoices.splice(i,1);
      localStorage.setItem("invoices", JSON.stringify(invoices));
      currentInvoice = null;
      document.getElementById("invoiceId").textContent = "-";
      renderItems();
      selectedInvoiceIndex = null;
      renderInvoicesDropdown();
      showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ—‘ï¸");
    }
    
    
    
    
    function syncGlobals(){
  window.currentInvoice = currentInvoice;
  window.invoices = invoices;
  window.selectedInvoiceIndex = selectedInvoiceIndex;
}

  

    /* =========================
       ØªØµØ¯ÙŠØ± PDF Ø¨Ø´ÙƒÙ„ Ø£Ù†ÙŠÙ‚ Ø¨Ø§Ù„Ø¥Ù†ÙƒÙ„ÙŠØ²ÙŠ
       ========================= */
 function exportPDF() {
  if (!currentInvoice || currentInvoice.items.length === 0) {
    showToast("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±", "danger");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "p", unit: "pt", format: "a4" });

  // âœ¨ ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØµÙ†Ù ÙˆØ§Ù„Ø§Ø³Ù…
  const sortedItems = [...(currentInvoice.items || [])].sort((a, b) => {
    const catCompare = (a.category || "").localeCompare(b.category || "", "ar", { sensitivity: "base" });
    if (catCompare !== 0) return catCompare;
    return (a.name || "").localeCompare(b.name || "", "ar", { sensitivity: "base" });
  });

  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();

  // âœ¨ Ø§Ù„Ù‡ÙŠØ¯Ø±
  doc.setFont("helvetica", "bold");
  doc.setFontSize(22);
  doc.setTextColor(25, 25, 112);
  doc.text("ASSAL OFFICE", pageWidth / 2, 65, { align: "center" });

  doc.setFontSize(12);
  doc.setTextColor(100);
  doc.text("YOUR BEST CHOICE", pageWidth / 2, 85, { align: "center" });

  // âœ¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  const today = new Date();
  const invoiceDate = today.toLocaleDateString("en-GB");
  const invoiceId = `INV-${today.getFullYear()}${(today.getMonth() + 1).toString().padStart(2, "0")}${today.getDate().toString().padStart(2, "0")}`;

  doc.setFont("helvetica", "normal");
  doc.setFontSize(12);
  doc.setTextColor(0);
  doc.text(`Invoice ID: ${invoiceId}`, pageWidth - 60, 120, { align: "right" });
  doc.text(`Date: ${invoiceDate}`, 60, 120, { align: "left" });

  // âœ¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
  doc.autoTable({
    head: [["#", "Ø§Ù„ØµÙ†Ù", "Ø§Ù„Ù‚Ø·Ø¹Ø©", "Ø§Ù„Ø¹Ø¯Ø¯", "Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]],
    body: sortedItems.map((it, i) => [i + 1, it.category, it.name, it.qty, it.note]),
    startY: 160,
    theme: "grid",
    styles: { halign: "center", font: "helvetica", fontSize: 11 },
    headStyles: { fillColor: [40, 90, 160], textColor: [255, 255, 255], fontStyle: "bold" },
    alternateRowStyles: { fillColor: [245, 245, 245] },
    margin: { left: 50, right: 50 },
    didDrawPage: (data) => {
      // â¬› Ø§Ù„Ø¥Ø·Ø§Ø± ÙÙŠ ÙƒÙ„ ØµÙØ­Ø©
      doc.setDrawColor(80, 80, 80);
      doc.setLineWidth(1.5);
      doc.rect(30, 30, pageWidth - 60, pageHeight - 60, "S");

      // âœ¨ ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª
      const pageCount = doc.internal.getNumberOfPages();
      const pageCurrent = doc.internal.getCurrentPageInfo().pageNumber;
      doc.setFontSize(10);
      doc.setTextColor(100);
      doc.text(`ØµÙØ­Ø© ${pageCurrent} Ù…Ù† ${pageCount}`, pageWidth / 2, pageHeight - 20, { align: "center" });
    }
  });

  doc.save(`Invoice_${invoiceId}.pdf`);
  showToast("âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø±ØªØ¨Ø© + Ù…Ø¹ ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª", "success");
}


    /* =========================
       Toast Ø¨Ø³ÙŠØ·
       ========================= */
    function showToast(message, isError){
      const toast = document.getElementById("appToast");
      toast.querySelector("span").textContent = message || "Done";
      toast.style.borderColor = isError ? "rgba(239,68,68,.6)" : "var(--stroke)";
      toast.firstElementChild.style.color = isError ? "#ef4444" : "#34d399";
      toast.classList.add("show");
      clearTimeout(window.__t);
      window.__t = setTimeout(()=> toast.classList.remove("show"), 2200);
    }

    /* =========================
       Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…
       ========================= */
    document.getElementById("btnNew").addEventListener("click", newInvoice);
   document.getElementById("btnReload").addEventListener("click", reloadPage);
    document.getElementById("fab").addEventListener("click", newInvoice);

    /* =========================
       Ù…Ù†Ø·Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®ØµØµØ©
       ========================= */
    const catBtn  = document.getElementById('catBtn');
    const catList = document.getElementById('catList');
    const catText = document.getElementById('catText');

    catBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const visible = catList.style.display==='block';
      document.querySelectorAll('.cat-list').forEach(el=> el.style.display='none');
      catList.style.display = visible ? 'none' : 'block';
    });

   document.querySelectorAll('.cat-item').forEach(it=>{
  it.addEventListener('click', ()=>{
    const val = it.getAttribute('data-val');
    document.getElementById('categorySelect').value = val;              // Ù†Ø­Ø¯Ù‘Ø« Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙ†Ù (Ø§Ù„Ù‚Ø¯ÙŠÙ…)
    catText.innerHTML = it.innerHTML;                                   // Ù†Ø­Ø¯Ù‘Ø« Ù†Øµ Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    catList.style.display='none';
    showToast('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ†Ù âœ…');
    document.getElementById("searchInput").focus(); // ÙŠÙ†Ù‚Ù„Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
  });
});

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', ()=> { catList.style.display='none'; });

    /* =========================
       ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
       ========================= */
    window.addEventListener("load", ()=>{
      loadExcelFiles();
      renderInvoicesDropdown();
    });
    
    
    
     // Ø±Ø¨Ø· Enter Ø¨Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
  document.getElementById("searchInput").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      e.preventDefault(); // ÙŠÙ…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯
      document.getElementById("itemQty").focus(); // ÙŠÙ†Ù‚Ù„Ùƒ Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¹Ø¯Ø¯
    }
  });

  document.getElementById("itemQty").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      document.getElementById("itemNote").focus(); // ÙŠÙ†Ù‚Ù„Ùƒ Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    }
  });
    
    
 document.getElementById("itemNote").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();

    if (!currentInvoice) {
      showToast("âš ï¸ Ø£Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹", "danger");
      return;
    }

    addItem();
    autoSaveInvoice();           // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ
    window.saveInvoice && window.saveInvoice();  // Ø­ÙØ¸ Ø³Ø­Ø§Ø¨ÙŠ Ø£ÙŠØ¶Ø§Ù‹
    showToast("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", "success");
    document.getElementById("searchInput").focus();
  }
});

    
  </script>
  
  
  <!-- ====== Footer ====== -->
  <footer class="app-footer">
    <div class="foot-wrap">
      <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ù…ÙƒØªØ¨ Ø¹Ø³Ù„ 2025</span>
    </div>
  </footer>
  
  
  
 <!-- Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© saveInvoice Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„ÙˆÙƒ -->
<script type="module">
  import { getFirestore, doc, setDoc } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
  import { getAuth } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const db = window.db || getFirestore();
  const auth = getAuth();
  
  
  
  async function safeFetch(url, options) {
    try {
      const res = await fetch(url, options);
      if (!res.ok) throw new Error("Server Error " + res.status);
      return res;
    } catch (err) {
      console.error("âŒ Fetch error:", err);
      showToast("ğŸ“´ Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ (Ù„Ø§ ØªØ®Ø§ÙØŒ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø£Ù…Ø§Ù†)", true);
      return null; // Ù†Ø±Ø¬Ø¹ null Ø¥Ø°Ø§ ÙØ´Ù„
    }
  }


  // ÙŠØµÙ†Ø¹ docId Ø¢Ù…Ù† ÙˆÙ…Ù…ÙŠØ²
  function makeDocId(inv){
    const iso = new Date().toISOString().slice(0,10); // YYYY-MM-DD
    const pretty = slugId(inv?.id || "");
    return `inv-${iso}${pretty ? '-' + pretty : ''}`;
  }

 
// ÙŠØ­ÙˆÙ‘Ù„ Ø£ÙŠ Ù†Øµ Ø¥Ù„Ù‰ ID Ø¢Ù…Ù†
function slugId(str){
  return String(str || "")
    .replace(/[\/\\?#\[\]\.%]/g, "-")  // ÙŠØ´ÙŠÙ„ / \ % ...
    .replace(/\s+/g, "-")              // ÙŠØ­ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¥Ù„Ù‰ -
    .replace(/-+/g, "-")               // ÙŠØ´ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±
    .trim();
}


// Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ù„ÙŠ + Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
window.saveInvoice = async function () {
  try {
    if (!window.currentInvoice) {
      window.newInvoice && window.newInvoice();
    }

    // ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø­Ù„ÙŠ
    if (window.selectedInvoiceIndex !== null) {
      window.invoices[window.selectedInvoiceIndex] = window.currentInvoice;
    } else {
      window.invoices.push(window.currentInvoice);
      window.selectedInvoiceIndex = window.invoices.length - 1;
    }

    // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 3 ÙÙˆØ§ØªÙŠØ±
    if (window.invoices.length > 3) {
      window.invoices.shift();
      window.selectedInvoiceIndex = window.invoices.length - 1;
    }

    localStorage.setItem("invoices", JSON.stringify(window.invoices));
    window.renderInvoicesDropdown && window.renderInvoicesDropdown();

    const user = auth.currentUser;
    if (!user) {
      setTimeout(()=> window.showToast("âš ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙ‚Ø·", "info"), 500);
      return;
    }

    // âœ… Ø§Ø³ØªØ¹Ù…Ø§Ù„ slugId
    const safeId = slugId(window.currentInvoice.id || `INV-${Date.now()}`);
    await setDoc(doc(db, "users", user.uid, "invoices", safeId), window.currentInvoice);

    setTimeout(()=> window.showToast("â˜ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ + Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©", "success"), 1200);

  } catch (err) {
    console.error("âŒ Ø®Ø·Ø£ Ø­ÙØ¸:", err);
    window.showToast("âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©", "danger");
  }
};


</script>





<!-- Ø§Ø³ØªØ¨Ø¯Ù„ loadInvoicesFromFirebase Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Realtime) -->
<script type="module">
  import { getFirestore, collection, onSnapshot } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const db = window.db || getFirestore();
  const auth = getAuth();

  // ğŸ‘‡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ± (Realtime)
  window.listenInvoicesFromFirebase = function (user) {
    const colRef = collection(db, "users", user.uid, "invoices");

    // onSnapshot ÙŠØ´ØªØºÙ„ ÙƒÙ„ Ù…Ø§ ÙŠØªØºÙŠØ± Ø´ÙŠ
    onSnapshot(colRef, (snap) => {
      const cloudInvoices = snap.docs.map(d => {
        const data = d.data() || {};
        return {
          id: data.id || d.id,
          date: data.date || "",
          items: Array.isArray(data.items) ? data.items : [],
          docId: d.id
        };
      });

      // Ù†Ø®Ø²Ù† Ù…Ø­Ù„ÙŠ ÙˆÙ†Ø­Ø¯Ø« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      window.invoices = cloudInvoices;
      localStorage.setItem("invoices", JSON.stringify(window.invoices));
      window.renderInvoicesDropdown && window.renderInvoicesDropdown();

      window.showToast(`ğŸ”„ ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© (${cloudInvoices.length}) ÙØ§ØªÙˆØ±Ø©`, "success");
    }, (err) => {
      console.error("âŒ Ø®Ø·Ø£ Ø¨Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:", err);
      window.showToast("âŒ ØªØ¹Ø°Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©", true);
    });
  };

  // ğŸ‘‡ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
  onAuthStateChanged(auth, (user) => {
    if (user) {
      window.listenInvoicesFromFirebase(user);
    }
  });
</script>




<script type="module">
  import { getAuth, signOut } 
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const auth = getAuth();

  const btnLogout  = document.getElementById("btnLogout");
  const logoutModal = document.getElementById("logoutModal");
  const logoutYes  = document.getElementById("logoutYes");
  const logoutNo   = document.getElementById("logoutNo");

  // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
  btnLogout.addEventListener("click", ()=>{
    logoutModal.style.display = "flex";
  });

  // Ù†Ø¹Ù… = Ø®Ø±ÙˆØ¬
  logoutYes.addEventListener("click", async ()=>{
    try {
      await signOut(auth);
      logoutModal.style.display = "none";
      window.showToast("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­","success");
      // Ø±Ø­ ÙŠØ´ØªØºÙ„ onAuthStateChanged ÙˆÙŠØ±Ø¬Ø¹Ùƒ Ù„Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    } catch(err) {
      console.error("âŒ Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:", err);
      window.showToast("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬","danger");
    }
  });

  // Ù„Ø§ = ØºÙ„Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
  logoutNo.addEventListener("click", ()=>{
    logoutModal.style.display = "none";
  });
  
  
  // Global JS Error Handler
window.addEventListener("error", function(e) {
  console.error("âš ï¸ Error Caught:", e.message, e.filename, e.lineno);
  showToast("ğŸ“´ ØµØ§Ø± Ø®Ù„Ù„ Ø¨Ø³ÙŠØ·ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©", true);
});

// Global Promise Rejection Handler (Ù„Ø£Ø®Ø·Ø§Ø¡ async/await)
window.addEventListener("unhandledrejection", function(e) {
  console.error("âš ï¸ Promise Error:", e.reason);
  showToast("ğŸ“´ Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ù† Ø¬Ø¯ÙŠØ¯", true);
});

  
</script>










  
  
  
</body>
</html>

